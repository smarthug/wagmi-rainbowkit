import{e as _t}from"./events.0e2dd351.js";import{g as Yo,r as Jo}from"./index.0045b903.js";import{s as Ui,a as Hs,b as qs,d as Ks,i as yn,c as Xo,e as Zo,f as Vs,g as Li,p as Qo,J as Mi,h as ji,j as $i,k as Ut,l as Tt,m as Gs,n as zi,H as Ws}from"./http.9eb32b74.js";function ec(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var tc=rc;function rc(t,e,r){var i=r&&r.stringify||ec,n=1;if(typeof t=="object"&&t!==null){var c=e.length+n;if(c===1)return t;var p=new Array(c);p[0]=i(t);for(var u=1;u<c;u++)p[u]=i(e[u]);return p.join(" ")}if(typeof t!="string")return t;var g=e.length;if(g===0)return t;for(var O="",S=1-n,P=-1,$=t&&t.length||0,N=0;N<$;){if(t.charCodeAt(N)===37&&N+1<$){switch(P=P>-1?P:0,t.charCodeAt(N+1)){case 100:case 102:if(S>=g||e[S]==null)break;P<N&&(O+=t.slice(P,N)),O+=Number(e[S]),P=N+2,N++;break;case 105:if(S>=g||e[S]==null)break;P<N&&(O+=t.slice(P,N)),O+=Math.floor(Number(e[S])),P=N+2,N++;break;case 79:case 111:case 106:if(S>=g||e[S]===void 0)break;P<N&&(O+=t.slice(P,N));var A=typeof e[S];if(A==="string"){O+="'"+e[S]+"'",P=N+2,N++;break}if(A==="function"){O+=e[S].name||"<anonymous>",P=N+2,N++;break}O+=i(e[S]),P=N+2,N++;break;case 115:if(S>=g)break;P<N&&(O+=t.slice(P,N)),O+=String(e[S]),P=N+2,N++;break;case 37:P<N&&(O+=t.slice(P,N)),O+="%",P=N+2,N++,S--;break}++S}++N}return P===-1?t:(P<$&&(O+=t.slice(P)),O)}const _n=tc;var Er=St;const wr=fc().console||{},ic={mapHttpRequest:$r,mapHttpResponse:$r,wrapRequestSerializer:ni,wrapResponseSerializer:ni,wrapErrorSerializer:ni,req:$r,res:$r,err:cc};function nc(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function St(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||wr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=nc(t.browser.serialize,i);let c=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const p=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const u=t.level||"info",g=Object.create(r);g.log||(g.log=mr),Object.defineProperty(g,"levelVal",{get:S}),Object.defineProperty(g,"level",{get:P,set:$});const O={transmit:e,serialize:n,asObject:t.browser.asObject,levels:p,timestamp:uc(t)};g.levels=St.levels,g.level=u,g.setMaxListeners=g.getMaxListeners=g.emit=g.addListener=g.on=g.prependListener=g.once=g.prependOnceListener=g.removeListener=g.removeAllListeners=g.listeners=g.listenerCount=g.eventNames=g.write=g.flush=mr,g.serializers=i,g._serialize=n,g._stdErrSerialize=c,g.child=N,e&&(g._logEvent=_i());function S(){return this.level==="silent"?1/0:this.levels.values[this.level]}function P(){return this._level}function $(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,Qt(O,g,"error","log"),Qt(O,g,"fatal","error"),Qt(O,g,"warn","error"),Qt(O,g,"info","log"),Qt(O,g,"debug","log"),Qt(O,g,"trace","log")}function N(A,H){if(!A)throw new Error("missing bindings for child Pino");H=H||{},n&&A.serializers&&(H.serializers=A.serializers);const M=H.serializers;if(n&&M){var q=Object.assign({},i,M),_=t.browser.serialize===!0?Object.keys(q):n;delete A.serializers,Wr([A],_,q,this._stdErrSerialize)}function E(b){this._childLevel=(b._childLevel|0)+1,this.error=er(b,A,"error"),this.fatal=er(b,A,"fatal"),this.warn=er(b,A,"warn"),this.info=er(b,A,"info"),this.debug=er(b,A,"debug"),this.trace=er(b,A,"trace"),q&&(this.serializers=q,this._serialize=_),e&&(this._logEvent=_i([].concat(b._logEvent.bindings,A)))}return E.prototype=this,new E(this)}return g}St.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};St.stdSerializers=ic;St.stdTimeFunctions=Object.assign({},{nullTime:ks,epochTime:Ys,unixTime:hc,isoTime:lc});function Qt(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?mr:n[r]?n[r]:wr[r]||wr[i]||mr,sc(t,e,r)}function sc(t,e,r){!t.transmit&&e[r]===mr||(e[r]=function(i){return function(){const c=t.timestamp(),p=new Array(arguments.length),u=Object.getPrototypeOf&&Object.getPrototypeOf(this)===wr?wr:this;for(var g=0;g<p.length;g++)p[g]=arguments[g];if(t.serialize&&!t.asObject&&Wr(p,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(u,ac(this,r,p,c)):i.apply(u,p),t.transmit){const O=t.transmit.level||e.level,S=St.levels.values[O],P=St.levels.values[r];if(P<S)return;oc(this,{ts:c,methodLevel:r,methodValue:P,transmitLevel:O,transmitValue:St.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},p)}}}(e[r]))}function ac(t,e,r,i){t._serialize&&Wr(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let c=n[0];const p={};i&&(p.time=i),p.level=St.levels.values[e];let u=(t._childLevel|0)+1;if(u<1&&(u=1),c!==null&&typeof c=="object"){for(;u--&&typeof n[0]=="object";)Object.assign(p,n.shift());c=n.length?_n(n.shift(),n):void 0}else typeof c=="string"&&(c=_n(n.shift(),n));return c!==void 0&&(p.msg=c),p}function Wr(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=St.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const c in t[n])e&&e.indexOf(c)>-1&&c in r&&(t[n][c]=r[c](t[n][c]))}function er(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function oc(t,e,r){const i=e.send,n=e.ts,c=e.methodLevel,p=e.methodValue,u=e.val,g=t._logEvent.bindings;Wr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(O){return g.indexOf(O)===-1}),t._logEvent.level.label=c,t._logEvent.level.value=p,i(c,t._logEvent,u),t._logEvent=_i(g)}function _i(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function cc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function uc(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?ks:Ys}function $r(){return{}}function ni(t){return t}function mr(){}function ks(){return!1}function Ys(){return Date.now()}function hc(){return Math.round(Date.now()/1e3)}function lc(){return new Date(Date.now()).toISOString()}function fc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var kr={},Bi={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,c,p,u,g,O,S,P,$,N,A,H,M,q,_,E,b,w,m,s;(function(l){var B=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};l(o(B,o(t.exports)));function o(f,d){return f!==B&&(typeof Object.create=="function"?Object.defineProperty(f,"__esModule",{value:!0}):f.__esModule=!0),function(v,y){return f[v]=d?d(v,y):y}}})(function(l){var B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var d in f)f.hasOwnProperty(d)&&(o[d]=f[d])};e=function(o,f){B(o,f);function d(){this.constructor=o}o.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)},r=Object.assign||function(o){for(var f,d=1,v=arguments.length;d<v;d++){f=arguments[d];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(o[y]=f[y])}return o},i=function(o,f){var d={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&f.indexOf(v)<0&&(d[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,v=Object.getOwnPropertySymbols(o);y<v.length;y++)f.indexOf(v[y])<0&&Object.prototype.propertyIsEnumerable.call(o,v[y])&&(d[v[y]]=o[v[y]]);return d},n=function(o,f,d,v){var y=arguments.length,h=y<3?f:v===null?v=Object.getOwnPropertyDescriptor(f,d):v,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(o,f,d,v);else for(var F=o.length-1;F>=0;F--)(T=o[F])&&(h=(y<3?T(h):y>3?T(f,d,h):T(f,d))||h);return y>3&&h&&Object.defineProperty(f,d,h),h},c=function(o,f){return function(d,v){f(d,v,o)}},p=function(o,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,f)},u=function(o,f,d,v){function y(h){return h instanceof d?h:new d(function(T){T(h)})}return new(d||(d=Promise))(function(h,T){function F(j){try{x(v.next(j))}catch(K){T(K)}}function z(j){try{x(v.throw(j))}catch(K){T(K)}}function x(j){j.done?h(j.value):y(j.value).then(F,z)}x((v=v.apply(o,f||[])).next())})},g=function(o,f){var d={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},v,y,h,T;return T={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function F(x){return function(j){return z([x,j])}}function z(x){if(v)throw new TypeError("Generator is already executing.");for(;d;)try{if(v=1,y&&(h=x[0]&2?y.return:x[0]?y.throw||((h=y.return)&&h.call(y),0):y.next)&&!(h=h.call(y,x[1])).done)return h;switch(y=0,h&&(x=[x[0]&2,h.value]),x[0]){case 0:case 1:h=x;break;case 4:return d.label++,{value:x[1],done:!1};case 5:d.label++,y=x[1],x=[0];continue;case 7:x=d.ops.pop(),d.trys.pop();continue;default:if(h=d.trys,!(h=h.length>0&&h[h.length-1])&&(x[0]===6||x[0]===2)){d=0;continue}if(x[0]===3&&(!h||x[1]>h[0]&&x[1]<h[3])){d.label=x[1];break}if(x[0]===6&&d.label<h[1]){d.label=h[1],h=x;break}if(h&&d.label<h[2]){d.label=h[2],d.ops.push(x);break}h[2]&&d.ops.pop(),d.trys.pop();continue}x=f.call(o,d)}catch(j){x=[6,j],y=0}finally{v=h=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},s=function(o,f,d,v){v===void 0&&(v=d),o[v]=f[d]},O=function(o,f){for(var d in o)d!=="default"&&!f.hasOwnProperty(d)&&(f[d]=o[d])},S=function(o){var f=typeof Symbol=="function"&&Symbol.iterator,d=f&&o[f],v=0;if(d)return d.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(o,f){var d=typeof Symbol=="function"&&o[Symbol.iterator];if(!d)return o;var v=d.call(o),y,h=[],T;try{for(;(f===void 0||f-- >0)&&!(y=v.next()).done;)h.push(y.value)}catch(F){T={error:F}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(T)throw T.error}}return h},$=function(){for(var o=[],f=0;f<arguments.length;f++)o=o.concat(P(arguments[f]));return o},N=function(){for(var o=0,f=0,d=arguments.length;f<d;f++)o+=arguments[f].length;for(var v=Array(o),y=0,f=0;f<d;f++)for(var h=arguments[f],T=0,F=h.length;T<F;T++,y++)v[y]=h[T];return v},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},H=function(o,f,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=d.apply(o,f||[]),y,h=[];return y={},T("next"),T("throw"),T("return"),y[Symbol.asyncIterator]=function(){return this},y;function T(G){v[G]&&(y[G]=function(V){return new Promise(function(Q,J){h.push([G,V,Q,J])>1||F(G,V)})})}function F(G,V){try{z(v[G](V))}catch(Q){K(h[0][3],Q)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(x,j):K(h[0][2],G)}function x(G){F("next",G)}function j(G){F("throw",G)}function K(G,V){G(V),h.shift(),h.length&&F(h[0][0],h[0][1])}},M=function(o){var f,d;return f={},v("next"),v("throw",function(y){throw y}),v("return"),f[Symbol.iterator]=function(){return this},f;function v(y,h){f[y]=o[y]?function(T){return(d=!d)?{value:A(o[y](T)),done:y==="return"}:h?h(T):T}:h}},q=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=o[Symbol.asyncIterator],d;return f?f.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),d={},v("next"),v("throw"),v("return"),d[Symbol.asyncIterator]=function(){return this},d);function v(h){d[h]=o[h]&&function(T){return new Promise(function(F,z){T=o[h](T),y(F,z,T.done,T.value)})}}function y(h,T,F,z){Promise.resolve(z).then(function(x){h({value:x,done:F})},T)}},_=function(o,f){return Object.defineProperty?Object.defineProperty(o,"raw",{value:f}):o.raw=f,o},E=function(o){if(o&&o.__esModule)return o;var f={};if(o!=null)for(var d in o)Object.hasOwnProperty.call(o,d)&&(f[d]=o[d]);return f.default=o,f},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,f){if(!f.has(o))throw new TypeError("attempted to get private field on non-instance");return f.get(o)},m=function(o,f,d){if(!f.has(o))throw new TypeError("attempted to set private field on non-instance");return f.set(o,d),d},l("__extends",e),l("__assign",r),l("__rest",i),l("__decorate",n),l("__param",c),l("__metadata",p),l("__awaiter",u),l("__generator",g),l("__exportStar",O),l("__createBinding",s),l("__values",S),l("__read",P),l("__spread",$),l("__spreadArrays",N),l("__await",A),l("__asyncGenerator",H),l("__asyncDelegator",M),l("__asyncValues",q),l("__makeTemplateObject",_),l("__importStar",E),l("__importDefault",b),l("__classPrivateFieldGet",w),l("__classPrivateFieldSet",m)})})(Bi);var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});function dc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Dr.safeJsonParse=dc;function gc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Dr.safeJsonStringify=gc;var ur={exports:{}},bn;function pc(){return bn||(bn=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof globalThis<"u"&&globalThis.localStorage?ur.exports=globalThis.localStorage:typeof window<"u"&&window.localStorage?ur.exports=window.localStorage:ur.exports=new e}()),ur.exports}var si={},hr={},wn;function yc(){if(wn)return hr;wn=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.IKeyValueStorage=void 0;class t{}return hr.IKeyValueStorage=t,hr}var lr={},mn;function _c(){if(mn)return lr;mn=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.parseEntry=void 0;const t=Dr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return lr.parseEntry=e,lr}var vn;function bc(){return vn||(vn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Bi.exports;e.__exportStar(yc(),t),e.__exportStar(_c(),t)}(si)),si}Object.defineProperty(kr,"__esModule",{value:!0});kr.KeyValueStorage=void 0;const rr=Bi.exports,En=Dr,wc=rr.__importDefault(pc()),mc=bc();class Js{constructor(){this.localStorage=wc.default}getKeys(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(mc.parseEntry)})}getItem(e){return rr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return En.safeJsonParse(r)})}setItem(e,r){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,En.safeJsonStringify(r))})}removeItem(e){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}kr.KeyValueStorage=Js;var vc=kr.default=Js,Sr={},Or={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,c,p,u,g,O,S,P,$,N,A,H,M,q,_,E,b,w,m,s;(function(l){var B=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};l(o(B,o(t.exports)));function o(f,d){return f!==B&&(typeof Object.create=="function"?Object.defineProperty(f,"__esModule",{value:!0}):f.__esModule=!0),function(v,y){return f[v]=d?d(v,y):y}}})(function(l){var B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var d in f)f.hasOwnProperty(d)&&(o[d]=f[d])};e=function(o,f){B(o,f);function d(){this.constructor=o}o.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)},r=Object.assign||function(o){for(var f,d=1,v=arguments.length;d<v;d++){f=arguments[d];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(o[y]=f[y])}return o},i=function(o,f){var d={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&f.indexOf(v)<0&&(d[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,v=Object.getOwnPropertySymbols(o);y<v.length;y++)f.indexOf(v[y])<0&&Object.prototype.propertyIsEnumerable.call(o,v[y])&&(d[v[y]]=o[v[y]]);return d},n=function(o,f,d,v){var y=arguments.length,h=y<3?f:v===null?v=Object.getOwnPropertyDescriptor(f,d):v,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(o,f,d,v);else for(var F=o.length-1;F>=0;F--)(T=o[F])&&(h=(y<3?T(h):y>3?T(f,d,h):T(f,d))||h);return y>3&&h&&Object.defineProperty(f,d,h),h},c=function(o,f){return function(d,v){f(d,v,o)}},p=function(o,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,f)},u=function(o,f,d,v){function y(h){return h instanceof d?h:new d(function(T){T(h)})}return new(d||(d=Promise))(function(h,T){function F(j){try{x(v.next(j))}catch(K){T(K)}}function z(j){try{x(v.throw(j))}catch(K){T(K)}}function x(j){j.done?h(j.value):y(j.value).then(F,z)}x((v=v.apply(o,f||[])).next())})},g=function(o,f){var d={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},v,y,h,T;return T={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function F(x){return function(j){return z([x,j])}}function z(x){if(v)throw new TypeError("Generator is already executing.");for(;d;)try{if(v=1,y&&(h=x[0]&2?y.return:x[0]?y.throw||((h=y.return)&&h.call(y),0):y.next)&&!(h=h.call(y,x[1])).done)return h;switch(y=0,h&&(x=[x[0]&2,h.value]),x[0]){case 0:case 1:h=x;break;case 4:return d.label++,{value:x[1],done:!1};case 5:d.label++,y=x[1],x=[0];continue;case 7:x=d.ops.pop(),d.trys.pop();continue;default:if(h=d.trys,!(h=h.length>0&&h[h.length-1])&&(x[0]===6||x[0]===2)){d=0;continue}if(x[0]===3&&(!h||x[1]>h[0]&&x[1]<h[3])){d.label=x[1];break}if(x[0]===6&&d.label<h[1]){d.label=h[1],h=x;break}if(h&&d.label<h[2]){d.label=h[2],d.ops.push(x);break}h[2]&&d.ops.pop(),d.trys.pop();continue}x=f.call(o,d)}catch(j){x=[6,j],y=0}finally{v=h=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},s=function(o,f,d,v){v===void 0&&(v=d),o[v]=f[d]},O=function(o,f){for(var d in o)d!=="default"&&!f.hasOwnProperty(d)&&(f[d]=o[d])},S=function(o){var f=typeof Symbol=="function"&&Symbol.iterator,d=f&&o[f],v=0;if(d)return d.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(o,f){var d=typeof Symbol=="function"&&o[Symbol.iterator];if(!d)return o;var v=d.call(o),y,h=[],T;try{for(;(f===void 0||f-- >0)&&!(y=v.next()).done;)h.push(y.value)}catch(F){T={error:F}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(T)throw T.error}}return h},$=function(){for(var o=[],f=0;f<arguments.length;f++)o=o.concat(P(arguments[f]));return o},N=function(){for(var o=0,f=0,d=arguments.length;f<d;f++)o+=arguments[f].length;for(var v=Array(o),y=0,f=0;f<d;f++)for(var h=arguments[f],T=0,F=h.length;T<F;T++,y++)v[y]=h[T];return v},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},H=function(o,f,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=d.apply(o,f||[]),y,h=[];return y={},T("next"),T("throw"),T("return"),y[Symbol.asyncIterator]=function(){return this},y;function T(G){v[G]&&(y[G]=function(V){return new Promise(function(Q,J){h.push([G,V,Q,J])>1||F(G,V)})})}function F(G,V){try{z(v[G](V))}catch(Q){K(h[0][3],Q)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(x,j):K(h[0][2],G)}function x(G){F("next",G)}function j(G){F("throw",G)}function K(G,V){G(V),h.shift(),h.length&&F(h[0][0],h[0][1])}},M=function(o){var f,d;return f={},v("next"),v("throw",function(y){throw y}),v("return"),f[Symbol.iterator]=function(){return this},f;function v(y,h){f[y]=o[y]?function(T){return(d=!d)?{value:A(o[y](T)),done:y==="return"}:h?h(T):T}:h}},q=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=o[Symbol.asyncIterator],d;return f?f.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),d={},v("next"),v("throw"),v("return"),d[Symbol.asyncIterator]=function(){return this},d);function v(h){d[h]=o[h]&&function(T){return new Promise(function(F,z){T=o[h](T),y(F,z,T.done,T.value)})}}function y(h,T,F,z){Promise.resolve(z).then(function(x){h({value:x,done:F})},T)}},_=function(o,f){return Object.defineProperty?Object.defineProperty(o,"raw",{value:f}):o.raw=f,o},E=function(o){if(o&&o.__esModule)return o;var f={};if(o!=null)for(var d in o)Object.hasOwnProperty.call(o,d)&&(f[d]=o[d]);return f.default=o,f},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,f){if(!f.has(o))throw new TypeError("attempted to get private field on non-instance");return f.get(o)},m=function(o,f,d){if(!f.has(o))throw new TypeError("attempted to set private field on non-instance");return f.set(o,d),d},l("__extends",e),l("__assign",r),l("__rest",i),l("__decorate",n),l("__param",c),l("__metadata",p),l("__awaiter",u),l("__generator",g),l("__exportStar",O),l("__createBinding",s),l("__values",S),l("__read",P),l("__spread",$),l("__spreadArrays",N),l("__await",A),l("__asyncGenerator",H),l("__asyncDelegator",M),l("__asyncValues",q),l("__makeTemplateObject",_),l("__importStar",E),l("__importDefault",b),l("__classPrivateFieldGet",w),l("__classPrivateFieldSet",m)})})(Or);var fr={},ee={},xr={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,c,p,u,g,O,S,P,$,N,A,H,M,q,_,E,b,w,m,s;(function(l){var B=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};l(o(B,o(t.exports)));function o(f,d){return f!==B&&(typeof Object.create=="function"?Object.defineProperty(f,"__esModule",{value:!0}):f.__esModule=!0),function(v,y){return f[v]=d?d(v,y):y}}})(function(l){var B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var d in f)f.hasOwnProperty(d)&&(o[d]=f[d])};e=function(o,f){B(o,f);function d(){this.constructor=o}o.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)},r=Object.assign||function(o){for(var f,d=1,v=arguments.length;d<v;d++){f=arguments[d];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(o[y]=f[y])}return o},i=function(o,f){var d={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&f.indexOf(v)<0&&(d[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,v=Object.getOwnPropertySymbols(o);y<v.length;y++)f.indexOf(v[y])<0&&Object.prototype.propertyIsEnumerable.call(o,v[y])&&(d[v[y]]=o[v[y]]);return d},n=function(o,f,d,v){var y=arguments.length,h=y<3?f:v===null?v=Object.getOwnPropertyDescriptor(f,d):v,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(o,f,d,v);else for(var F=o.length-1;F>=0;F--)(T=o[F])&&(h=(y<3?T(h):y>3?T(f,d,h):T(f,d))||h);return y>3&&h&&Object.defineProperty(f,d,h),h},c=function(o,f){return function(d,v){f(d,v,o)}},p=function(o,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,f)},u=function(o,f,d,v){function y(h){return h instanceof d?h:new d(function(T){T(h)})}return new(d||(d=Promise))(function(h,T){function F(j){try{x(v.next(j))}catch(K){T(K)}}function z(j){try{x(v.throw(j))}catch(K){T(K)}}function x(j){j.done?h(j.value):y(j.value).then(F,z)}x((v=v.apply(o,f||[])).next())})},g=function(o,f){var d={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},v,y,h,T;return T={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function F(x){return function(j){return z([x,j])}}function z(x){if(v)throw new TypeError("Generator is already executing.");for(;d;)try{if(v=1,y&&(h=x[0]&2?y.return:x[0]?y.throw||((h=y.return)&&h.call(y),0):y.next)&&!(h=h.call(y,x[1])).done)return h;switch(y=0,h&&(x=[x[0]&2,h.value]),x[0]){case 0:case 1:h=x;break;case 4:return d.label++,{value:x[1],done:!1};case 5:d.label++,y=x[1],x=[0];continue;case 7:x=d.ops.pop(),d.trys.pop();continue;default:if(h=d.trys,!(h=h.length>0&&h[h.length-1])&&(x[0]===6||x[0]===2)){d=0;continue}if(x[0]===3&&(!h||x[1]>h[0]&&x[1]<h[3])){d.label=x[1];break}if(x[0]===6&&d.label<h[1]){d.label=h[1],h=x;break}if(h&&d.label<h[2]){d.label=h[2],d.ops.push(x);break}h[2]&&d.ops.pop(),d.trys.pop();continue}x=f.call(o,d)}catch(j){x=[6,j],y=0}finally{v=h=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},s=function(o,f,d,v){v===void 0&&(v=d),o[v]=f[d]},O=function(o,f){for(var d in o)d!=="default"&&!f.hasOwnProperty(d)&&(f[d]=o[d])},S=function(o){var f=typeof Symbol=="function"&&Symbol.iterator,d=f&&o[f],v=0;if(d)return d.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(o,f){var d=typeof Symbol=="function"&&o[Symbol.iterator];if(!d)return o;var v=d.call(o),y,h=[],T;try{for(;(f===void 0||f-- >0)&&!(y=v.next()).done;)h.push(y.value)}catch(F){T={error:F}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(T)throw T.error}}return h},$=function(){for(var o=[],f=0;f<arguments.length;f++)o=o.concat(P(arguments[f]));return o},N=function(){for(var o=0,f=0,d=arguments.length;f<d;f++)o+=arguments[f].length;for(var v=Array(o),y=0,f=0;f<d;f++)for(var h=arguments[f],T=0,F=h.length;T<F;T++,y++)v[y]=h[T];return v},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},H=function(o,f,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=d.apply(o,f||[]),y,h=[];return y={},T("next"),T("throw"),T("return"),y[Symbol.asyncIterator]=function(){return this},y;function T(G){v[G]&&(y[G]=function(V){return new Promise(function(Q,J){h.push([G,V,Q,J])>1||F(G,V)})})}function F(G,V){try{z(v[G](V))}catch(Q){K(h[0][3],Q)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(x,j):K(h[0][2],G)}function x(G){F("next",G)}function j(G){F("throw",G)}function K(G,V){G(V),h.shift(),h.length&&F(h[0][0],h[0][1])}},M=function(o){var f,d;return f={},v("next"),v("throw",function(y){throw y}),v("return"),f[Symbol.iterator]=function(){return this},f;function v(y,h){f[y]=o[y]?function(T){return(d=!d)?{value:A(o[y](T)),done:y==="return"}:h?h(T):T}:h}},q=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=o[Symbol.asyncIterator],d;return f?f.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),d={},v("next"),v("throw"),v("return"),d[Symbol.asyncIterator]=function(){return this},d);function v(h){d[h]=o[h]&&function(T){return new Promise(function(F,z){T=o[h](T),y(F,z,T.done,T.value)})}}function y(h,T,F,z){Promise.resolve(z).then(function(x){h({value:x,done:F})},T)}},_=function(o,f){return Object.defineProperty?Object.defineProperty(o,"raw",{value:f}):o.raw=f,o},E=function(o){if(o&&o.__esModule)return o;var f={};if(o!=null)for(var d in o)Object.hasOwnProperty.call(o,d)&&(f[d]=o[d]);return f.default=o,f},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,f){if(!f.has(o))throw new TypeError("attempted to get private field on non-instance");return f.get(o)},m=function(o,f,d){if(!f.has(o))throw new TypeError("attempted to set private field on non-instance");return f.set(o,d),d},l("__extends",e),l("__assign",r),l("__rest",i),l("__decorate",n),l("__param",c),l("__metadata",p),l("__awaiter",u),l("__generator",g),l("__exportStar",O),l("__createBinding",s),l("__values",S),l("__read",P),l("__spread",$),l("__spreadArrays",N),l("__await",A),l("__asyncGenerator",H),l("__asyncDelegator",M),l("__asyncValues",q),l("__makeTemplateObject",_),l("__importStar",E),l("__importDefault",b),l("__classPrivateFieldGet",w),l("__classPrivateFieldSet",m)})})(xr);var ai={},dr={},Dn;function Ec(){if(Dn)return dr;Dn=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return dr.delay=t,dr}var qt={},oi={},Kt={},Sn;function Dc(){return Sn||(Sn=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.ONE_THOUSAND=Kt.ONE_HUNDRED=void 0,Kt.ONE_HUNDRED=100,Kt.ONE_THOUSAND=1e3),Kt}var ci={},On;function Sc(){return On||(On=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ci)),ci}var xn;function Xs(){return xn||(xn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=xr.exports;e.__exportStar(Dc(),t),e.__exportStar(Sc(),t)}(oi)),oi}var In;function Oc(){if(In)return qt;In=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.fromMiliseconds=qt.toMiliseconds=void 0;const t=Xs();function e(i){return i*t.ONE_THOUSAND}qt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return qt.fromMiliseconds=r,qt}var Tn;function xc(){return Tn||(Tn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=xr.exports;e.__exportStar(Ec(),t),e.__exportStar(Oc(),t)}(ai)),ai}var tr={},An;function Ic(){if(An)return tr;An=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return tr.Watch=t,tr.default=t,tr}var ui={},gr={},Pn;function Tc(){if(Pn)return gr;Pn=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.IWatch=void 0;class t{}return gr.IWatch=t,gr}var Nn;function Ac(){return Nn||(Nn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),xr.exports.__exportStar(Tc(),t)}(ui)),ui}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=xr.exports;e.__exportStar(xc(),t),e.__exportStar(Ic(),t),e.__exportStar(Ac(),t),e.__exportStar(Xs(),t)})(ee);var hi={},pr={};class kt{}const Pc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:kt},Symbol.toStringTag,{value:"Module"})),Nc=Yo(Pc);var Cn;function Cc(){if(Cn)return pr;Cn=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.IHeartBeat=void 0;const t=Nc;class e extends t.IEvents{constructor(i){super()}}return pr.IHeartBeat=e,pr}var Rn;function Zs(){return Rn||(Rn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Or.exports.__exportStar(Cc(),t)}(hi)),hi}var li={},Vt={},Fn;function Rc(){if(Fn)return Vt;Fn=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.HEARTBEAT_EVENTS=Vt.HEARTBEAT_INTERVAL=void 0;const t=ee;return Vt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Vt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Vt}var Un;function Qs(){return Un||(Un=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Or.exports.__exportStar(Rc(),t)}(li)),li}var Ln;function Fc(){if(Ln)return fr;Ln=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.HeartBeat=void 0;const t=Or.exports,e=_t.exports,r=ee,i=Zs(),n=Qs();class c extends i.IHeartBeat{constructor(u){super(u),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(u==null?void 0:u.interval)||n.HEARTBEAT_INTERVAL}static init(u){return t.__awaiter(this,void 0,void 0,function*(){const g=new c(u);return yield g.init(),g})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}on(u,g){this.events.on(u,g)}once(u,g){this.events.once(u,g)}off(u,g){this.events.off(u,g)}removeListener(u,g){this.events.removeListener(u,g)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return fr.HeartBeat=c,fr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Or.exports;e.__exportStar(Fc(),t),e.__exportStar(Zs(),t),e.__exportStar(Qs(),t)})(Sr);var Se={},ea={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,c,p,u,g,O,S,P,$,N,A,H,M,q,_,E,b,w,m,s;(function(l){var B=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};l(o(B,o(t.exports)));function o(f,d){return f!==B&&(typeof Object.create=="function"?Object.defineProperty(f,"__esModule",{value:!0}):f.__esModule=!0),function(v,y){return f[v]=d?d(v,y):y}}})(function(l){var B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var d in f)f.hasOwnProperty(d)&&(o[d]=f[d])};e=function(o,f){B(o,f);function d(){this.constructor=o}o.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)},r=Object.assign||function(o){for(var f,d=1,v=arguments.length;d<v;d++){f=arguments[d];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(o[y]=f[y])}return o},i=function(o,f){var d={};for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&f.indexOf(v)<0&&(d[v]=o[v]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,v=Object.getOwnPropertySymbols(o);y<v.length;y++)f.indexOf(v[y])<0&&Object.prototype.propertyIsEnumerable.call(o,v[y])&&(d[v[y]]=o[v[y]]);return d},n=function(o,f,d,v){var y=arguments.length,h=y<3?f:v===null?v=Object.getOwnPropertyDescriptor(f,d):v,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(o,f,d,v);else for(var F=o.length-1;F>=0;F--)(T=o[F])&&(h=(y<3?T(h):y>3?T(f,d,h):T(f,d))||h);return y>3&&h&&Object.defineProperty(f,d,h),h},c=function(o,f){return function(d,v){f(d,v,o)}},p=function(o,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,f)},u=function(o,f,d,v){function y(h){return h instanceof d?h:new d(function(T){T(h)})}return new(d||(d=Promise))(function(h,T){function F(j){try{x(v.next(j))}catch(K){T(K)}}function z(j){try{x(v.throw(j))}catch(K){T(K)}}function x(j){j.done?h(j.value):y(j.value).then(F,z)}x((v=v.apply(o,f||[])).next())})},g=function(o,f){var d={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},v,y,h,T;return T={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function F(x){return function(j){return z([x,j])}}function z(x){if(v)throw new TypeError("Generator is already executing.");for(;d;)try{if(v=1,y&&(h=x[0]&2?y.return:x[0]?y.throw||((h=y.return)&&h.call(y),0):y.next)&&!(h=h.call(y,x[1])).done)return h;switch(y=0,h&&(x=[x[0]&2,h.value]),x[0]){case 0:case 1:h=x;break;case 4:return d.label++,{value:x[1],done:!1};case 5:d.label++,y=x[1],x=[0];continue;case 7:x=d.ops.pop(),d.trys.pop();continue;default:if(h=d.trys,!(h=h.length>0&&h[h.length-1])&&(x[0]===6||x[0]===2)){d=0;continue}if(x[0]===3&&(!h||x[1]>h[0]&&x[1]<h[3])){d.label=x[1];break}if(x[0]===6&&d.label<h[1]){d.label=h[1],h=x;break}if(h&&d.label<h[2]){d.label=h[2],d.ops.push(x);break}h[2]&&d.ops.pop(),d.trys.pop();continue}x=f.call(o,d)}catch(j){x=[6,j],y=0}finally{v=h=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},s=function(o,f,d,v){v===void 0&&(v=d),o[v]=f[d]},O=function(o,f){for(var d in o)d!=="default"&&!f.hasOwnProperty(d)&&(f[d]=o[d])},S=function(o){var f=typeof Symbol=="function"&&Symbol.iterator,d=f&&o[f],v=0;if(d)return d.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&v>=o.length&&(o=void 0),{value:o&&o[v++],done:!o}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(o,f){var d=typeof Symbol=="function"&&o[Symbol.iterator];if(!d)return o;var v=d.call(o),y,h=[],T;try{for(;(f===void 0||f-- >0)&&!(y=v.next()).done;)h.push(y.value)}catch(F){T={error:F}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(T)throw T.error}}return h},$=function(){for(var o=[],f=0;f<arguments.length;f++)o=o.concat(P(arguments[f]));return o},N=function(){for(var o=0,f=0,d=arguments.length;f<d;f++)o+=arguments[f].length;for(var v=Array(o),y=0,f=0;f<d;f++)for(var h=arguments[f],T=0,F=h.length;T<F;T++,y++)v[y]=h[T];return v},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},H=function(o,f,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=d.apply(o,f||[]),y,h=[];return y={},T("next"),T("throw"),T("return"),y[Symbol.asyncIterator]=function(){return this},y;function T(G){v[G]&&(y[G]=function(V){return new Promise(function(Q,J){h.push([G,V,Q,J])>1||F(G,V)})})}function F(G,V){try{z(v[G](V))}catch(Q){K(h[0][3],Q)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(x,j):K(h[0][2],G)}function x(G){F("next",G)}function j(G){F("throw",G)}function K(G,V){G(V),h.shift(),h.length&&F(h[0][0],h[0][1])}},M=function(o){var f,d;return f={},v("next"),v("throw",function(y){throw y}),v("return"),f[Symbol.iterator]=function(){return this},f;function v(y,h){f[y]=o[y]?function(T){return(d=!d)?{value:A(o[y](T)),done:y==="return"}:h?h(T):T}:h}},q=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=o[Symbol.asyncIterator],d;return f?f.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),d={},v("next"),v("throw"),v("return"),d[Symbol.asyncIterator]=function(){return this},d);function v(h){d[h]=o[h]&&function(T){return new Promise(function(F,z){T=o[h](T),y(F,z,T.done,T.value)})}}function y(h,T,F,z){Promise.resolve(z).then(function(x){h({value:x,done:F})},T)}},_=function(o,f){return Object.defineProperty?Object.defineProperty(o,"raw",{value:f}):o.raw=f,o},E=function(o){if(o&&o.__esModule)return o;var f={};if(o!=null)for(var d in o)Object.hasOwnProperty.call(o,d)&&(f[d]=o[d]);return f.default=o,f},b=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,f){if(!f.has(o))throw new TypeError("attempted to get private field on non-instance");return f.get(o)},m=function(o,f,d){if(!f.has(o))throw new TypeError("attempted to set private field on non-instance");return f.set(o,d),d},l("__extends",e),l("__assign",r),l("__rest",i),l("__decorate",n),l("__param",c),l("__metadata",p),l("__awaiter",u),l("__generator",g),l("__exportStar",O),l("__createBinding",s),l("__values",S),l("__read",P),l("__spread",$),l("__spreadArrays",N),l("__await",A),l("__asyncGenerator",H),l("__asyncDelegator",M),l("__asyncValues",q),l("__makeTemplateObject",_),l("__importStar",E),l("__importDefault",b),l("__classPrivateFieldGet",w),l("__classPrivateFieldSet",m)})})(ea);var Gt={},Mn;function ta(){return Mn||(Mn=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.PINO_CUSTOM_CONTEXT_KEY=Gt.PINO_LOGGER_DEFAULTS=void 0,Gt.PINO_LOGGER_DEFAULTS={level:"info"},Gt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Gt}var it={},jn;function Uc(){if(jn)return it;jn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const t=ta();function e(u){return Object.assign(Object.assign({},u),{level:(u==null?void 0:u.level)||t.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function r(u,g=t.PINO_CUSTOM_CONTEXT_KEY){return u[g]||""}it.getBrowserLoggerContext=r;function i(u,g,O=t.PINO_CUSTOM_CONTEXT_KEY){return u[O]=g,u}it.setBrowserLoggerContext=i;function n(u,g=t.PINO_CUSTOM_CONTEXT_KEY){let O="";return typeof u.bindings>"u"?O=r(u,g):O=u.bindings().context||"",O}it.getLoggerContext=n;function c(u,g,O=t.PINO_CUSTOM_CONTEXT_KEY){const S=n(u,O);return S.trim()?`${S}/${g}`:g}it.formatChildLoggerContext=c;function p(u,g,O=t.PINO_CUSTOM_CONTEXT_KEY){const S=c(u,g,O),P=u.child({context:S});return i(P,S,O)}return it.generateChildLogger=p,it}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=ea.exports,r=e.__importDefault(Er);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(ta(),t),e.__exportStar(Uc(),t)})(Se);class Lc extends kt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class Mc extends kt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class jc{constructor(e,r){this.logger=e,this.core=r}}class $c extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class zc extends kt{constructor(e){super()}}class Bc{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class Hc extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class qc extends kt{constructor(e,r){super(),this.core=e,this.logger=r}}class Kc{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Vc{constructor(e){this.client=e}}var Hi={},ir={},Yr={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.BrowserRandomSource=void 0;const $n=65536;class Gc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=$n)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,$n)));return r}}Jr.BrowserRandomSource=Gc;function Wc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xr={},ft={};Object.defineProperty(ft,"__esModule",{value:!0});function kc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ft.wipe=kc;Object.defineProperty(Xr,"__esModule",{value:!0});Xr.NodeRandomSource=void 0;const Yc=ft;class Jc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Wc<"u"){const e=Jo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Yc.wipe)(r),i}}Xr.NodeRandomSource=Jc;Object.defineProperty(Yr,"__esModule",{value:!0});Yr.SystemRandomSource=void 0;const Xc=Jr,Zc=Xr;class Qc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Xc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Zc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Yr.SystemRandomSource=Qc;var ie={},ra={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(u,g){var O=u>>>16&65535,S=u&65535,P=g>>>16&65535,$=g&65535;return S*$+(O*$+S*P<<16>>>0)|0}t.mul=Math.imul||e;function r(u,g){return u+g|0}t.add=r;function i(u,g){return u-g|0}t.sub=i;function n(u,g){return u<<g|u>>>32-g}t.rotl=n;function c(u,g){return u<<32-g|u>>>g}t.rotr=c;function p(u){return typeof u=="number"&&isFinite(u)&&Math.floor(u)===u}t.isInteger=Number.isInteger||p,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(u){return t.isInteger(u)&&u>=-t.MAX_SAFE_INTEGER&&u<=t.MAX_SAFE_INTEGER}})(ra);Object.defineProperty(ie,"__esModule",{value:!0});var ia=ra;function eu(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=eu;function tu(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=tu;function ru(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=ru;function iu(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=iu;function na(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=na;ie.writeInt16BE=na;function sa(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=sa;ie.writeInt16LE=sa;function bi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=bi;function wi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=wi;function mi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=mi;function vi(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=vi;function qr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=qr;ie.writeInt32BE=qr;function Kr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=Kr;ie.writeInt32LE=Kr;function nu(t,e){e===void 0&&(e=0);var r=bi(t,e),i=bi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=nu;function su(t,e){e===void 0&&(e=0);var r=wi(t,e),i=wi(t,e+4);return r*4294967296+i}ie.readUint64BE=su;function au(t,e){e===void 0&&(e=0);var r=mi(t,e),i=mi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=au;function ou(t,e){e===void 0&&(e=0);var r=vi(t,e),i=vi(t,e+4);return i*4294967296+r}ie.readUint64LE=ou;function aa(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qr(t/4294967296>>>0,e,r),qr(t>>>0,e,r+4),e}ie.writeUint64BE=aa;ie.writeInt64BE=aa;function oa(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Kr(t>>>0,e,r),Kr(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=oa;ie.writeInt64LE=oa;function cu(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,c=t/8+r-1;c>=r;c--)i+=e[c]*n,n*=256;return i}ie.readUintBE=cu;function uu(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,c=r;c<r+t/8;c++)i+=e[c]*n,n*=256;return i}ie.readUintLE=uu;function hu(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!ia.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,c=t/8+i-1;c>=i;c--)r[c]=e/n&255,n*=256;return r}ie.writeUintBE=hu;function lu(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!ia.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,c=i;c<i+t/8;c++)r[c]=e/n&255,n*=256;return r}ie.writeUintLE=lu;function fu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=fu;function du(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=du;function gu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=gu;function pu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=pu;function yu(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=yu;function _u(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=_u;function bu(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=bu;function wu(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=wu;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Yr,r=ie,i=ft;t.defaultRandomSource=new e.SystemRandomSource;function n(O,S=t.defaultRandomSource){return S.randomBytes(O)}t.randomBytes=n;function c(O=t.defaultRandomSource){const S=n(4,O),P=(0,r.readUint32LE)(S);return(0,i.wipe)(S),P}t.randomUint32=c;const p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function u(O,S=p,P=t.defaultRandomSource){if(S.length<2)throw new Error("randomString charset is too short");if(S.length>256)throw new Error("randomString charset is too long");let $="";const N=S.length,A=256-256%N;for(;O>0;){const H=n(Math.ceil(O*256/A),P);for(let M=0;M<H.length&&O>0;M++){const q=H[M];q<A&&($+=S.charAt(q%N),O--)}(0,i.wipe)(H)}return $}t.randomString=u;function g(O,S=p,P=t.defaultRandomSource){const $=Math.ceil(O/(Math.log(S.length)/Math.LN2));return u($,S,P)}t.randomStringForEntropy=g})(ir);var ca={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=ft;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},u.prototype.update=function(g,O){if(O===void 0&&(O=g.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var S=0;if(this._bytesHashed+=O,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&O>0;)this._buffer[this._bufferLength++]=g[S++],O--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(O>=this.blockSize&&(S=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,g,S,O),O%=this.blockSize);O>0;)this._buffer[this._bufferLength++]=g[S++],O--;return this},u.prototype.finish=function(g){if(!this._finished){var O=this._bytesHashed,S=this._bufferLength,P=O/536870912|0,$=O<<3,N=O%128<112?128:256;this._buffer[S]=128;for(var A=S+1;A<N-8;A++)this._buffer[A]=0;e.writeUint32BE(P,this._buffer,N-8),e.writeUint32BE($,this._buffer,N-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)e.writeUint32BE(this._stateHi[A],g,A*8),e.writeUint32BE(this._stateLo[A],g,A*8+4);return this},u.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(g){return this._stateHi.set(g.stateHi),this._stateLo.set(g.stateLo),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(g){r.wipe(g.stateHi),r.wipe(g.stateLo),g.buffer&&r.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},u}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(u,g,O,S,P,$,N){for(var A=O[0],H=O[1],M=O[2],q=O[3],_=O[4],E=O[5],b=O[6],w=O[7],m=S[0],s=S[1],l=S[2],B=S[3],o=S[4],f=S[5],d=S[6],v=S[7],y,h,T,F,z,x,j,K;N>=128;){for(var G=0;G<16;G++){var V=8*G+$;u[G]=e.readUint32BE(P,V),g[G]=e.readUint32BE(P,V+4)}for(var G=0;G<80;G++){var Q=A,J=H,oe=M,L=q,U=_,C=E,a=b,I=w,k=m,X=s,le=l,_e=B,de=o,me=f,Fe=d,Pe=v;if(y=w,h=v,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=(_>>>14|o<<32-14)^(_>>>18|o<<32-18)^(o>>>41-32|_<<32-(41-32)),h=(o>>>14|_<<32-14)^(o>>>18|_<<32-18)^(_>>>41-32|o<<32-(41-32)),z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,y=_&E^~_&b,h=o&f^~o&d,z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,y=n[G*2],h=n[G*2+1],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,y=u[G%16],h=g[G%16],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,T=j&65535|K<<16,F=z&65535|x<<16,y=T,h=F,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=(A>>>28|m<<32-28)^(m>>>34-32|A<<32-(34-32))^(m>>>39-32|A<<32-(39-32)),h=(m>>>28|A<<32-28)^(A>>>34-32|m<<32-(34-32))^(A>>>39-32|m<<32-(39-32)),z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,y=A&H^A&M^H&M,h=m&s^m&l^s&l,z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,I=j&65535|K<<16,Pe=z&65535|x<<16,y=L,h=_e,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=T,h=F,z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,L=j&65535|K<<16,_e=z&65535|x<<16,H=Q,M=J,q=oe,_=L,E=U,b=C,w=a,A=I,s=k,l=X,B=le,o=_e,f=de,d=me,v=Fe,m=Pe,G%16===15)for(var V=0;V<16;V++)y=u[V],h=g[V],z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=u[(V+9)%16],h=g[(V+9)%16],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,T=u[(V+1)%16],F=g[(V+1)%16],y=(T>>>1|F<<32-1)^(T>>>8|F<<32-8)^T>>>7,h=(F>>>1|T<<32-1)^(F>>>8|T<<32-8)^(F>>>7|T<<32-7),z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,T=u[(V+14)%16],F=g[(V+14)%16],y=(T>>>19|F<<32-19)^(F>>>61-32|T<<32-(61-32))^T>>>6,h=(F>>>19|T<<32-19)^(T>>>61-32|F<<32-(61-32))^(F>>>6|T<<32-6),z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,u[V]=j&65535|K<<16,g[V]=z&65535|x<<16}y=A,h=m,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[0],h=S[0],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[0]=A=j&65535|K<<16,S[0]=m=z&65535|x<<16,y=H,h=s,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[1],h=S[1],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[1]=H=j&65535|K<<16,S[1]=s=z&65535|x<<16,y=M,h=l,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[2],h=S[2],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[2]=M=j&65535|K<<16,S[2]=l=z&65535|x<<16,y=q,h=B,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[3],h=S[3],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[3]=q=j&65535|K<<16,S[3]=B=z&65535|x<<16,y=_,h=o,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[4],h=S[4],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[4]=_=j&65535|K<<16,S[4]=o=z&65535|x<<16,y=E,h=f,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[5],h=S[5],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[5]=E=j&65535|K<<16,S[5]=f=z&65535|x<<16,y=b,h=d,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[6],h=S[6],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[6]=b=j&65535|K<<16,S[6]=d=z&65535|x<<16,y=w,h=v,z=h&65535,x=h>>>16,j=y&65535,K=y>>>16,y=O[7],h=S[7],z+=h&65535,x+=h>>>16,j+=y&65535,K+=y>>>16,x+=z>>>16,j+=x>>>16,K+=j>>>16,O[7]=w=j&65535|K<<16,S[7]=v=z&65535|x<<16,$+=128,N-=128}return $}function p(u){var g=new i;g.update(u);var O=g.digest();return g.clean(),O}t.hash=p})(ca);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=ir,r=ca,i=ft;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(L){const U=new Float64Array(16);if(L)for(let C=0;C<L.length;C++)U[C]=L[C];return U}const c=new Uint8Array(32);c[0]=9;const p=n(),u=n([1]),g=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),O=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),S=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),P=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),$=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(L,U){for(let C=0;C<16;C++)L[C]=U[C]|0}function A(L){let U=1;for(let C=0;C<16;C++){let a=L[C]+U+65535;U=Math.floor(a/65536),L[C]=a-U*65536}L[0]+=U-1+37*(U-1)}function H(L,U,C){const a=~(C-1);for(let I=0;I<16;I++){const k=a&(L[I]^U[I]);L[I]^=k,U[I]^=k}}function M(L,U){const C=n(),a=n();for(let I=0;I<16;I++)a[I]=U[I];A(a),A(a),A(a);for(let I=0;I<2;I++){C[0]=a[0]-65517;for(let X=1;X<15;X++)C[X]=a[X]-65535-(C[X-1]>>16&1),C[X-1]&=65535;C[15]=a[15]-32767-(C[14]>>16&1);const k=C[15]>>16&1;C[14]&=65535,H(a,C,1-k)}for(let I=0;I<16;I++)L[2*I]=a[I]&255,L[2*I+1]=a[I]>>8}function q(L,U){let C=0;for(let a=0;a<32;a++)C|=L[a]^U[a];return(1&C-1>>>8)-1}function _(L,U){const C=new Uint8Array(32),a=new Uint8Array(32);return M(C,L),M(a,U),q(C,a)}function E(L){const U=new Uint8Array(32);return M(U,L),U[0]&1}function b(L,U){for(let C=0;C<16;C++)L[C]=U[2*C]+(U[2*C+1]<<8);L[15]&=32767}function w(L,U,C){for(let a=0;a<16;a++)L[a]=U[a]+C[a]}function m(L,U,C){for(let a=0;a<16;a++)L[a]=U[a]-C[a]}function s(L,U,C){let a,I,k=0,X=0,le=0,_e=0,de=0,me=0,Fe=0,Pe=0,ye=0,ge=0,fe=0,ue=0,ce=0,ae=0,se=0,te=0,he=0,pe=0,re=0,be=0,we=0,Ee=0,De=0,ve=0,bt=0,mt=0,Pt=0,ht=0,$t=0,ar=0,Cr=0,Le=C[0],Ne=C[1],Me=C[2],je=C[3],$e=C[4],Ce=C[5],He=C[6],qe=C[7],Ke=C[8],Ve=C[9],Ge=C[10],Be=C[11],ze=C[12],Te=C[13],We=C[14],ke=C[15];a=U[0],k+=a*Le,X+=a*Ne,le+=a*Me,_e+=a*je,de+=a*$e,me+=a*Ce,Fe+=a*He,Pe+=a*qe,ye+=a*Ke,ge+=a*Ve,fe+=a*Ge,ue+=a*Be,ce+=a*ze,ae+=a*Te,se+=a*We,te+=a*ke,a=U[1],X+=a*Le,le+=a*Ne,_e+=a*Me,de+=a*je,me+=a*$e,Fe+=a*Ce,Pe+=a*He,ye+=a*qe,ge+=a*Ke,fe+=a*Ve,ue+=a*Ge,ce+=a*Be,ae+=a*ze,se+=a*Te,te+=a*We,he+=a*ke,a=U[2],le+=a*Le,_e+=a*Ne,de+=a*Me,me+=a*je,Fe+=a*$e,Pe+=a*Ce,ye+=a*He,ge+=a*qe,fe+=a*Ke,ue+=a*Ve,ce+=a*Ge,ae+=a*Be,se+=a*ze,te+=a*Te,he+=a*We,pe+=a*ke,a=U[3],_e+=a*Le,de+=a*Ne,me+=a*Me,Fe+=a*je,Pe+=a*$e,ye+=a*Ce,ge+=a*He,fe+=a*qe,ue+=a*Ke,ce+=a*Ve,ae+=a*Ge,se+=a*Be,te+=a*ze,he+=a*Te,pe+=a*We,re+=a*ke,a=U[4],de+=a*Le,me+=a*Ne,Fe+=a*Me,Pe+=a*je,ye+=a*$e,ge+=a*Ce,fe+=a*He,ue+=a*qe,ce+=a*Ke,ae+=a*Ve,se+=a*Ge,te+=a*Be,he+=a*ze,pe+=a*Te,re+=a*We,be+=a*ke,a=U[5],me+=a*Le,Fe+=a*Ne,Pe+=a*Me,ye+=a*je,ge+=a*$e,fe+=a*Ce,ue+=a*He,ce+=a*qe,ae+=a*Ke,se+=a*Ve,te+=a*Ge,he+=a*Be,pe+=a*ze,re+=a*Te,be+=a*We,we+=a*ke,a=U[6],Fe+=a*Le,Pe+=a*Ne,ye+=a*Me,ge+=a*je,fe+=a*$e,ue+=a*Ce,ce+=a*He,ae+=a*qe,se+=a*Ke,te+=a*Ve,he+=a*Ge,pe+=a*Be,re+=a*ze,be+=a*Te,we+=a*We,Ee+=a*ke,a=U[7],Pe+=a*Le,ye+=a*Ne,ge+=a*Me,fe+=a*je,ue+=a*$e,ce+=a*Ce,ae+=a*He,se+=a*qe,te+=a*Ke,he+=a*Ve,pe+=a*Ge,re+=a*Be,be+=a*ze,we+=a*Te,Ee+=a*We,De+=a*ke,a=U[8],ye+=a*Le,ge+=a*Ne,fe+=a*Me,ue+=a*je,ce+=a*$e,ae+=a*Ce,se+=a*He,te+=a*qe,he+=a*Ke,pe+=a*Ve,re+=a*Ge,be+=a*Be,we+=a*ze,Ee+=a*Te,De+=a*We,ve+=a*ke,a=U[9],ge+=a*Le,fe+=a*Ne,ue+=a*Me,ce+=a*je,ae+=a*$e,se+=a*Ce,te+=a*He,he+=a*qe,pe+=a*Ke,re+=a*Ve,be+=a*Ge,we+=a*Be,Ee+=a*ze,De+=a*Te,ve+=a*We,bt+=a*ke,a=U[10],fe+=a*Le,ue+=a*Ne,ce+=a*Me,ae+=a*je,se+=a*$e,te+=a*Ce,he+=a*He,pe+=a*qe,re+=a*Ke,be+=a*Ve,we+=a*Ge,Ee+=a*Be,De+=a*ze,ve+=a*Te,bt+=a*We,mt+=a*ke,a=U[11],ue+=a*Le,ce+=a*Ne,ae+=a*Me,se+=a*je,te+=a*$e,he+=a*Ce,pe+=a*He,re+=a*qe,be+=a*Ke,we+=a*Ve,Ee+=a*Ge,De+=a*Be,ve+=a*ze,bt+=a*Te,mt+=a*We,Pt+=a*ke,a=U[12],ce+=a*Le,ae+=a*Ne,se+=a*Me,te+=a*je,he+=a*$e,pe+=a*Ce,re+=a*He,be+=a*qe,we+=a*Ke,Ee+=a*Ve,De+=a*Ge,ve+=a*Be,bt+=a*ze,mt+=a*Te,Pt+=a*We,ht+=a*ke,a=U[13],ae+=a*Le,se+=a*Ne,te+=a*Me,he+=a*je,pe+=a*$e,re+=a*Ce,be+=a*He,we+=a*qe,Ee+=a*Ke,De+=a*Ve,ve+=a*Ge,bt+=a*Be,mt+=a*ze,Pt+=a*Te,ht+=a*We,$t+=a*ke,a=U[14],se+=a*Le,te+=a*Ne,he+=a*Me,pe+=a*je,re+=a*$e,be+=a*Ce,we+=a*He,Ee+=a*qe,De+=a*Ke,ve+=a*Ve,bt+=a*Ge,mt+=a*Be,Pt+=a*ze,ht+=a*Te,$t+=a*We,ar+=a*ke,a=U[15],te+=a*Le,he+=a*Ne,pe+=a*Me,re+=a*je,be+=a*$e,we+=a*Ce,Ee+=a*He,De+=a*qe,ve+=a*Ke,bt+=a*Ve,mt+=a*Ge,Pt+=a*Be,ht+=a*ze,$t+=a*Te,ar+=a*We,Cr+=a*ke,k+=38*he,X+=38*pe,le+=38*re,_e+=38*be,de+=38*we,me+=38*Ee,Fe+=38*De,Pe+=38*ve,ye+=38*bt,ge+=38*mt,fe+=38*Pt,ue+=38*ht,ce+=38*$t,ae+=38*ar,se+=38*Cr,I=1,a=k+I+65535,I=Math.floor(a/65536),k=a-I*65536,a=X+I+65535,I=Math.floor(a/65536),X=a-I*65536,a=le+I+65535,I=Math.floor(a/65536),le=a-I*65536,a=_e+I+65535,I=Math.floor(a/65536),_e=a-I*65536,a=de+I+65535,I=Math.floor(a/65536),de=a-I*65536,a=me+I+65535,I=Math.floor(a/65536),me=a-I*65536,a=Fe+I+65535,I=Math.floor(a/65536),Fe=a-I*65536,a=Pe+I+65535,I=Math.floor(a/65536),Pe=a-I*65536,a=ye+I+65535,I=Math.floor(a/65536),ye=a-I*65536,a=ge+I+65535,I=Math.floor(a/65536),ge=a-I*65536,a=fe+I+65535,I=Math.floor(a/65536),fe=a-I*65536,a=ue+I+65535,I=Math.floor(a/65536),ue=a-I*65536,a=ce+I+65535,I=Math.floor(a/65536),ce=a-I*65536,a=ae+I+65535,I=Math.floor(a/65536),ae=a-I*65536,a=se+I+65535,I=Math.floor(a/65536),se=a-I*65536,a=te+I+65535,I=Math.floor(a/65536),te=a-I*65536,k+=I-1+37*(I-1),I=1,a=k+I+65535,I=Math.floor(a/65536),k=a-I*65536,a=X+I+65535,I=Math.floor(a/65536),X=a-I*65536,a=le+I+65535,I=Math.floor(a/65536),le=a-I*65536,a=_e+I+65535,I=Math.floor(a/65536),_e=a-I*65536,a=de+I+65535,I=Math.floor(a/65536),de=a-I*65536,a=me+I+65535,I=Math.floor(a/65536),me=a-I*65536,a=Fe+I+65535,I=Math.floor(a/65536),Fe=a-I*65536,a=Pe+I+65535,I=Math.floor(a/65536),Pe=a-I*65536,a=ye+I+65535,I=Math.floor(a/65536),ye=a-I*65536,a=ge+I+65535,I=Math.floor(a/65536),ge=a-I*65536,a=fe+I+65535,I=Math.floor(a/65536),fe=a-I*65536,a=ue+I+65535,I=Math.floor(a/65536),ue=a-I*65536,a=ce+I+65535,I=Math.floor(a/65536),ce=a-I*65536,a=ae+I+65535,I=Math.floor(a/65536),ae=a-I*65536,a=se+I+65535,I=Math.floor(a/65536),se=a-I*65536,a=te+I+65535,I=Math.floor(a/65536),te=a-I*65536,k+=I-1+37*(I-1),L[0]=k,L[1]=X,L[2]=le,L[3]=_e,L[4]=de,L[5]=me,L[6]=Fe,L[7]=Pe,L[8]=ye,L[9]=ge,L[10]=fe,L[11]=ue,L[12]=ce,L[13]=ae,L[14]=se,L[15]=te}function l(L,U){s(L,U,U)}function B(L,U){const C=n();let a;for(a=0;a<16;a++)C[a]=U[a];for(a=253;a>=0;a--)l(C,C),a!==2&&a!==4&&s(C,C,U);for(a=0;a<16;a++)L[a]=C[a]}function o(L,U){const C=n();let a;for(a=0;a<16;a++)C[a]=U[a];for(a=250;a>=0;a--)l(C,C),a!==1&&s(C,C,U);for(a=0;a<16;a++)L[a]=C[a]}function f(L,U){const C=n(),a=n(),I=n(),k=n(),X=n(),le=n(),_e=n(),de=n(),me=n();m(C,L[1],L[0]),m(me,U[1],U[0]),s(C,C,me),w(a,L[0],L[1]),w(me,U[0],U[1]),s(a,a,me),s(I,L[3],U[3]),s(I,I,O),s(k,L[2],U[2]),w(k,k,k),m(X,a,C),m(le,k,I),w(_e,k,I),w(de,a,C),s(L[0],X,le),s(L[1],de,_e),s(L[2],_e,le),s(L[3],X,de)}function d(L,U,C){for(let a=0;a<4;a++)H(L[a],U[a],C)}function v(L,U){const C=n(),a=n(),I=n();B(I,U[2]),s(C,U[0],I),s(a,U[1],I),M(L,a),L[31]^=E(C)<<7}function y(L,U,C){N(L[0],p),N(L[1],u),N(L[2],u),N(L[3],p);for(let a=255;a>=0;--a){const I=C[a/8|0]>>(a&7)&1;d(L,U,I),f(U,L),f(L,L),d(L,U,I)}}function h(L,U){const C=[n(),n(),n(),n()];N(C[0],S),N(C[1],P),N(C[2],u),s(C[3],S,P),y(L,C,U)}function T(L){if(L.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const U=(0,r.hash)(L);U[0]&=248,U[31]&=127,U[31]|=64;const C=new Uint8Array(32),a=[n(),n(),n(),n()];h(a,U),v(C,a);const I=new Uint8Array(64);return I.set(L),I.set(C,32),{publicKey:C,secretKey:I}}t.generateKeyPairFromSeed=T;function F(L){const U=(0,e.randomBytes)(32,L),C=T(U);return(0,i.wipe)(U),C}t.generateKeyPair=F;function z(L){if(L.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}t.extractPublicKeyFromSecretKey=z;const x=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function j(L,U){let C,a,I,k;for(a=63;a>=32;--a){for(C=0,I=a-32,k=a-12;I<k;++I)U[I]+=C-16*U[a]*x[I-(a-32)],C=Math.floor((U[I]+128)/256),U[I]-=C*256;U[I]+=C,U[a]=0}for(C=0,I=0;I<32;I++)U[I]+=C-(U[31]>>4)*x[I],C=U[I]>>8,U[I]&=255;for(I=0;I<32;I++)U[I]-=C*x[I];for(a=0;a<32;a++)U[a+1]+=U[a]>>8,L[a]=U[a]&255}function K(L){const U=new Float64Array(64);for(let C=0;C<64;C++)U[C]=L[C];for(let C=0;C<64;C++)L[C]=0;j(L,U)}function G(L,U){const C=new Float64Array(64),a=[n(),n(),n(),n()],I=(0,r.hash)(L.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const k=new Uint8Array(64);k.set(I.subarray(32),32);const X=new r.SHA512;X.update(k.subarray(32)),X.update(U);const le=X.digest();X.clean(),K(le),h(a,le),v(k,a),X.reset(),X.update(k.subarray(0,32)),X.update(L.subarray(32)),X.update(U);const _e=X.digest();K(_e);for(let de=0;de<32;de++)C[de]=le[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)C[de+me]+=_e[de]*I[me];return j(k.subarray(32),C),k}t.sign=G;function V(L,U){const C=n(),a=n(),I=n(),k=n(),X=n(),le=n(),_e=n();return N(L[2],u),b(L[1],U),l(I,L[1]),s(k,I,g),m(I,I,L[2]),w(k,L[2],k),l(X,k),l(le,X),s(_e,le,X),s(C,_e,I),s(C,C,k),o(C,C),s(C,C,I),s(C,C,k),s(C,C,k),s(L[0],C,k),l(a,L[0]),s(a,a,k),_(a,I)&&s(L[0],L[0],$),l(a,L[0]),s(a,a,k),_(a,I)?-1:(E(L[0])===U[31]>>7&&m(L[0],p,L[0]),s(L[3],L[0],L[1]),0)}function Q(L,U,C){const a=new Uint8Array(32),I=[n(),n(),n(),n()],k=[n(),n(),n(),n()];if(C.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(V(k,L))return!1;const X=new r.SHA512;X.update(C.subarray(0,32)),X.update(L),X.update(U);const le=X.digest();return K(le),y(I,k,le),h(k,C.subarray(32)),f(I,k),v(a,I),!q(C,a)}t.verify=Q;function J(L){let U=[n(),n(),n(),n()];if(V(U,L))throw new Error("Ed25519: invalid public key");let C=n(),a=n(),I=U[1];w(C,u,I),m(a,u,I),B(a,a),s(C,C,a);let k=new Uint8Array(32);return M(k,C),k}t.convertPublicKeyToX25519=J;function oe(L){const U=(0,r.hash)(L.subarray(0,32));U[0]&=248,U[31]&=127,U[31]|=64;const C=new Uint8Array(U.subarray(0,32));return(0,i.wipe)(U),C}t.convertSecretKeyToX25519=oe})(Hi);const mu="EdDSA",vu="JWT",ua=".",ha="base64url",Eu="utf8",Du="utf8",Su=":",Ou="did",xu="key",zn="base58btc",Iu="z",Tu="K36",Au=32;function la(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Ei(t,e){e||(e=t.reduce((n,c)=>n+c.length,0));const r=la(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return r}function Pu(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var c=t.charAt(n),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=n}var u=t.length,g=t.charAt(0),O=Math.log(u)/Math.log(256),S=Math.log(256)/Math.log(u);function P(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var H=0,M=0,q=0,_=A.length;q!==_&&A[q]===0;)q++,H++;for(var E=(_-q)*S+1>>>0,b=new Uint8Array(E);q!==_;){for(var w=A[q],m=0,s=E-1;(w!==0||m<M)&&s!==-1;s--,m++)w+=256*b[s]>>>0,b[s]=w%u>>>0,w=w/u>>>0;if(w!==0)throw new Error("Non-zero carry");M=m,q++}for(var l=E-M;l!==E&&b[l]===0;)l++;for(var B=g.repeat(H);l<E;++l)B+=t.charAt(b[l]);return B}function $(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var H=0;if(A[H]!==" "){for(var M=0,q=0;A[H]===g;)M++,H++;for(var _=(A.length-H)*O+1>>>0,E=new Uint8Array(_);A[H];){var b=r[A.charCodeAt(H)];if(b===255)return;for(var w=0,m=_-1;(b!==0||w<q)&&m!==-1;m--,w++)b+=u*E[m]>>>0,E[m]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");q=w,H++}if(A[H]!==" "){for(var s=_-q;s!==_&&E[s]===0;)s++;for(var l=new Uint8Array(M+(_-s)),B=M;s!==_;)l[B++]=E[s++];return l}}}function N(A){var H=$(A);if(H)return H;throw new Error(`Non-${e} character`)}return{encode:P,decodeUnsafe:$,decode:N}}var Nu=Pu,Cu=Nu;const fa=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Ru=t=>new TextEncoder().encode(t),Fu=t=>new TextDecoder().decode(t);class Uu{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Lu{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return da(this,e)}}class Mu{constructor(e){this.decoders=e}or(e){return da(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const da=(t,e)=>new Mu({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class ju{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Uu(e,r,i),this.decoder=new Lu(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zr=({name:t,prefix:e,encode:r,decode:i})=>new ju(t,e,r,i),Ir=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Cu(r,e);return Zr({prefix:t,name:e,encode:i,decode:c=>fa(n(c))})},$u=(t,e,r,i)=>{const n={};for(let S=0;S<e.length;++S)n[e[S]]=S;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let u=0,g=0,O=0;for(let S=0;S<c;++S){const P=n[t[S]];if(P===void 0)throw new SyntaxError(`Non-${i} character`);g=g<<r|P,u+=r,u>=8&&(u-=8,p[O++]=255&g>>u)}if(u>=r||255&g<<8-u)throw new SyntaxError("Unexpected end of data");return p},zu=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let c="",p=0,u=0;for(let g=0;g<t.length;++g)for(u=u<<8|t[g],p+=8;p>r;)p-=r,c+=e[n&u>>p];if(p&&(c+=e[n&u<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Qe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Zr({prefix:e,name:t,encode(n){return zu(n,i,r)},decode(n){return $u(n,i,r,t)}}),Bu=Zr({prefix:"\0",name:"identity",encode:t=>Fu(t),decode:t=>Ru(t)}),Hu=Object.freeze(Object.defineProperty({__proto__:null,identity:Bu},Symbol.toStringTag,{value:"Module"})),qu=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ku=Object.freeze(Object.defineProperty({__proto__:null,base2:qu},Symbol.toStringTag,{value:"Module"})),Vu=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Gu=Object.freeze(Object.defineProperty({__proto__:null,base8:Vu},Symbol.toStringTag,{value:"Module"})),Wu=Ir({prefix:"9",name:"base10",alphabet:"0123456789"}),ku=Object.freeze(Object.defineProperty({__proto__:null,base10:Wu},Symbol.toStringTag,{value:"Module"})),Yu=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ju=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Xu=Object.freeze(Object.defineProperty({__proto__:null,base16:Yu,base16upper:Ju},Symbol.toStringTag,{value:"Module"})),Zu=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Qu=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),eh=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),th=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rh=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ih=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nh=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sh=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ah=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),oh=Object.freeze(Object.defineProperty({__proto__:null,base32:Zu,base32upper:Qu,base32pad:eh,base32padupper:th,base32hex:rh,base32hexupper:ih,base32hexpad:nh,base32hexpadupper:sh,base32z:ah},Symbol.toStringTag,{value:"Module"})),ch=Ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uh=Ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),hh=Object.freeze(Object.defineProperty({__proto__:null,base36:ch,base36upper:uh},Symbol.toStringTag,{value:"Module"})),lh=Ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fh=Ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),dh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:lh,base58flickr:fh},Symbol.toStringTag,{value:"Module"})),gh=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ph=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yh=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),_h=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),bh=Object.freeze(Object.defineProperty({__proto__:null,base64:gh,base64pad:ph,base64url:yh,base64urlpad:_h},Symbol.toStringTag,{value:"Module"})),ga=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),wh=ga.reduce((t,e,r)=>(t[r]=e,t),[]),mh=ga.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function vh(t){return t.reduce((e,r)=>(e+=wh[r],e),"")}function Eh(t){const e=[];for(const r of t){const i=mh[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Dh=Zr({prefix:"\u{1F680}",name:"base256emoji",encode:vh,decode:Eh}),Sh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Dh},Symbol.toStringTag,{value:"Module"}));var Oh=pa,Bn=128,xh=127,Ih=~xh,Th=Math.pow(2,31);function pa(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Th;)e[r++]=t&255|Bn,t/=128;for(;t&Ih;)e[r++]=t&255|Bn,t>>>=7;return e[r]=t|0,pa.bytes=r-i+1,e}var Ah=Di,Ph=128,Hn=127;function Di(t,i){var r=0,i=i||0,n=0,c=i,p,u=t.length;do{if(c>=u)throw Di.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=n<28?(p&Hn)<<n:(p&Hn)*Math.pow(2,n),n+=7}while(p>=Ph);return Di.bytes=c-i,r}var Nh=Math.pow(2,7),Ch=Math.pow(2,14),Rh=Math.pow(2,21),Fh=Math.pow(2,28),Uh=Math.pow(2,35),Lh=Math.pow(2,42),Mh=Math.pow(2,49),jh=Math.pow(2,56),$h=Math.pow(2,63),zh=function(t){return t<Nh?1:t<Ch?2:t<Rh?3:t<Fh?4:t<Uh?5:t<Lh?6:t<Mh?7:t<jh?8:t<$h?9:10},Bh={encode:Oh,decode:Ah,encodingLength:zh},ya=Bh;const qn=(t,e,r=0)=>(ya.encode(t,e,r),e),Kn=t=>ya.encodingLength(t),Si=(t,e)=>{const r=e.byteLength,i=Kn(t),n=i+Kn(r),c=new Uint8Array(n+r);return qn(t,c,0),qn(r,c,i),c.set(e,n),new Hh(t,r,e,c)};class Hh{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const _a=({name:t,code:e,encode:r})=>new qh(t,e,r);class qh{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Si(this.code,r):r.then(i=>Si(this.code,i))}else throw Error("Unknown type, must be binary type")}}const ba=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Kh=_a({name:"sha2-256",code:18,encode:ba("SHA-256")}),Vh=_a({name:"sha2-512",code:19,encode:ba("SHA-512")}),Gh=Object.freeze(Object.defineProperty({__proto__:null,sha256:Kh,sha512:Vh},Symbol.toStringTag,{value:"Module"})),wa=0,Wh="identity",ma=fa,kh=t=>Si(wa,ma(t)),Yh={code:wa,name:Wh,encode:ma,digest:kh},Jh=Object.freeze(Object.defineProperty({__proto__:null,identity:Yh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Vn={...Hu,...Ku,...Gu,...ku,...Xu,...oh,...hh,...dh,...bh,...Sh};({...Gh,...Jh});function va(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Gn=va("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),fi=va("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=la(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ea={utf8:Gn,"utf-8":Gn,hex:Vn.base16,latin1:fi,ascii:fi,binary:fi,...Vn};function ut(t,e="utf8"){const r=Ea[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ot(t,e="utf8"){const r=Ea[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function Vr(t){return ut(ot(Ui(t),Eu),ha)}function Da(t){const e=ot(Tu,zn),r=Iu+ut(Ei([e,t]),zn);return[Ou,xu,r].join(Su)}function Xh(t){return ut(t,ha)}function Zh(t){return ot([Vr(t.header),Vr(t.payload)].join(ua),Du)}function Qh(t){return[Vr(t.header),Vr(t.payload),Xh(t.signature)].join(ua)}function Wn(t=ir.randomBytes(Au)){return Hi.generateKeyPairFromSeed(t)}async function el(t,e,r,i,n=ee.fromMiliseconds(Date.now())){const c={alg:mu,typ:vu},p=Da(i.publicKey),u=n+r,g={iss:p,sub:t,aud:e,iat:n,exp:u},O=Zh({header:c,payload:g}),S=Hi.sign(i.secretKey,O);return Qh({header:c,payload:g,signature:S})}var qi={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});var rt=ie,Oi=ft,tl=20;function rl(t,e,r){for(var i=1634760805,n=857760878,c=2036477234,p=1797285236,u=r[3]<<24|r[2]<<16|r[1]<<8|r[0],g=r[7]<<24|r[6]<<16|r[5]<<8|r[4],O=r[11]<<24|r[10]<<16|r[9]<<8|r[8],S=r[15]<<24|r[14]<<16|r[13]<<8|r[12],P=r[19]<<24|r[18]<<16|r[17]<<8|r[16],$=r[23]<<24|r[22]<<16|r[21]<<8|r[20],N=r[27]<<24|r[26]<<16|r[25]<<8|r[24],A=r[31]<<24|r[30]<<16|r[29]<<8|r[28],H=e[3]<<24|e[2]<<16|e[1]<<8|e[0],M=e[7]<<24|e[6]<<16|e[5]<<8|e[4],q=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],E=i,b=n,w=c,m=p,s=u,l=g,B=O,o=S,f=P,d=$,v=N,y=A,h=H,T=M,F=q,z=_,x=0;x<tl;x+=2)E=E+s|0,h^=E,h=h>>>32-16|h<<16,f=f+h|0,s^=f,s=s>>>32-12|s<<12,b=b+l|0,T^=b,T=T>>>32-16|T<<16,d=d+T|0,l^=d,l=l>>>32-12|l<<12,w=w+B|0,F^=w,F=F>>>32-16|F<<16,v=v+F|0,B^=v,B=B>>>32-12|B<<12,m=m+o|0,z^=m,z=z>>>32-16|z<<16,y=y+z|0,o^=y,o=o>>>32-12|o<<12,w=w+B|0,F^=w,F=F>>>32-8|F<<8,v=v+F|0,B^=v,B=B>>>32-7|B<<7,m=m+o|0,z^=m,z=z>>>32-8|z<<8,y=y+z|0,o^=y,o=o>>>32-7|o<<7,b=b+l|0,T^=b,T=T>>>32-8|T<<8,d=d+T|0,l^=d,l=l>>>32-7|l<<7,E=E+s|0,h^=E,h=h>>>32-8|h<<8,f=f+h|0,s^=f,s=s>>>32-7|s<<7,E=E+l|0,z^=E,z=z>>>32-16|z<<16,v=v+z|0,l^=v,l=l>>>32-12|l<<12,b=b+B|0,h^=b,h=h>>>32-16|h<<16,y=y+h|0,B^=y,B=B>>>32-12|B<<12,w=w+o|0,T^=w,T=T>>>32-16|T<<16,f=f+T|0,o^=f,o=o>>>32-12|o<<12,m=m+s|0,F^=m,F=F>>>32-16|F<<16,d=d+F|0,s^=d,s=s>>>32-12|s<<12,w=w+o|0,T^=w,T=T>>>32-8|T<<8,f=f+T|0,o^=f,o=o>>>32-7|o<<7,m=m+s|0,F^=m,F=F>>>32-8|F<<8,d=d+F|0,s^=d,s=s>>>32-7|s<<7,b=b+B|0,h^=b,h=h>>>32-8|h<<8,y=y+h|0,B^=y,B=B>>>32-7|B<<7,E=E+l|0,z^=E,z=z>>>32-8|z<<8,v=v+z|0,l^=v,l=l>>>32-7|l<<7;rt.writeUint32LE(E+i|0,t,0),rt.writeUint32LE(b+n|0,t,4),rt.writeUint32LE(w+c|0,t,8),rt.writeUint32LE(m+p|0,t,12),rt.writeUint32LE(s+u|0,t,16),rt.writeUint32LE(l+g|0,t,20),rt.writeUint32LE(B+O|0,t,24),rt.writeUint32LE(o+S|0,t,28),rt.writeUint32LE(f+P|0,t,32),rt.writeUint32LE(d+$|0,t,36),rt.writeUint32LE(v+N|0,t,40),rt.writeUint32LE(y+A|0,t,44),rt.writeUint32LE(h+H|0,t,48),rt.writeUint32LE(T+M|0,t,52),rt.writeUint32LE(F+q|0,t,56),rt.writeUint32LE(z+_|0,t,60)}function Sa(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,p;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),p=c.length-e.length,c.set(e,p)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,p=n}for(var u=new Uint8Array(64),g=0;g<r.length;g+=64){rl(u,c,t);for(var O=g;O<g+64&&O<r.length;O++)i[O]=r[O]^u[O-g];nl(c,0,p)}return Oi.wipe(u),n===0&&Oi.wipe(c),i}Qr.streamXOR=Sa;function il(t,e,r,i){return i===void 0&&(i=0),Oi.wipe(r),Sa(t,e,r,r,i)}Qr.stream=il;function nl(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var Oa={},jt={};Object.defineProperty(jt,"__esModule",{value:!0});function sl(t,e,r){return~(t-1)&e|t-1&r}jt.select=sl;function al(t,e){return(t|0)-(e|0)-1>>>31&1}jt.lessOrEqual=al;function xa(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}jt.compare=xa;function ol(t,e){return t.length===0||e.length===0?!1:xa(t,e)!==0}jt.equal=ol;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=jt,r=ft;t.DIGEST_LENGTH=16;var i=function(){function p(u){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var g=u[0]|u[1]<<8;this._r[0]=g&8191;var O=u[2]|u[3]<<8;this._r[1]=(g>>>13|O<<3)&8191;var S=u[4]|u[5]<<8;this._r[2]=(O>>>10|S<<6)&7939;var P=u[6]|u[7]<<8;this._r[3]=(S>>>7|P<<9)&8191;var $=u[8]|u[9]<<8;this._r[4]=(P>>>4|$<<12)&255,this._r[5]=$>>>1&8190;var N=u[10]|u[11]<<8;this._r[6]=($>>>14|N<<2)&8191;var A=u[12]|u[13]<<8;this._r[7]=(N>>>11|A<<5)&8065;var H=u[14]|u[15]<<8;this._r[8]=(A>>>8|H<<8)&8191,this._r[9]=H>>>5&127,this._pad[0]=u[16]|u[17]<<8,this._pad[1]=u[18]|u[19]<<8,this._pad[2]=u[20]|u[21]<<8,this._pad[3]=u[22]|u[23]<<8,this._pad[4]=u[24]|u[25]<<8,this._pad[5]=u[26]|u[27]<<8,this._pad[6]=u[28]|u[29]<<8,this._pad[7]=u[30]|u[31]<<8}return p.prototype._blocks=function(u,g,O){for(var S=this._fin?0:2048,P=this._h[0],$=this._h[1],N=this._h[2],A=this._h[3],H=this._h[4],M=this._h[5],q=this._h[6],_=this._h[7],E=this._h[8],b=this._h[9],w=this._r[0],m=this._r[1],s=this._r[2],l=this._r[3],B=this._r[4],o=this._r[5],f=this._r[6],d=this._r[7],v=this._r[8],y=this._r[9];O>=16;){var h=u[g+0]|u[g+1]<<8;P+=h&8191;var T=u[g+2]|u[g+3]<<8;$+=(h>>>13|T<<3)&8191;var F=u[g+4]|u[g+5]<<8;N+=(T>>>10|F<<6)&8191;var z=u[g+6]|u[g+7]<<8;A+=(F>>>7|z<<9)&8191;var x=u[g+8]|u[g+9]<<8;H+=(z>>>4|x<<12)&8191,M+=x>>>1&8191;var j=u[g+10]|u[g+11]<<8;q+=(x>>>14|j<<2)&8191;var K=u[g+12]|u[g+13]<<8;_+=(j>>>11|K<<5)&8191;var G=u[g+14]|u[g+15]<<8;E+=(K>>>8|G<<8)&8191,b+=G>>>5|S;var V=0,Q=V;Q+=P*w,Q+=$*(5*y),Q+=N*(5*v),Q+=A*(5*d),Q+=H*(5*f),V=Q>>>13,Q&=8191,Q+=M*(5*o),Q+=q*(5*B),Q+=_*(5*l),Q+=E*(5*s),Q+=b*(5*m),V+=Q>>>13,Q&=8191;var J=V;J+=P*m,J+=$*w,J+=N*(5*y),J+=A*(5*v),J+=H*(5*d),V=J>>>13,J&=8191,J+=M*(5*f),J+=q*(5*o),J+=_*(5*B),J+=E*(5*l),J+=b*(5*s),V+=J>>>13,J&=8191;var oe=V;oe+=P*s,oe+=$*m,oe+=N*w,oe+=A*(5*y),oe+=H*(5*v),V=oe>>>13,oe&=8191,oe+=M*(5*d),oe+=q*(5*f),oe+=_*(5*o),oe+=E*(5*B),oe+=b*(5*l),V+=oe>>>13,oe&=8191;var L=V;L+=P*l,L+=$*s,L+=N*m,L+=A*w,L+=H*(5*y),V=L>>>13,L&=8191,L+=M*(5*v),L+=q*(5*d),L+=_*(5*f),L+=E*(5*o),L+=b*(5*B),V+=L>>>13,L&=8191;var U=V;U+=P*B,U+=$*l,U+=N*s,U+=A*m,U+=H*w,V=U>>>13,U&=8191,U+=M*(5*y),U+=q*(5*v),U+=_*(5*d),U+=E*(5*f),U+=b*(5*o),V+=U>>>13,U&=8191;var C=V;C+=P*o,C+=$*B,C+=N*l,C+=A*s,C+=H*m,V=C>>>13,C&=8191,C+=M*w,C+=q*(5*y),C+=_*(5*v),C+=E*(5*d),C+=b*(5*f),V+=C>>>13,C&=8191;var a=V;a+=P*f,a+=$*o,a+=N*B,a+=A*l,a+=H*s,V=a>>>13,a&=8191,a+=M*m,a+=q*w,a+=_*(5*y),a+=E*(5*v),a+=b*(5*d),V+=a>>>13,a&=8191;var I=V;I+=P*d,I+=$*f,I+=N*o,I+=A*B,I+=H*l,V=I>>>13,I&=8191,I+=M*s,I+=q*m,I+=_*w,I+=E*(5*y),I+=b*(5*v),V+=I>>>13,I&=8191;var k=V;k+=P*v,k+=$*d,k+=N*f,k+=A*o,k+=H*B,V=k>>>13,k&=8191,k+=M*l,k+=q*s,k+=_*m,k+=E*w,k+=b*(5*y),V+=k>>>13,k&=8191;var X=V;X+=P*y,X+=$*v,X+=N*d,X+=A*f,X+=H*o,V=X>>>13,X&=8191,X+=M*B,X+=q*l,X+=_*s,X+=E*m,X+=b*w,V+=X>>>13,X&=8191,V=(V<<2)+V|0,V=V+Q|0,Q=V&8191,V=V>>>13,J+=V,P=Q,$=J,N=oe,A=L,H=U,M=C,q=a,_=I,E=k,b=X,g+=16,O-=16}this._h[0]=P,this._h[1]=$,this._h[2]=N,this._h[3]=A,this._h[4]=H,this._h[5]=M,this._h[6]=q,this._h[7]=_,this._h[8]=E,this._h[9]=b},p.prototype.finish=function(u,g){g===void 0&&(g=0);var O=new Uint16Array(10),S,P,$,N;if(this._leftover){for(N=this._leftover,this._buffer[N++]=1;N<16;N++)this._buffer[N]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(S=this._h[1]>>>13,this._h[1]&=8191,N=2;N<10;N++)this._h[N]+=S,S=this._h[N]>>>13,this._h[N]&=8191;for(this._h[0]+=S*5,S=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=S,S=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=S,O[0]=this._h[0]+5,S=O[0]>>>13,O[0]&=8191,N=1;N<10;N++)O[N]=this._h[N]+S,S=O[N]>>>13,O[N]&=8191;for(O[9]-=1<<13,P=(S^1)-1,N=0;N<10;N++)O[N]&=P;for(P=~P,N=0;N<10;N++)this._h[N]=this._h[N]&P|O[N];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,$=this._h[0]+this._pad[0],this._h[0]=$&65535,N=1;N<8;N++)$=(this._h[N]+this._pad[N]|0)+($>>>16)|0,this._h[N]=$&65535;return u[g+0]=this._h[0]>>>0,u[g+1]=this._h[0]>>>8,u[g+2]=this._h[1]>>>0,u[g+3]=this._h[1]>>>8,u[g+4]=this._h[2]>>>0,u[g+5]=this._h[2]>>>8,u[g+6]=this._h[3]>>>0,u[g+7]=this._h[3]>>>8,u[g+8]=this._h[4]>>>0,u[g+9]=this._h[4]>>>8,u[g+10]=this._h[5]>>>0,u[g+11]=this._h[5]>>>8,u[g+12]=this._h[6]>>>0,u[g+13]=this._h[6]>>>8,u[g+14]=this._h[7]>>>0,u[g+15]=this._h[7]>>>8,this._finished=!0,this},p.prototype.update=function(u){var g=0,O=u.length,S;if(this._leftover){S=16-this._leftover,S>O&&(S=O);for(var P=0;P<S;P++)this._buffer[this._leftover+P]=u[g+P];if(O-=S,g+=S,this._leftover+=S,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(O>=16&&(S=O-O%16,this._blocks(u,g,S),g+=S,O-=S),O){for(var P=0;P<O;P++)this._buffer[this._leftover+P]=u[g+P];this._leftover+=O}return this},p.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var u=new Uint8Array(16);return this.finish(u),u},p.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},p}();t.Poly1305=i;function n(p,u){var g=new i(p);g.update(u);var O=g.digest();return g.clean(),O}t.oneTimeAuth=n;function c(p,u){return p.length!==t.DIGEST_LENGTH||u.length!==t.DIGEST_LENGTH?!1:e.equal(p,u)}t.equal=c})(Oa);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qr,r=Oa,i=ft,n=ie,c=jt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var p=new Uint8Array(16),u=function(){function g(O){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,O.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(O)}return g.prototype.seal=function(O,S,P,$){if(O.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var N=new Uint8Array(16);N.set(O,N.length-O.length);var A=new Uint8Array(32);e.stream(this._key,N,A,4);var H=S.length+this.tagLength,M;if($){if($.length!==H)throw new Error("ChaCha20Poly1305: incorrect destination length");M=$}else M=new Uint8Array(H);return e.streamXOR(this._key,N,S,M,4),this._authenticate(M.subarray(M.length-this.tagLength,M.length),A,M.subarray(0,M.length-this.tagLength),P),i.wipe(N),M},g.prototype.open=function(O,S,P,$){if(O.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(S.length<this.tagLength)return null;var N=new Uint8Array(16);N.set(O,N.length-O.length);var A=new Uint8Array(32);e.stream(this._key,N,A,4);var H=new Uint8Array(this.tagLength);if(this._authenticate(H,A,S.subarray(0,S.length-this.tagLength),P),!c.equal(H,S.subarray(S.length-this.tagLength,S.length)))return null;var M=S.length-this.tagLength,q;if($){if($.length!==M)throw new Error("ChaCha20Poly1305: incorrect destination length");q=$}else q=new Uint8Array(M);return e.streamXOR(this._key,N,S.subarray(0,S.length-this.tagLength),q,4),i.wipe(N),q},g.prototype.clean=function(){return i.wipe(this._key),this},g.prototype._authenticate=function(O,S,P,$){var N=new r.Poly1305(S);$&&(N.update($),$.length%16>0&&N.update(p.subarray($.length%16))),N.update(P),P.length%16>0&&N.update(p.subarray(P.length%16));var A=new Uint8Array(8);$&&n.writeUint64LE($.length,A),N.update(A),n.writeUint64LE(P.length,A),N.update(A);for(var H=N.digest(),M=0;M<H.length;M++)O[M]=H[M];N.clean(),i.wipe(H),i.wipe(A)},g}();t.ChaCha20Poly1305=u})(qi);var Ia={},Tr={},Ki={};Object.defineProperty(Ki,"__esModule",{value:!0});function cl(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Ki.isSerializableHash=cl;Object.defineProperty(Tr,"__esModule",{value:!0});var vt=Ki,ul=jt,hl=ft,Ta=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),vt.isSerializableHash(this._inner)&&vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),hl.wipe(i)}return t.prototype.reset=function(){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Tr.HMAC=Ta;function ll(t,e,r){var i=new Ta(t,e);i.update(r);var n=i.digest();return i.clean(),n}Tr.hmac=ll;Tr.equal=ul.equal;Object.defineProperty(Ia,"__esModule",{value:!0});var kn=Tr,Yn=ft,fl=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var c=kn.hmac(this._hash,i,r);this._hmac=new kn.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),Yn.wipe(this._buffer),Yn.wipe(this._counter),this._bufpos=0},t}(),dl=Ia.HKDF=fl,ei={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=ft;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},u.prototype.update=function(g,O){if(O===void 0&&(O=g.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var S=0;if(this._bytesHashed+=O,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&O>0;)this._buffer[this._bufferLength++]=g[S++],O--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(O>=this.blockSize&&(S=c(this._temp,this._state,g,S,O),O%=this.blockSize);O>0;)this._buffer[this._bufferLength++]=g[S++],O--;return this},u.prototype.finish=function(g){if(!this._finished){var O=this._bytesHashed,S=this._bufferLength,P=O/536870912|0,$=O<<3,N=O%64<56?64:128;this._buffer[S]=128;for(var A=S+1;A<N-8;A++)this._buffer[A]=0;e.writeUint32BE(P,this._buffer,N-8),e.writeUint32BE($,this._buffer,N-4),c(this._temp,this._state,this._buffer,0,N),this._finished=!0}for(var A=0;A<this.digestLength/4;A++)e.writeUint32BE(this._state[A],g,A*4);return this},u.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(g){return this._state.set(g.state),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(g){r.wipe(g.state),g.buffer&&r.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},u}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(u,g,O,S,P){for(;P>=64;){for(var $=g[0],N=g[1],A=g[2],H=g[3],M=g[4],q=g[5],_=g[6],E=g[7],b=0;b<16;b++){var w=S+b*4;u[b]=e.readUint32BE(O,w)}for(var b=16;b<64;b++){var m=u[b-2],s=(m>>>17|m<<32-17)^(m>>>19|m<<32-19)^m>>>10;m=u[b-15];var l=(m>>>7|m<<32-7)^(m>>>18|m<<32-18)^m>>>3;u[b]=(s+u[b-7]|0)+(l+u[b-16]|0)}for(var b=0;b<64;b++){var s=(((M>>>6|M<<26)^(M>>>11|M<<21)^(M>>>25|M<<7))+(M&q^~M&_)|0)+(E+(n[b]+u[b]|0)|0)|0,l=(($>>>2|$<<32-2)^($>>>13|$<<32-13)^($>>>22|$<<32-22))+($&N^$&A^N&A)|0;E=_,_=q,q=M,M=H+s|0,H=A,A=N,N=$,$=s+l|0}g[0]+=$,g[1]+=N,g[2]+=A,g[3]+=H,g[4]+=M,g[5]+=q,g[6]+=_,g[7]+=E,S+=64,P-=64}return S}function p(u){var g=new i;g.update(u);var O=g.digest();return g.clean(),O}t.hash=p})(ei);var Vi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=ir,r=ft;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(b){const w=new Float64Array(16);if(b)for(let m=0;m<b.length;m++)w[m]=b[m];return w}const n=new Uint8Array(32);n[0]=9;const c=i([56129,1]);function p(b){let w=1;for(let m=0;m<16;m++){let s=b[m]+w+65535;w=Math.floor(s/65536),b[m]=s-w*65536}b[0]+=w-1+37*(w-1)}function u(b,w,m){const s=~(m-1);for(let l=0;l<16;l++){const B=s&(b[l]^w[l]);b[l]^=B,w[l]^=B}}function g(b,w){const m=i(),s=i();for(let l=0;l<16;l++)s[l]=w[l];p(s),p(s),p(s);for(let l=0;l<2;l++){m[0]=s[0]-65517;for(let o=1;o<15;o++)m[o]=s[o]-65535-(m[o-1]>>16&1),m[o-1]&=65535;m[15]=s[15]-32767-(m[14]>>16&1);const B=m[15]>>16&1;m[14]&=65535,u(s,m,1-B)}for(let l=0;l<16;l++)b[2*l]=s[l]&255,b[2*l+1]=s[l]>>8}function O(b,w){for(let m=0;m<16;m++)b[m]=w[2*m]+(w[2*m+1]<<8);b[15]&=32767}function S(b,w,m){for(let s=0;s<16;s++)b[s]=w[s]+m[s]}function P(b,w,m){for(let s=0;s<16;s++)b[s]=w[s]-m[s]}function $(b,w,m){let s,l,B=0,o=0,f=0,d=0,v=0,y=0,h=0,T=0,F=0,z=0,x=0,j=0,K=0,G=0,V=0,Q=0,J=0,oe=0,L=0,U=0,C=0,a=0,I=0,k=0,X=0,le=0,_e=0,de=0,me=0,Fe=0,Pe=0,ye=m[0],ge=m[1],fe=m[2],ue=m[3],ce=m[4],ae=m[5],se=m[6],te=m[7],he=m[8],pe=m[9],re=m[10],be=m[11],we=m[12],Ee=m[13],De=m[14],ve=m[15];s=w[0],B+=s*ye,o+=s*ge,f+=s*fe,d+=s*ue,v+=s*ce,y+=s*ae,h+=s*se,T+=s*te,F+=s*he,z+=s*pe,x+=s*re,j+=s*be,K+=s*we,G+=s*Ee,V+=s*De,Q+=s*ve,s=w[1],o+=s*ye,f+=s*ge,d+=s*fe,v+=s*ue,y+=s*ce,h+=s*ae,T+=s*se,F+=s*te,z+=s*he,x+=s*pe,j+=s*re,K+=s*be,G+=s*we,V+=s*Ee,Q+=s*De,J+=s*ve,s=w[2],f+=s*ye,d+=s*ge,v+=s*fe,y+=s*ue,h+=s*ce,T+=s*ae,F+=s*se,z+=s*te,x+=s*he,j+=s*pe,K+=s*re,G+=s*be,V+=s*we,Q+=s*Ee,J+=s*De,oe+=s*ve,s=w[3],d+=s*ye,v+=s*ge,y+=s*fe,h+=s*ue,T+=s*ce,F+=s*ae,z+=s*se,x+=s*te,j+=s*he,K+=s*pe,G+=s*re,V+=s*be,Q+=s*we,J+=s*Ee,oe+=s*De,L+=s*ve,s=w[4],v+=s*ye,y+=s*ge,h+=s*fe,T+=s*ue,F+=s*ce,z+=s*ae,x+=s*se,j+=s*te,K+=s*he,G+=s*pe,V+=s*re,Q+=s*be,J+=s*we,oe+=s*Ee,L+=s*De,U+=s*ve,s=w[5],y+=s*ye,h+=s*ge,T+=s*fe,F+=s*ue,z+=s*ce,x+=s*ae,j+=s*se,K+=s*te,G+=s*he,V+=s*pe,Q+=s*re,J+=s*be,oe+=s*we,L+=s*Ee,U+=s*De,C+=s*ve,s=w[6],h+=s*ye,T+=s*ge,F+=s*fe,z+=s*ue,x+=s*ce,j+=s*ae,K+=s*se,G+=s*te,V+=s*he,Q+=s*pe,J+=s*re,oe+=s*be,L+=s*we,U+=s*Ee,C+=s*De,a+=s*ve,s=w[7],T+=s*ye,F+=s*ge,z+=s*fe,x+=s*ue,j+=s*ce,K+=s*ae,G+=s*se,V+=s*te,Q+=s*he,J+=s*pe,oe+=s*re,L+=s*be,U+=s*we,C+=s*Ee,a+=s*De,I+=s*ve,s=w[8],F+=s*ye,z+=s*ge,x+=s*fe,j+=s*ue,K+=s*ce,G+=s*ae,V+=s*se,Q+=s*te,J+=s*he,oe+=s*pe,L+=s*re,U+=s*be,C+=s*we,a+=s*Ee,I+=s*De,k+=s*ve,s=w[9],z+=s*ye,x+=s*ge,j+=s*fe,K+=s*ue,G+=s*ce,V+=s*ae,Q+=s*se,J+=s*te,oe+=s*he,L+=s*pe,U+=s*re,C+=s*be,a+=s*we,I+=s*Ee,k+=s*De,X+=s*ve,s=w[10],x+=s*ye,j+=s*ge,K+=s*fe,G+=s*ue,V+=s*ce,Q+=s*ae,J+=s*se,oe+=s*te,L+=s*he,U+=s*pe,C+=s*re,a+=s*be,I+=s*we,k+=s*Ee,X+=s*De,le+=s*ve,s=w[11],j+=s*ye,K+=s*ge,G+=s*fe,V+=s*ue,Q+=s*ce,J+=s*ae,oe+=s*se,L+=s*te,U+=s*he,C+=s*pe,a+=s*re,I+=s*be,k+=s*we,X+=s*Ee,le+=s*De,_e+=s*ve,s=w[12],K+=s*ye,G+=s*ge,V+=s*fe,Q+=s*ue,J+=s*ce,oe+=s*ae,L+=s*se,U+=s*te,C+=s*he,a+=s*pe,I+=s*re,k+=s*be,X+=s*we,le+=s*Ee,_e+=s*De,de+=s*ve,s=w[13],G+=s*ye,V+=s*ge,Q+=s*fe,J+=s*ue,oe+=s*ce,L+=s*ae,U+=s*se,C+=s*te,a+=s*he,I+=s*pe,k+=s*re,X+=s*be,le+=s*we,_e+=s*Ee,de+=s*De,me+=s*ve,s=w[14],V+=s*ye,Q+=s*ge,J+=s*fe,oe+=s*ue,L+=s*ce,U+=s*ae,C+=s*se,a+=s*te,I+=s*he,k+=s*pe,X+=s*re,le+=s*be,_e+=s*we,de+=s*Ee,me+=s*De,Fe+=s*ve,s=w[15],Q+=s*ye,J+=s*ge,oe+=s*fe,L+=s*ue,U+=s*ce,C+=s*ae,a+=s*se,I+=s*te,k+=s*he,X+=s*pe,le+=s*re,_e+=s*be,de+=s*we,me+=s*Ee,Fe+=s*De,Pe+=s*ve,B+=38*J,o+=38*oe,f+=38*L,d+=38*U,v+=38*C,y+=38*a,h+=38*I,T+=38*k,F+=38*X,z+=38*le,x+=38*_e,j+=38*de,K+=38*me,G+=38*Fe,V+=38*Pe,l=1,s=B+l+65535,l=Math.floor(s/65536),B=s-l*65536,s=o+l+65535,l=Math.floor(s/65536),o=s-l*65536,s=f+l+65535,l=Math.floor(s/65536),f=s-l*65536,s=d+l+65535,l=Math.floor(s/65536),d=s-l*65536,s=v+l+65535,l=Math.floor(s/65536),v=s-l*65536,s=y+l+65535,l=Math.floor(s/65536),y=s-l*65536,s=h+l+65535,l=Math.floor(s/65536),h=s-l*65536,s=T+l+65535,l=Math.floor(s/65536),T=s-l*65536,s=F+l+65535,l=Math.floor(s/65536),F=s-l*65536,s=z+l+65535,l=Math.floor(s/65536),z=s-l*65536,s=x+l+65535,l=Math.floor(s/65536),x=s-l*65536,s=j+l+65535,l=Math.floor(s/65536),j=s-l*65536,s=K+l+65535,l=Math.floor(s/65536),K=s-l*65536,s=G+l+65535,l=Math.floor(s/65536),G=s-l*65536,s=V+l+65535,l=Math.floor(s/65536),V=s-l*65536,s=Q+l+65535,l=Math.floor(s/65536),Q=s-l*65536,B+=l-1+37*(l-1),l=1,s=B+l+65535,l=Math.floor(s/65536),B=s-l*65536,s=o+l+65535,l=Math.floor(s/65536),o=s-l*65536,s=f+l+65535,l=Math.floor(s/65536),f=s-l*65536,s=d+l+65535,l=Math.floor(s/65536),d=s-l*65536,s=v+l+65535,l=Math.floor(s/65536),v=s-l*65536,s=y+l+65535,l=Math.floor(s/65536),y=s-l*65536,s=h+l+65535,l=Math.floor(s/65536),h=s-l*65536,s=T+l+65535,l=Math.floor(s/65536),T=s-l*65536,s=F+l+65535,l=Math.floor(s/65536),F=s-l*65536,s=z+l+65535,l=Math.floor(s/65536),z=s-l*65536,s=x+l+65535,l=Math.floor(s/65536),x=s-l*65536,s=j+l+65535,l=Math.floor(s/65536),j=s-l*65536,s=K+l+65535,l=Math.floor(s/65536),K=s-l*65536,s=G+l+65535,l=Math.floor(s/65536),G=s-l*65536,s=V+l+65535,l=Math.floor(s/65536),V=s-l*65536,s=Q+l+65535,l=Math.floor(s/65536),Q=s-l*65536,B+=l-1+37*(l-1),b[0]=B,b[1]=o,b[2]=f,b[3]=d,b[4]=v,b[5]=y,b[6]=h,b[7]=T,b[8]=F,b[9]=z,b[10]=x,b[11]=j,b[12]=K,b[13]=G,b[14]=V,b[15]=Q}function N(b,w){$(b,w,w)}function A(b,w){const m=i();for(let s=0;s<16;s++)m[s]=w[s];for(let s=253;s>=0;s--)N(m,m),s!==2&&s!==4&&$(m,m,w);for(let s=0;s<16;s++)b[s]=m[s]}function H(b,w){const m=new Uint8Array(32),s=new Float64Array(80),l=i(),B=i(),o=i(),f=i(),d=i(),v=i();for(let F=0;F<31;F++)m[F]=b[F];m[31]=b[31]&127|64,m[0]&=248,O(s,w);for(let F=0;F<16;F++)B[F]=s[F];l[0]=f[0]=1;for(let F=254;F>=0;--F){const z=m[F>>>3]>>>(F&7)&1;u(l,B,z),u(o,f,z),S(d,l,o),P(l,l,o),S(o,B,f),P(B,B,f),N(f,d),N(v,l),$(l,o,l),$(o,B,d),S(d,l,o),P(l,l,o),N(B,l),P(o,f,v),$(l,o,c),S(l,l,f),$(o,o,l),$(l,f,v),$(f,B,s),N(B,d),u(l,B,z),u(o,f,z)}for(let F=0;F<16;F++)s[F+16]=l[F],s[F+32]=o[F],s[F+48]=B[F],s[F+64]=f[F];const y=s.subarray(32),h=s.subarray(16);A(y,y),$(h,h,y);const T=new Uint8Array(32);return g(T,h),T}t.scalarMult=H;function M(b){return H(b,n)}t.scalarMultBase=M;function q(b){if(b.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(b);return{publicKey:M(w),secretKey:w}}t.generateKeyPairFromSeed=q;function _(b){const w=(0,e.randomBytes)(32,b),m=q(w);return(0,r.wipe)(w),m}t.generateKeyPair=_;function E(b,w,m=!1){if(b.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=H(b,w);if(m){let l=0;for(let B=0;B<s.length;B++)l|=s[B];if(l===0)throw new Error("X25519: invalid shared key")}return s}t.sharedKey=E})(Vi);var Jn=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,c;i<n;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return t.concat(c||Array.prototype.slice.call(e))},gl=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),pl=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),yl=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),_l=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),bl=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),wl=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,ml=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Xn=3,vl=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",wl]],Zn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function El(t){return t?Qn(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new bl:typeof navigator<"u"?Qn(navigator.userAgent):Ol()}function Dl(t){return t!==""&&vl.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var c=n.exec(t);return!!c&&[i,c]},!1)}function Qn(t){var e=Dl(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new _l;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Xn&&(n=Jn(Jn([],n,!0),xl(Xn-n.length),!0)):n=[];var c=n.join("."),p=Sl(t),u=ml.exec(t);return u&&u[1]?new yl(r,c,p,u[1]):new gl(r,c,p)}function Sl(t){for(var e=0,r=Zn.length;e<r;e++){var i=Zn[e],n=i[0],c=i[1],p=c.exec(t);if(p)return n}return null}function Ol(){var t=typeof process<"u"&&process.version;return t?new pl(process.version.slice(1)):null}function xl(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Pa=Oe.getLocation=Oe.getLocationOrThrow=Gi=Oe.getNavigator=Oe.getNavigatorOrThrow=Aa=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Yt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Oe.getFromWindow=Yt;function nr(t){const e=Yt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Oe.getFromWindowOrThrow=nr;function Il(){return nr("document")}Oe.getDocumentOrThrow=Il;function Tl(){return Yt("document")}var Aa=Oe.getDocument=Tl;function Al(){return nr("navigator")}Oe.getNavigatorOrThrow=Al;function Pl(){return Yt("navigator")}var Gi=Oe.getNavigator=Pl;function Nl(){return nr("location")}Oe.getLocationOrThrow=Nl;function Cl(){return Yt("location")}var Pa=Oe.getLocation=Cl;function Rl(){return nr("crypto")}Oe.getCryptoOrThrow=Rl;function Fl(){return Yt("crypto")}Oe.getCrypto=Fl;function Ul(){return nr("localStorage")}Oe.getLocalStorageOrThrow=Ul;function Ll(){return Yt("localStorage")}Oe.getLocalStorage=Ll;var Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});var Na=Wi.getWindowMetadata=void 0;const es=Oe;function Ml(){let t,e;try{t=es.getDocumentOrThrow(),e=es.getLocationOrThrow()}catch{return null}function r(){const P=t.getElementsByTagName("link"),$=[];for(let N=0;N<P.length;N++){const A=P[N],H=A.getAttribute("rel");if(H&&H.toLowerCase().indexOf("icon")>-1){const M=A.getAttribute("href");if(M)if(M.toLowerCase().indexOf("https:")===-1&&M.toLowerCase().indexOf("http:")===-1&&M.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(M.indexOf("/")===0)q+=M;else{const _=e.pathname.split("/");_.pop();const E=_.join("/");q+=E+"/"+M}$.push(q)}else if(M.indexOf("//")===0){const q=e.protocol+M;$.push(q)}else $.push(M)}}return $}function i(...P){const $=t.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const A=$[N],H=["itemprop","property","name"].map(M=>A.getAttribute(M)).filter(M=>M?P.includes(M):!1);if(H.length&&H){const M=A.getAttribute("content");if(M)return M}}return""}function n(){let P=i("name","og:site_name","og:title","twitter:title");return P||(P=t.title),P}function c(){return i("description","og:description","twitter:description","keywords")}const p=n(),u=c(),g=e.origin,O=r();return{description:u,url:g,icons:O,name:p}}Na=Wi.getWindowMetadata=Ml;var vr={},Ca=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),c=0;c<i.length;c++){var p=i[c],u=t[p];(n?e.indexOf(p)!==-1:e(p,u,t))&&(r[p]=u)}return r};(function(t){const e=qs,r=Ks,i=Hs,n=Ca,c=_=>_==null,p=Symbol("encodeFragmentIdentifier");function u(_){switch(_.arrayFormat){case"index":return E=>(b,w)=>{const m=b.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),"[",m,"]"].join("")]:[...b,[S(E,_),"[",S(m,_),"]=",S(w,_)].join("")]};case"bracket":return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),"[]"].join("")]:[...b,[S(E,_),"[]=",S(w,_)].join("")];case"colon-list-separator":return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),":list="].join("")]:[...b,[S(E,_),":list=",S(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const E=_.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(w,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?w:(m=m===null?"":m,w.length===0?[[S(b,_),E,S(m,_)].join("")]:[[w,S(m,_)].join(_.arrayFormatSeparator)])}default:return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,S(E,_)]:[...b,[S(E,_),"=",S(w,_)].join("")]}}function g(_){let E;switch(_.arrayFormat){case"index":return(b,w,m)=>{if(E=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!E){m[b]=w;return}m[b]===void 0&&(m[b]={}),m[b][E[1]]=w};case"bracket":return(b,w,m)=>{if(E=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!E){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"colon-list-separator":return(b,w,m)=>{if(E=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!E){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"comma":case"separator":return(b,w,m)=>{const s=typeof w=="string"&&w.includes(_.arrayFormatSeparator),l=typeof w=="string"&&!s&&P(w,_).includes(_.arrayFormatSeparator);w=l?P(w,_):w;const B=s||l?w.split(_.arrayFormatSeparator).map(o=>P(o,_)):w===null?w:P(w,_);m[b]=B};case"bracket-separator":return(b,w,m)=>{const s=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!s){m[b]=w&&P(w,_);return}const l=w===null?[]:w.split(_.arrayFormatSeparator).map(B=>P(B,_));if(m[b]===void 0){m[b]=l;return}m[b]=[].concat(m[b],l)};default:return(b,w,m)=>{if(m[b]===void 0){m[b]=w;return}m[b]=[].concat(m[b],w)}}}function O(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(_,E){return E.encode?E.strict?e(_):encodeURIComponent(_):_}function P(_,E){return E.decode?r(_):_}function $(_){return Array.isArray(_)?_.sort():typeof _=="object"?$(Object.keys(_)).sort((E,b)=>Number(E)-Number(b)).map(E=>_[E]):_}function N(_){const E=_.indexOf("#");return E!==-1&&(_=_.slice(0,E)),_}function A(_){let E="";const b=_.indexOf("#");return b!==-1&&(E=_.slice(b)),E}function H(_){_=N(_);const E=_.indexOf("?");return E===-1?"":_.slice(E+1)}function M(_,E){return E.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):E.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function q(_,E){E=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},E),O(E.arrayFormatSeparator);const b=g(E),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const m of _.split("&")){if(m==="")continue;let[s,l]=i(E.decode?m.replace(/\+/g," "):m,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(E.arrayFormat)?l:P(l,E),b(P(s,E),l,w)}for(const m of Object.keys(w)){const s=w[m];if(typeof s=="object"&&s!==null)for(const l of Object.keys(s))s[l]=M(s[l],E);else w[m]=M(s,E)}return E.sort===!1?w:(E.sort===!0?Object.keys(w).sort():Object.keys(w).sort(E.sort)).reduce((m,s)=>{const l=w[s];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?m[s]=$(l):m[s]=l,m},Object.create(null))}t.extract=H,t.parse=q,t.stringify=(_,E)=>{if(!_)return"";E=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},E),O(E.arrayFormatSeparator);const b=l=>E.skipNull&&c(_[l])||E.skipEmptyString&&_[l]==="",w=u(E),m={};for(const l of Object.keys(_))b(l)||(m[l]=_[l]);const s=Object.keys(m);return E.sort!==!1&&s.sort(E.sort),s.map(l=>{const B=_[l];return B===void 0?"":B===null?S(l,E):Array.isArray(B)?B.length===0&&E.arrayFormat==="bracket-separator"?S(l,E)+"[]":B.reduce(w(l),[]).join("&"):S(l,E)+"="+S(B,E)}).filter(l=>l.length>0).join("&")},t.parseUrl=(_,E)=>{E=Object.assign({decode:!0},E);const[b,w]=i(_,"#");return Object.assign({url:b.split("?")[0]||"",query:q(H(_),E)},E&&E.parseFragmentIdentifier&&w?{fragmentIdentifier:P(w,E)}:{})},t.stringifyUrl=(_,E)=>{E=Object.assign({encode:!0,strict:!0,[p]:!0},E);const b=N(_.url).split("?")[0]||"",w=t.extract(_.url),m=t.parse(w,{sort:!1}),s=Object.assign(m,_.query);let l=t.stringify(s,E);l&&(l=`?${l}`);let B=A(_.url);return _.fragmentIdentifier&&(B=`#${E[p]?S(_.fragmentIdentifier,E):_.fragmentIdentifier}`),`${b}${l}${B}`},t.pick=(_,E,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[p]:!1},b);const{url:w,query:m,fragmentIdentifier:s}=t.parseUrl(_,b);return t.stringifyUrl({url:w,query:n(m,E),fragmentIdentifier:s},b)},t.exclude=(_,E,b)=>{const w=Array.isArray(E)?m=>!E.includes(m):(m,s)=>!E(m,s);return t.pick(_,w,b)}})(vr);const jl={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},Ra="base10",ct="base16",xi="base64pad",ki="utf8",Fa=0,Jt=1,$l=0,ts=1,Ii=12,Yi=32;function zl(){const t=Vi.generateKeyPair();return{privateKey:ut(t.secretKey,ct),publicKey:ut(t.publicKey,ct)}}function Ti(){const t=ir.randomBytes(Yi);return ut(t,ct)}function Bl(t,e){const r=Vi.sharedKey(ot(t,ct),ot(e,ct)),i=new dl(ei.SHA256,r).expand(Yi);return ut(i,ct)}function Hl(t){const e=ei.hash(ot(t,ct));return ut(e,ct)}function Ai(t){const e=ei.hash(ot(t,ki));return ut(e,ct)}function ql(t){return ot(`${t}`,Ra)}function Ar(t){return Number(ut(t,Ra))}function Kl(t){const e=ql(typeof t.type<"u"?t.type:Fa);if(Ar(e)===Jt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ot(t.senderPublicKey,ct):void 0,i=typeof t.iv<"u"?ot(t.iv,ct):ir.randomBytes(Ii),n=new qi.ChaCha20Poly1305(ot(t.symKey,ct)).seal(i,ot(t.message,ki));return Gl({type:e,sealed:n,iv:i,senderPublicKey:r})}function Vl(t){const e=new qi.ChaCha20Poly1305(ot(t.symKey,ct)),{sealed:r,iv:i}=Ji(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return ut(n,ki)}function Gl(t){if(Ar(t.type)===Jt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ut(Ei([t.type,t.senderPublicKey,t.iv,t.sealed]),xi)}return ut(Ei([t.type,t.iv,t.sealed]),xi)}function Ji(t){const e=ot(t,xi),r=e.slice($l,ts),i=ts;if(Ar(r)===Jt){const u=i+Yi,g=u+Ii,O=e.slice(i,u),S=e.slice(u,g),P=e.slice(g);return{type:r,sealed:P,iv:S,senderPublicKey:O}}const n=i+Ii,c=e.slice(i,n),p=e.slice(n);return{type:r,sealed:p,iv:c}}function Wl(t,e){const r=Ji(t);return Ua({type:Ar(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ut(r.senderPublicKey,ct):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ua(t){const e=(t==null?void 0:t.type)||Fa;if(e===Jt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function rs(t){return t.type===Jt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var kl=Object.defineProperty,is=Object.getOwnPropertySymbols,Yl=Object.prototype.hasOwnProperty,Jl=Object.prototype.propertyIsEnumerable,ns=(t,e,r)=>e in t?kl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ss=(t,e)=>{for(var r in e||(e={}))Yl.call(e,r)&&ns(t,r,e[r]);if(is)for(var r of is(e))Jl.call(e,r)&&ns(t,r,e[r]);return t};const Xl="ReactNative",br={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Zl="js";function La(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ql(){return!Aa()&&!!Gi()&&navigator.product===Xl}function ef(){return!La()&&!!Gi()}function tf(){return Ql()?br.reactNative:La()?br.node:ef()?br.browser:br.unknown}function rf(t,e){let r=vr.parse(t);return r=ss(ss({},r),e),t=vr.stringify(r),t}function nf(){return Na()||{name:"",description:"",url:"",icons:[""]}}function sf(){const t=El();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function af(){var t;const e=tf();return e===br.browser?[e,((t=Pa())==null?void 0:t.host)||"unknown"].join(":"):e}function of(t,e,r){const i=sf(),n=af();return[[t,e].join("-"),[Zl,r].join("-"),i,n].join("/")}function cf({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:c}){const p=r.split("?"),u=of(t,e,i),g={auth:n,ua:u,projectId:c},O=rf(p[1]||"",g);return p[0]+"?"+O}function at(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Ma(t){return Object.fromEntries(t.entries())}function ja(t){return new Map(Object.entries(t))}function At(t,e){return ee.fromMiliseconds((e||Date.now())+ee.toMiliseconds(t))}function Lt(t){return ee.fromMiliseconds(Date.now())>=ee.toMiliseconds(t)}function Wt(){const t=ee.toMiliseconds(ee.FIVE_MINUTES);let e,r,i;return{resolve:n=>{i&&e&&(clearTimeout(i),e(n))},reject:n=>{i&&r&&(clearTimeout(i),r(n))},done:()=>new Promise((n,c)=>{i=setTimeout(c,t),e=n,r=c})}}function $a(t,e){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(),e),c=await t;clearTimeout(n),r(c)})}function za(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function uf(t){return za("topic",t)}function hf(t){return za("id",t)}function Ba(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ue(t,e){return`${t}${e?`:${e}`:""}`}const lf="irn";function Pi(t){return(t==null?void 0:t.relay)||{protocol:lf}}function Ni(t){const e=jl[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var ff=Object.defineProperty,as=Object.getOwnPropertySymbols,df=Object.prototype.hasOwnProperty,gf=Object.prototype.propertyIsEnumerable,os=(t,e,r)=>e in t?ff(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pf=(t,e)=>{for(var r in e||(e={}))df.call(e,r)&&os(t,r,e[r]);if(as)for(var r of as(e))gf.call(e,r)&&os(t,r,e[r]);return t};function yf(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const c=n.replace(i,""),p=t[n];r[c]=p}}),r}function _f(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),c=typeof r<"u"?t.substring(r):"",p=vr.parse(c);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:p.symKey,relay:yf(p)}}function bf(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const c=r+e+n;t[n]&&(i[c]=t[n])}),i}function wf(t){return`${t.protocol}:${t.topic}@${t.version}?`+vr.stringify(pf({symKey:t.symKey},bf(t.relay)))}function Ot(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function mf(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Ot(r.accounts)),r.extension&&r.extension.forEach(i=>{e.push(...Ot(i.accounts))})}),e}function vf(t,e){const r=[];return Object.values(t).forEach(i=>{Ot(i.accounts).includes(e)&&r.push(...i.methods),i.extension&&i.extension.forEach(n=>{Ot(n.accounts).includes(e)&&r.push(...n.methods)})}),r}function Ef(t,e){const r=[];return Object.values(t).forEach(i=>{Ot(i.accounts).includes(e)&&r.push(...i.events),i.extension&&i.extension.forEach(n=>{Ot(n.accounts).includes(e)&&r.push(...n.events)})}),r}const Df={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Sf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Y(t,e){const{message:r,code:i}=Sf[t];return{message:e?`${r} ${e}`:r,code:i}}function Je(t,e){const{message:r,code:i}=Df[t];return{message:e?`${r} ${e}`:r,code:i}}function Pr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Ha(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function yt(t){return typeof t>"u"}function Ze(t,e){return e&&yt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function qa(t,e){return e&&yt(t)?!0:typeof t=="number"&&!isNaN(t)}function Of(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let c=!0;return at(n,i)?(i.forEach(p=>{const{accounts:u,methods:g,events:O,extension:S}=t.namespaces[p],P=Ot(u),$=r[p];(!at($.chains,P)||!at($.methods,g)||!at($.events,O))&&(c=!1),c&&S&&S.forEach(N=>{var A;const{accounts:H,methods:M,events:q}=N,_=Ot(H);(A=$.extension)!=null&&A.find(E=>at(E.chains,_)&&at(E.methods,M)&&at(E.events,q))||(c=!1)})}),c):!1}function Xi(t){return Ze(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function xf(t){if(Ze(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Xi(r)}}return!1}function If(t){if(Ze(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Tf(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Af(t){return t==null?void 0:t.topic}function Pf(t,e){let r=null;return Ze(t==null?void 0:t.publicKey,!1)||(r=Y("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Zi(t,e){let r=null;return yt(t==null?void 0:t.extension)||(!Pr(t.extension)||!t.extension.length)&&(r=Y("MISSING_OR_INVALID",`${e} extension should be an array of namespaces, or omitted`)),r}function cs(t){let e=!0;return Pr(t)?t.length&&(e=t.every(r=>Ze(r,!1))):e=!1,e}function us(t,e,r){let i=null;return Pr(e)?e.forEach(n=>{i||(!Xi(n)||!n.includes(t))&&(i=Je("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Nf(t,e){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const c=us(i,n==null?void 0:n.chains,`${e} requiredNamespace`),p=Zi(n,e);c?r=c:p?r=p:n.extension&&n.extension.forEach(u=>{if(r)return;const g=us(i,u.chains,`${e} extension`);g&&(r=g)})}),r}function hs(t,e){let r=null;return Pr(t)?t.forEach(i=>{r||xf(i)||(r=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Cf(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=hs(i==null?void 0:i.accounts,`${e} namespace`),c=Zi(i,e);n?r=n:c?r=c:i.extension&&i.extension.forEach(p=>{if(r)return;const u=hs(p.accounts,`${e} extension`);u&&(r=u)})}),r}function ls(t,e){let r=null;return cs(t==null?void 0:t.methods)?cs(t==null?void 0:t.events)||(r=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ka(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=ls(i,`${e}, namespace`),c=Zi(i,e);n?r=n:c?r=c:i.extension&&i.extension.forEach(p=>{if(r)return;const u=ls(p,`${e}, extension`);u&&(r=u)})}),r}function Rf(t,e){let r=null;if(t&&Ha(t)){const i=Ka(t,e);i&&(r=i);const n=Nf(t,e);n&&(r=n)}else r=Y("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function di(t,e){let r=null;if(t&&Ha(t)){const i=Ka(t,e);i&&(r=i);const n=Cf(t,e);n&&(r=n)}else r=Y("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Va(t){return Ze(t.protocol,!0)}function Ff(t,e){let r=!1;return e&&!t?r=!0:t&&Pr(t)&&t.length&&t.forEach(i=>{r=Va(i)}),r}function Uf(t){return typeof t=="number"}function nt(t){return typeof t<"u"&&typeof t!==null}function Lf(t){return!(!t||typeof t!="object"||!t.code||!qa(t.code,!1)||!t.message||!Ze(t.message,!1))}function Mf(t){return!(yt(t)||!Ze(t.method,!1))}function jf(t){return!(yt(t)||yt(t.result)&&yt(t.error)||!qa(t.id,!1)||!Ze(t.jsonrpc,!1))}function $f(t){return!(yt(t)||!Ze(t.name,!1))}function fs(t,e){return!(!Xi(e)||!mf(t).includes(e))}function zf(t,e,r){return Ze(r,!1)?vf(t,e).includes(r):!1}function Bf(t,e,r){return Ze(r,!1)?Ef(t,e).includes(r):!1}function ds(t,e,r){let i=null;const n=Object.keys(t),c=Object.keys(e);return at(n,c)?n.forEach(p=>{var u;if(i)return;const g=t[p].chains,O=Ot(e[p].accounts);at(g,O)?at(t[p].methods,e[p].methods)?at(t[p].events,e[p].events)?t[p].extension&&!e[p].extension?i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${p}`):t[p].extension&&e[p].extension&&((u=t[p].extension)==null||u.forEach(({methods:S,events:P,chains:$})=>{var N;i||(N=e[p].extension)!=null&&N.find(A=>{const H=Ot(A.accounts);return at($,H)&&at(P,A.events)&&at(S,A.methods)})||(i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${p}`))})):i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${p}`):i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${p}`):i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${p}`)}):i=Y("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}const gs=10,Hf=()=>typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),qf=()=>typeof window<"u",Kf=Hf();class Vf{constructor(e){if(this.url=e,this.events=new _t.exports.EventEmitter,this.registering=!1,!yn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ui(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!yn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),n(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Xo.isReactNative()?void 0:{rejectUnauthorized:!Zo(e)},c=new Kf(e,[],n);qf()?c.onerror=p=>{const u=p;i(this.emitError(u.error))}:c.on("error",p=>{i(this.emitError(p))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Vs(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),c=Li(e,n);this.events.emit("payload",c)}parseError(e,r=this.url){return Qo(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>gs&&this.events.setMaxListeners(gs)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Ci={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,c=2,p=9007199254740991,u="[object Arguments]",g="[object Array]",O="[object AsyncFunction]",S="[object Boolean]",P="[object Date]",$="[object Error]",N="[object Function]",A="[object GeneratorFunction]",H="[object Map]",M="[object Number]",q="[object Null]",_="[object Object]",E="[object Promise]",b="[object Proxy]",w="[object RegExp]",m="[object Set]",s="[object String]",l="[object Symbol]",B="[object Undefined]",o="[object WeakMap]",f="[object ArrayBuffer]",d="[object DataView]",v="[object Float32Array]",y="[object Float64Array]",h="[object Int8Array]",T="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",x="[object Uint8ClampedArray]",j="[object Uint16Array]",K="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,J={};J[v]=J[y]=J[h]=J[T]=J[F]=J[z]=J[x]=J[j]=J[K]=!0,J[u]=J[g]=J[f]=J[S]=J[d]=J[P]=J[$]=J[N]=J[H]=J[M]=J[_]=J[w]=J[m]=J[s]=J[o]=!1;var oe=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,L=typeof self=="object"&&self&&self.Object===Object&&self,U=oe||L||Function("return this")(),C=e&&!e.nodeType&&e,a=C&&!0&&t&&!t.nodeType&&t,I=a&&a.exports===C,k=I&&oe.process,X=function(){try{return k&&k.binding&&k.binding("util")}catch{}}(),le=X&&X.isTypedArray;function _e(D,R){for(var W=-1,Z=D==null?0:D.length,Ie=0,ne=[];++W<Z;){var Re=D[W];R(Re,W,D)&&(ne[Ie++]=Re)}return ne}function de(D,R){for(var W=-1,Z=R.length,Ie=D.length;++W<Z;)D[Ie+W]=R[W];return D}function me(D,R){for(var W=-1,Z=D==null?0:D.length;++W<Z;)if(R(D[W],W,D))return!0;return!1}function Fe(D,R){for(var W=-1,Z=Array(D);++W<D;)Z[W]=R(W);return Z}function Pe(D){return function(R){return D(R)}}function ye(D,R){return D.has(R)}function ge(D,R){return D==null?void 0:D[R]}function fe(D){var R=-1,W=Array(D.size);return D.forEach(function(Z,Ie){W[++R]=[Ie,Z]}),W}function ue(D,R){return function(W){return D(R(W))}}function ce(D){var R=-1,W=Array(D.size);return D.forEach(function(Z){W[++R]=Z}),W}var ae=Array.prototype,se=Function.prototype,te=Object.prototype,he=U["__core-js_shared__"],pe=se.toString,re=te.hasOwnProperty,be=function(){var D=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return D?"Symbol(src)_1."+D:""}(),we=te.toString,Ee=RegExp("^"+pe.call(re).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=I?U.Buffer:void 0,ve=U.Symbol,bt=U.Uint8Array,mt=te.propertyIsEnumerable,Pt=ae.splice,ht=ve?ve.toStringTag:void 0,$t=Object.getOwnPropertySymbols,ar=De?De.isBuffer:void 0,Cr=ue(Object.keys,Object),Le=Zt(U,"DataView"),Ne=Zt(U,"Map"),Me=Zt(U,"Promise"),je=Zt(U,"Set"),$e=Zt(U,"WeakMap"),Ce=Zt(Object,"create"),He=Bt(Le),qe=Bt(Ne),Ke=Bt(Me),Ve=Bt(je),Ge=Bt($e),Be=ve?ve.prototype:void 0,ze=Be?Be.valueOf:void 0;function Te(D){var R=-1,W=D==null?0:D.length;for(this.clear();++R<W;){var Z=D[R];this.set(Z[0],Z[1])}}function We(){this.__data__=Ce?Ce(null):{},this.size=0}function ke(D){var R=this.has(D)&&delete this.__data__[D];return this.size-=R?1:0,R}function oo(D){var R=this.__data__;if(Ce){var W=R[D];return W===i?void 0:W}return re.call(R,D)?R[D]:void 0}function co(D){var R=this.__data__;return Ce?R[D]!==void 0:re.call(R,D)}function uo(D,R){var W=this.__data__;return this.size+=this.has(D)?0:1,W[D]=Ce&&R===void 0?i:R,this}Te.prototype.clear=We,Te.prototype.delete=ke,Te.prototype.get=oo,Te.prototype.has=co,Te.prototype.set=uo;function xt(D){var R=-1,W=D==null?0:D.length;for(this.clear();++R<W;){var Z=D[R];this.set(Z[0],Z[1])}}function ho(){this.__data__=[],this.size=0}function lo(D){var R=this.__data__,W=Fr(R,D);if(W<0)return!1;var Z=R.length-1;return W==Z?R.pop():Pt.call(R,W,1),--this.size,!0}function fo(D){var R=this.__data__,W=Fr(R,D);return W<0?void 0:R[W][1]}function go(D){return Fr(this.__data__,D)>-1}function po(D,R){var W=this.__data__,Z=Fr(W,D);return Z<0?(++this.size,W.push([D,R])):W[Z][1]=R,this}xt.prototype.clear=ho,xt.prototype.delete=lo,xt.prototype.get=fo,xt.prototype.has=go,xt.prototype.set=po;function zt(D){var R=-1,W=D==null?0:D.length;for(this.clear();++R<W;){var Z=D[R];this.set(Z[0],Z[1])}}function yo(){this.size=0,this.__data__={hash:new Te,map:new(Ne||xt),string:new Te}}function _o(D){var R=Ur(this,D).delete(D);return this.size-=R?1:0,R}function bo(D){return Ur(this,D).get(D)}function wo(D){return Ur(this,D).has(D)}function mo(D,R){var W=Ur(this,D),Z=W.size;return W.set(D,R),this.size+=W.size==Z?0:1,this}zt.prototype.clear=yo,zt.prototype.delete=_o,zt.prototype.get=bo,zt.prototype.has=wo,zt.prototype.set=mo;function Rr(D){var R=-1,W=D==null?0:D.length;for(this.__data__=new zt;++R<W;)this.add(D[R])}function vo(D){return this.__data__.set(D,i),this}function Eo(D){return this.__data__.has(D)}Rr.prototype.add=Rr.prototype.push=vo,Rr.prototype.has=Eo;function Nt(D){var R=this.__data__=new xt(D);this.size=R.size}function Do(){this.__data__=new xt,this.size=0}function So(D){var R=this.__data__,W=R.delete(D);return this.size=R.size,W}function Oo(D){return this.__data__.get(D)}function xo(D){return this.__data__.has(D)}function Io(D,R){var W=this.__data__;if(W instanceof xt){var Z=W.__data__;if(!Ne||Z.length<r-1)return Z.push([D,R]),this.size=++W.size,this;W=this.__data__=new zt(Z)}return W.set(D,R),this.size=W.size,this}Nt.prototype.clear=Do,Nt.prototype.delete=So,Nt.prototype.get=Oo,Nt.prototype.has=xo,Nt.prototype.set=Io;function To(D,R){var W=Lr(D),Z=!W&&qo(D),Ie=!W&&!Z&&ii(D),ne=!W&&!Z&&!Ie&&gn(D),Re=W||Z||Ie||ne,Ye=Re?Fe(D.length,String):[],Xe=Ye.length;for(var Ae in D)(R||re.call(D,Ae))&&!(Re&&(Ae=="length"||Ie&&(Ae=="offset"||Ae=="parent")||ne&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||jo(Ae,Xe)))&&Ye.push(Ae);return Ye}function Fr(D,R){for(var W=D.length;W--;)if(hn(D[W][0],R))return W;return-1}function Ao(D,R,W){var Z=R(D);return Lr(D)?Z:de(Z,W(D))}function or(D){return D==null?D===void 0?B:q:ht&&ht in Object(D)?Lo(D):Ho(D)}function an(D){return cr(D)&&or(D)==u}function on(D,R,W,Z,Ie){return D===R?!0:D==null||R==null||!cr(D)&&!cr(R)?D!==D&&R!==R:Po(D,R,W,Z,on,Ie)}function Po(D,R,W,Z,Ie,ne){var Re=Lr(D),Ye=Lr(R),Xe=Re?g:Ct(D),Ae=Ye?g:Ct(R);Xe=Xe==u?_:Xe,Ae=Ae==u?_:Ae;var lt=Xe==_,wt=Ae==_,tt=Xe==Ae;if(tt&&ii(D)){if(!ii(R))return!1;Re=!0,lt=!1}if(tt&&!lt)return ne||(ne=new Nt),Re||gn(D)?cn(D,R,W,Z,Ie,ne):Fo(D,R,Xe,W,Z,Ie,ne);if(!(W&n)){var dt=lt&&re.call(D,"__wrapped__"),gt=wt&&re.call(R,"__wrapped__");if(dt||gt){var Rt=dt?D.value():D,It=gt?R.value():R;return ne||(ne=new Nt),Ie(Rt,It,W,Z,ne)}}return tt?(ne||(ne=new Nt),Uo(D,R,W,Z,Ie,ne)):!1}function No(D){if(!dn(D)||zo(D))return!1;var R=ln(D)?Ee:V;return R.test(Bt(D))}function Co(D){return cr(D)&&fn(D.length)&&!!J[or(D)]}function Ro(D){if(!Bo(D))return Cr(D);var R=[];for(var W in Object(D))re.call(D,W)&&W!="constructor"&&R.push(W);return R}function cn(D,R,W,Z,Ie,ne){var Re=W&n,Ye=D.length,Xe=R.length;if(Ye!=Xe&&!(Re&&Xe>Ye))return!1;var Ae=ne.get(D);if(Ae&&ne.get(R))return Ae==R;var lt=-1,wt=!0,tt=W&c?new Rr:void 0;for(ne.set(D,R),ne.set(R,D);++lt<Ye;){var dt=D[lt],gt=R[lt];if(Z)var Rt=Re?Z(gt,dt,lt,R,D,ne):Z(dt,gt,lt,D,R,ne);if(Rt!==void 0){if(Rt)continue;wt=!1;break}if(tt){if(!me(R,function(It,Ht){if(!ye(tt,Ht)&&(dt===It||Ie(dt,It,W,Z,ne)))return tt.push(Ht)})){wt=!1;break}}else if(!(dt===gt||Ie(dt,gt,W,Z,ne))){wt=!1;break}}return ne.delete(D),ne.delete(R),wt}function Fo(D,R,W,Z,Ie,ne,Re){switch(W){case d:if(D.byteLength!=R.byteLength||D.byteOffset!=R.byteOffset)return!1;D=D.buffer,R=R.buffer;case f:return!(D.byteLength!=R.byteLength||!ne(new bt(D),new bt(R)));case S:case P:case M:return hn(+D,+R);case $:return D.name==R.name&&D.message==R.message;case w:case s:return D==R+"";case H:var Ye=fe;case m:var Xe=Z&n;if(Ye||(Ye=ce),D.size!=R.size&&!Xe)return!1;var Ae=Re.get(D);if(Ae)return Ae==R;Z|=c,Re.set(D,R);var lt=cn(Ye(D),Ye(R),Z,Ie,ne,Re);return Re.delete(D),lt;case l:if(ze)return ze.call(D)==ze.call(R)}return!1}function Uo(D,R,W,Z,Ie,ne){var Re=W&n,Ye=un(D),Xe=Ye.length,Ae=un(R),lt=Ae.length;if(Xe!=lt&&!Re)return!1;for(var wt=Xe;wt--;){var tt=Ye[wt];if(!(Re?tt in R:re.call(R,tt)))return!1}var dt=ne.get(D);if(dt&&ne.get(R))return dt==R;var gt=!0;ne.set(D,R),ne.set(R,D);for(var Rt=Re;++wt<Xe;){tt=Ye[wt];var It=D[tt],Ht=R[tt];if(Z)var pn=Re?Z(Ht,It,tt,R,D,ne):Z(It,Ht,tt,D,R,ne);if(!(pn===void 0?It===Ht||Ie(It,Ht,W,Z,ne):pn)){gt=!1;break}Rt||(Rt=tt=="constructor")}if(gt&&!Rt){var Mr=D.constructor,jr=R.constructor;Mr!=jr&&"constructor"in D&&"constructor"in R&&!(typeof Mr=="function"&&Mr instanceof Mr&&typeof jr=="function"&&jr instanceof jr)&&(gt=!1)}return ne.delete(D),ne.delete(R),gt}function un(D){return Ao(D,Go,Mo)}function Ur(D,R){var W=D.__data__;return $o(R)?W[typeof R=="string"?"string":"hash"]:W.map}function Zt(D,R){var W=ge(D,R);return No(W)?W:void 0}function Lo(D){var R=re.call(D,ht),W=D[ht];try{D[ht]=void 0;var Z=!0}catch{}var Ie=we.call(D);return Z&&(R?D[ht]=W:delete D[ht]),Ie}var Mo=$t?function(D){return D==null?[]:(D=Object(D),_e($t(D),function(R){return mt.call(D,R)}))}:Wo,Ct=or;(Le&&Ct(new Le(new ArrayBuffer(1)))!=d||Ne&&Ct(new Ne)!=H||Me&&Ct(Me.resolve())!=E||je&&Ct(new je)!=m||$e&&Ct(new $e)!=o)&&(Ct=function(D){var R=or(D),W=R==_?D.constructor:void 0,Z=W?Bt(W):"";if(Z)switch(Z){case He:return d;case qe:return H;case Ke:return E;case Ve:return m;case Ge:return o}return R});function jo(D,R){return R=R==null?p:R,!!R&&(typeof D=="number"||Q.test(D))&&D>-1&&D%1==0&&D<R}function $o(D){var R=typeof D;return R=="string"||R=="number"||R=="symbol"||R=="boolean"?D!=="__proto__":D===null}function zo(D){return!!be&&be in D}function Bo(D){var R=D&&D.constructor,W=typeof R=="function"&&R.prototype||te;return D===W}function Ho(D){return we.call(D)}function Bt(D){if(D!=null){try{return pe.call(D)}catch{}try{return D+""}catch{}}return""}function hn(D,R){return D===R||D!==D&&R!==R}var qo=an(function(){return arguments}())?an:function(D){return cr(D)&&re.call(D,"callee")&&!mt.call(D,"callee")},Lr=Array.isArray;function Ko(D){return D!=null&&fn(D.length)&&!ln(D)}var ii=ar||ko;function Vo(D,R){return on(D,R)}function ln(D){if(!dn(D))return!1;var R=or(D);return R==N||R==A||R==O||R==b}function fn(D){return typeof D=="number"&&D>-1&&D%1==0&&D<=p}function dn(D){var R=typeof D;return D!=null&&(R=="object"||R=="function")}function cr(D){return D!=null&&typeof D=="object"}var gn=le?Pe(le):Co;function Go(D){return Ko(D)?To(D):Ro(D)}function Wo(){return[]}function ko(){return!1}t.exports=Vo})(Ci,Ci.exports);const Gf=Ci.exports;function Wf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var c=t.charAt(n),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=n}var u=t.length,g=t.charAt(0),O=Math.log(u)/Math.log(256),S=Math.log(256)/Math.log(u);function P(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var H=0,M=0,q=0,_=A.length;q!==_&&A[q]===0;)q++,H++;for(var E=(_-q)*S+1>>>0,b=new Uint8Array(E);q!==_;){for(var w=A[q],m=0,s=E-1;(w!==0||m<M)&&s!==-1;s--,m++)w+=256*b[s]>>>0,b[s]=w%u>>>0,w=w/u>>>0;if(w!==0)throw new Error("Non-zero carry");M=m,q++}for(var l=E-M;l!==E&&b[l]===0;)l++;for(var B=g.repeat(H);l<E;++l)B+=t.charAt(b[l]);return B}function $(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var H=0;if(A[H]!==" "){for(var M=0,q=0;A[H]===g;)M++,H++;for(var _=(A.length-H)*O+1>>>0,E=new Uint8Array(_);A[H];){var b=r[A.charCodeAt(H)];if(b===255)return;for(var w=0,m=_-1;(b!==0||w<q)&&m!==-1;m--,w++)b+=u*E[m]>>>0,E[m]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");q=w,H++}if(A[H]!==" "){for(var s=_-q;s!==_&&E[s]===0;)s++;for(var l=new Uint8Array(M+(_-s)),B=M;s!==_;)l[B++]=E[s++];return l}}}function N(A){var H=$(A);if(H)return H;throw new Error(`Non-${e} character`)}return{encode:P,decodeUnsafe:$,decode:N}}var kf=Wf,Yf=kf;const Ga=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Jf=t=>new TextEncoder().encode(t),Xf=t=>new TextDecoder().decode(t);class Zf{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Qf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wa(this,e)}}class ed{constructor(e){this.decoders=e}or(e){return Wa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wa=(t,e)=>new ed({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class td{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Zf(e,r,i),this.decoder=new Qf(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:i})=>new td(t,e,r,i),Nr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Yf(r,e);return ti({prefix:t,name:e,encode:i,decode:c=>Ga(n(c))})},rd=(t,e,r,i)=>{const n={};for(let S=0;S<e.length;++S)n[e[S]]=S;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let u=0,g=0,O=0;for(let S=0;S<c;++S){const P=n[t[S]];if(P===void 0)throw new SyntaxError(`Non-${i} character`);g=g<<r|P,u+=r,u>=8&&(u-=8,p[O++]=255&g>>u)}if(u>=r||255&g<<8-u)throw new SyntaxError("Unexpected end of data");return p},id=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let c="",p=0,u=0;for(let g=0;g<t.length;++g)for(u=u<<8|t[g],p+=8;p>r;)p-=r,c+=e[n&u>>p];if(p&&(c+=e[n&u<<r-p]),i)for(;c.length*r&7;)c+="=";return c},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ti({prefix:e,name:t,encode(n){return id(n,i,r)},decode(n){return rd(n,i,r,t)}}),nd=ti({prefix:"\0",name:"identity",encode:t=>Xf(t),decode:t=>Jf(t)});var sd=Object.freeze({__proto__:null,identity:nd});const ad=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var od=Object.freeze({__proto__:null,base2:ad});const cd=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ud=Object.freeze({__proto__:null,base8:cd});const hd=Nr({prefix:"9",name:"base10",alphabet:"0123456789"});var ld=Object.freeze({__proto__:null,base10:hd});const fd=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dd=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var gd=Object.freeze({__proto__:null,base16:fd,base16upper:dd});const pd=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yd=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_d=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bd=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wd=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),md=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),vd=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ed=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Dd=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Sd=Object.freeze({__proto__:null,base32:pd,base32upper:yd,base32pad:_d,base32padupper:bd,base32hex:wd,base32hexupper:md,base32hexpad:vd,base32hexpadupper:Ed,base32z:Dd});const Od=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xd=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Id=Object.freeze({__proto__:null,base36:Od,base36upper:xd});const Td=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ad=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Pd=Object.freeze({__proto__:null,base58btc:Td,base58flickr:Ad});const Nd=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Cd=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rd=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Fd=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ud=Object.freeze({__proto__:null,base64:Nd,base64pad:Cd,base64url:Rd,base64urlpad:Fd});const ka=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ld=ka.reduce((t,e,r)=>(t[r]=e,t),[]),Md=ka.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function jd(t){return t.reduce((e,r)=>(e+=Ld[r],e),"")}function $d(t){const e=[];for(const r of t){const i=Md[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const zd=ti({prefix:"\u{1F680}",name:"base256emoji",encode:jd,decode:$d});var Bd=Object.freeze({__proto__:null,base256emoji:zd}),Hd=Ya,ps=128,qd=127,Kd=~qd,Vd=Math.pow(2,31);function Ya(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Vd;)e[r++]=t&255|ps,t/=128;for(;t&Kd;)e[r++]=t&255|ps,t>>>=7;return e[r]=t|0,Ya.bytes=r-i+1,e}var Gd=Ri,Wd=128,ys=127;function Ri(t,i){var r=0,i=i||0,n=0,c=i,p,u=t.length;do{if(c>=u)throw Ri.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=n<28?(p&ys)<<n:(p&ys)*Math.pow(2,n),n+=7}while(p>=Wd);return Ri.bytes=c-i,r}var kd=Math.pow(2,7),Yd=Math.pow(2,14),Jd=Math.pow(2,21),Xd=Math.pow(2,28),Zd=Math.pow(2,35),Qd=Math.pow(2,42),eg=Math.pow(2,49),tg=Math.pow(2,56),rg=Math.pow(2,63),ig=function(t){return t<kd?1:t<Yd?2:t<Jd?3:t<Xd?4:t<Zd?5:t<Qd?6:t<eg?7:t<tg?8:t<rg?9:10},ng={encode:Hd,decode:Gd,encodingLength:ig},Ja=ng;const _s=(t,e,r=0)=>(Ja.encode(t,e,r),e),bs=t=>Ja.encodingLength(t),Fi=(t,e)=>{const r=e.byteLength,i=bs(t),n=i+bs(r),c=new Uint8Array(n+r);return _s(t,c,0),_s(r,c,i),c.set(e,n),new sg(t,r,e,c)};class sg{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Xa=({name:t,code:e,encode:r})=>new ag(t,e,r);class ag{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Fi(this.code,r):r.then(i=>Fi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Za=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),og=Xa({name:"sha2-256",code:18,encode:Za("SHA-256")}),cg=Xa({name:"sha2-512",code:19,encode:Za("SHA-512")});var ug=Object.freeze({__proto__:null,sha256:og,sha512:cg});const Qa=0,hg="identity",eo=Ga,lg=t=>Fi(Qa,eo(t)),fg={code:Qa,name:hg,encode:eo,digest:lg};var dg=Object.freeze({__proto__:null,identity:fg});new TextEncoder,new TextDecoder;const ws={...sd,...od,...ud,...ld,...gd,...Sd,...Id,...Pd,...Ud,...Bd};({...ug,...dg});function gg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function to(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ms=to("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),gi=to("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=gg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),pg={utf8:ms,"utf-8":ms,hex:ws.base16,latin1:gi,ascii:gi,binary:gi,...ws};function yg(t,e="utf8"){const r=pg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const ro="wc",_g=2,Qi="core",Mt=`${ro}@${2}:${Qi}:`,bg={name:Qi,logger:"error"},wg={database:":memory:"},mg="crypto",vs="client_ed25519_seed",vg=ee.ONE_DAY,Eg="keychain",Dg="0.3",Sg="messages",Og="0.3",xg=ee.SIX_HOURS,Ig="publisher",io="irn",Tg="error",Ag="wss://relay.walletconnect.com",Pg="relayer",st={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed"},Ng="_subscription",zr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Es=ee.ONE_SECOND,Cg="2.1.3",Rg="0.3",Dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Fg="subscription",Ug="0.3",Lg=ee.FIVE_SECONDS*1e3,Mg="pairing",jg="0.3",yr={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$g="history",zg="0.3",Bg="expirer",pt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Hg="0.3";class qg{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Eg,this.version=Dg,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:c}=Y("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Kg{constructor(e,r,i){this.core=e,this.logger=r,this.name=mg,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),c=Wn(n);return Da(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=zl();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const c=await this.getClientSeed(),p=Wn(c),u=Ti();return await el(u,n,vg,p)},this.generateSharedKey=(n,c,p)=>{this.isInitialized();const u=this.getPrivateKey(n),g=Bl(u,c);return this.setSymKey(g,p)},this.setSymKey=async(n,c)=>{this.isInitialized();const p=c||Hl(n);return await this.keychain.set(p,n),p},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,c,p)=>{this.isInitialized();const u=Ua(p),g=Ui(c);if(rs(u)){const $=u.senderPublicKey,N=u.receiverPublicKey;n=await this.generateSharedKey($,N)}const O=this.getSymKey(n),{type:S,senderPublicKey:P}=u;return Kl({type:S,symKey:O,message:g,senderPublicKey:P})},this.decode=async(n,c,p)=>{this.isInitialized();const u=Wl(c,p);if(rs(u)){const S=u.receiverPublicKey,P=u.senderPublicKey;n=await this.generateSharedKey(S,P)}const g=this.getSymKey(n),O=Vl({symKey:g,encoded:c});return Vs(O)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new qg(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=Ji(e);return Ar(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(vs)}catch{e=Ti(),await this.keychain.set(vs,e)}return yg(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Vg extends jc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Sg,this.version=Og,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const c=Ai(n);let p=this.messages.get(i);return typeof p>"u"&&(p={}),typeof p[c]<"u"||(p[c]=n,this.messages.set(i,p),await this.persist()),c},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const c=this.get(i),p=Ai(n);return typeof c[p]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Gg extends $c{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new _t.exports.EventEmitter,this.name=Ig,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:c}});try{const p=(c==null?void 0:c.ttl)||xg,u=Pi(c),g=(c==null?void 0:c.prompt)||!1,O=(c==null?void 0:c.tag)||0,S={topic:i,message:n,opts:{ttl:p,relay:u,prompt:g,tag:O}},P=Ai(n);this.queue.set(P,S);try{await await $a(this.rpcPublish(i,n,p,u,g,O),this.publishTimeout)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(st.connection_stalled);return}this.onPublish(P,S),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,c,p){var u,g,O,S;const P={method:Ni(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:c,tag:p}};return yt((u=P.params)==null?void 0:u.prompt)&&((g=P.params)==null||delete g.prompt),yt((O=P.params)==null?void 0:O.tag)&&((S=P.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:P}),this.relayer.provider.request(P)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Wg{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(c=>c!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var kg=Object.defineProperty,Yg=Object.defineProperties,Jg=Object.getOwnPropertyDescriptors,Ds=Object.getOwnPropertySymbols,Xg=Object.prototype.hasOwnProperty,Zg=Object.prototype.propertyIsEnumerable,Ss=(t,e,r)=>e in t?kg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Br=(t,e)=>{for(var r in e||(e={}))Xg.call(e,r)&&Ss(t,r,e[r]);if(Ds)for(var r of Ds(e))Zg.call(e,r)&&Ss(t,r,e[r]);return t},pi=(t,e)=>Yg(t,Jg(e));class Qg extends Hc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Wg,this.events=new _t.exports.EventEmitter,this.name=Fg,this.version=Ug,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Mt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const c=Pi(n),p={topic:i,relay:c};this.pending.set(i,p);const u=await this.rpcSubscribe(i,c);return this.onSubscribe(u,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),u}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,c)=>{const p=new ee.Watch;p.start(this.pendingSubscriptionWatchLabel);const u=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(u),p.stop(this.pendingSubscriptionWatchLabel),n(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=Lg&&(clearInterval(u),p.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Pi(i);await this.rpcUnsubscribe(e,r,n);const c=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:Ni(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await $a(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(st.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:Ni(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,r){this.setSubscription(e,pi(Br({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,pi(Br({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Br({},r)),this.topicMap.set(r.topic,e),this.events.emit(Dt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=Y("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Dt.deleted,pi(Br({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,n={topic:r,relay:i};this.pending.set(n.topic,n);const c=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(c,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(st.connect,async()=>{await this.onConnect()}),this.relayer.on(st.disconnect,()=>{this.onDisconnect()}),this.events.on(Dt.created,async e=>{const r=Dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Dt.deleted,async e=>{const r=Dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ep=Object.defineProperty,Os=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,rp=Object.prototype.propertyIsEnumerable,xs=(t,e,r)=>e in t?ep(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ip=(t,e)=>{for(var r in e||(e={}))tp.call(e,r)&&xs(t,r,e[r]);if(Os)for(var r of Os(e))rp.call(e,r)&&xs(t,r,e[r]);return t};class np extends zc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new _t.exports.EventEmitter,this.name=Pg,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Er(Se.getDefaultLoggerOptions({level:e.logger||Tg})),this.messages=new Vg(this.logger,e.core),this.subscriber=new Qg(this,this.logger),this.publisher=new Gg(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Ag,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(Dt.created,c=>{c.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,r),n()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&await this.provider.disconnect(),this.events.emit(st.transport_closed)}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Dt.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(st.transport_closed,()=>{i()}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(st.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,Es)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Mi(new Vf(cf({sdkVersion:Cg,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ji(e)){if(!e.method.endsWith(Ng))return;const r=e.params,{topic:i,message:n}=r.data,c={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ip({type:"event",event:r.id},c)),this.events.emit(r.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(st.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=$i(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(zr.payload,e=>this.onProviderPayload(e)),this.provider.on(zr.connect,()=>{this.events.emit(st.connect)}),this.provider.on(zr.disconnect,()=>{this.events.emit(st.disconnect),this.attemptToReconnect()}),this.provider.on(zr.error,e=>this.events.emit(st.error,e)),this.events.on(st.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},ee.toMiliseconds(Es))}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sp=Object.defineProperty,Is=Object.getOwnPropertySymbols,ap=Object.prototype.hasOwnProperty,op=Object.prototype.propertyIsEnumerable,Ts=(t,e,r)=>e in t?sp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,As=(t,e)=>{for(var r in e||(e={}))ap.call(e,r)&&Ts(t,r,e[r]);if(Is)for(var r of Is(e))op.call(e,r)&&Ts(t,r,e[r]);return t};class ri extends Bc{constructor(e,r,i,n=Mt,c=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Rg,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{Tf(p)?this.map.set(p.id,p):Af(p)?this.map.set(p.topic,p):this.getKey&&p!==null&&!yt(p)&&this.map.set(this.getKey(p),p)}),this.cached=[],this.initialized=!0)},this.set=async(p,u)=>{this.isInitialized(),this.map.has(p)?await this.update(p,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:u}),this.map.set(p,u),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(u=>Object.keys(p).every(g=>Gf(u[g],p[g]))):this.values),this.update=async(p,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:u});const g=As(As({},this.getData(p)),u);this.map.set(p,g),await this.persist()},this.delete=async(p,u)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:u}),this.map.delete(p),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=Y("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}class cp{constructor(e,r){this.core=e,this.logger=r,this.name=Mg,this.version=jg,this.events=new _t.exports,this.initialized=!1,this.storagePrefix=Mt,this.ignoredPayloadTypes=[Jt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ti(),n=await this.core.crypto.setSymKey(i),c=At(ee.FIVE_MINUTES),p={protocol:io},u={topic:n,expiry:c,relay:p,active:!1},g=wf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:p});return await this.pairings.set(n,u),await this.core.relayer.subscribe(n),this.core.expirer.set(n,c),{topic:n,uri:g}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:c,relay:p}=_f(i.uri),u=At(ee.FIVE_MINUTES),g={topic:n,relay:p,expiry:u,active:!1};return await this.pairings.set(n,g),await this.core.crypto.setSymKey(c,n),await this.core.relayer.subscribe(n,{relay:p}),this.core.expirer.set(n,u),i.activatePairing&&await this.activate({topic:n}),g},this.activate=async({topic:i})=>{this.isInitialized();const n=At(ee.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const c=await this.sendRequest(n,"wc_pairingPing",{}),{done:p,resolve:u,reject:g}=Wt();this.events.once(Ue("pairing_ping",c),({error:O})=>{O?g(O):u()}),await p()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,c)=>{const p=zi(n,c),u=await this.core.crypto.encode(i,p),g=yr[n].req;return this.core.history.set(i,p),await this.core.relayer.publish(i,u,g),p.id},this.sendResult=async(i,n,c)=>{const p=$i(i,c),u=await this.core.crypto.encode(n,p),g=await this.core.history.get(n,i),O=yr[g.request.method].res;await this.core.relayer.publish(n,u,O),await this.core.history.resolve(p)},this.sendError=async(i,n,c)=>{const p=Li(i,c),u=await this.core.crypto.encode(n,p),g=await this.core.history.get(n,i),O=yr[g.request.method]?yr[g.request.method].res:yr.unregistered_method.res;await this.core.relayer.publish(n,u,O),await this.core.history.resolve(p)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Lt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:c}=i;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(n,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,c);default:return this.onUnknownRpcMethodRequest(n,c)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:c}=i,p=(await this.core.history.get(n,c.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(n,c);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(i,n)=>{const{id:c}=n;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onPairingPingResponse=(i,n)=>{const{id:c}=n;setTimeout(()=>{Ut(n)?this.events.emit(Ue("pairing_ping",c),{}):Tt(n)&&this.events.emit(Ue("pairing_ping",c),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:c}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:c,method:p}=n;try{if(this.registeredMethods.includes(p))return;const u=Je("WC_METHOD_UNSUPPORTED",p);await this.sendError(c,i,u),this.logger.error(u)}catch(u){await this.sendError(c,i,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!nt(i)){const{message:n}=Y("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!If(i.uri)){const{message:n}=Y("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!nt(i)){const{message:c}=Y("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!nt(i)){const{message:c}=Y("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:n}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Lt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=Y("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new ri(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(st.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);ji(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Gs(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(pt.expired,async e=>{const{topic:r}=Ba(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class up extends Mc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new _t.exports.EventEmitter,this.name=$g,this.version=zg,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:c}),this.records.has(n.id))return;const p={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:c};this.records.set(p.id,p),this.events.emit(Et.created,p)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Tt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Et.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(c=>{if(c.topic===i){if(typeof n<"u"&&c.id!==n)return;this.records.delete(c.id),this.events.emit(Et.deleted,c)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:zi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=Y("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Et.created,e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.updated,e=>{const r=Et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.deleted,e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}class hp extends qc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new _t.exports.EventEmitter,this.name=Bg,this.version=Hg,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const c=this.formatTarget(i),p={target:c,expiry:n};this.expirations.set(c,p),this.checkExpiry(c,p),this.events.emit(pt.created,{target:c,expiration:p})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{this.isInitialized();const n=this.formatTarget(i);if(this.has(n)){const c=this.getExpiration(n);this.expirations.delete(n),this.events.emit(pt.deleted,{target:n,expiration:c})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return uf(e);if(typeof e=="number")return hf(e);const{message:r}=Y("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=Y("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;ee.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(pt.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pt.created,e=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.expired,e=>{const r=pt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.deleted,e=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}}var lp=Object.defineProperty,Ps=Object.getOwnPropertySymbols,fp=Object.prototype.hasOwnProperty,dp=Object.prototype.propertyIsEnumerable,Ns=(t,e,r)=>e in t?lp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cs=(t,e)=>{for(var r in e||(e={}))fp.call(e,r)&&Ns(t,r,e[r]);if(Ps)for(var r of Ps(e))dp.call(e,r)&&Ns(t,r,e[r]);return t};class en extends Lc{constructor(e){super(e),this.protocol=ro,this.version=_g,this.name=Qi,this.events=new _t.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||bg.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new Sr.HeartBeat,this.crypto=new Kg(this,this.logger,e==null?void 0:e.keychain),this.history=new up(this,this.logger),this.expirer=new hp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new vc(Cs(Cs({},wg),e==null?void 0:e.storageOptions)),this.relayer=new np({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new cp(this,this.logger)}static async init(e){const r=new en(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initilization Success")}catch(e){throw this.logger.warn(`Core Initilization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const gp=en,no="wc",so=2,ao="client",tn=`${no}@${so}:${ao}:`,yi={name:ao,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},pp="proposal",yp="session",Hr=ee.SEVEN_DAYS,_p="engine",_r={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1115}}},bp="request";var wp=Object.defineProperty,mp=Object.defineProperties,vp=Object.getOwnPropertyDescriptors,Rs=Object.getOwnPropertySymbols,Ep=Object.prototype.hasOwnProperty,Dp=Object.prototype.propertyIsEnumerable,Fs=(t,e,r)=>e in t?wp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ft=(t,e)=>{for(var r in e||(e={}))Ep.call(e,r)&&Fs(t,r,e[r]);if(Rs)for(var r of Rs(e))Dp.call(e,r)&&Fs(t,r,e[r]);return t},Us=(t,e)=>mp(t,vp(e));class Sp extends Vc{constructor(e){super(e),this.name=_p,this.events=new _t.exports,this.initialized=!1,this.ignoredPayloadTypes=[Jt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(_r)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,relays:c}=r;let p=i,u,g=!1;if(p&&(g=this.client.core.pairing.pairings.get(p).active),!p||!g){const{topic:M,uri:q}=await this.client.core.pairing.create();p=M,u=q}const O=await this.client.core.crypto.generateKeyPair(),S={requiredNamespaces:n,relays:c!=null?c:[{protocol:io}],proposer:{publicKey:O,metadata:this.client.metadata}},{reject:P,resolve:$,done:N}=Wt();if(this.events.once(Ue("session_connect"),async({error:M,session:q})=>{if(M)P(M);else if(q){q.self.publicKey=O;const _=Us(Ft({},q),{requiredNamespaces:n});await this.client.session.set(q.topic,_),await this.setExpiry(q.topic,q.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:q.peer.metadata}),$(_)}}),!p){const{message:M}=Y("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(M)}const A=await this.sendRequest(p,"wc_sessionPropose",S),H=At(ee.FIVE_MINUTES);return await this.setProposal(A,Ft({id:A,expiry:H},S)),{uri:u,approval:N}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:c}=r,{pairingTopic:p,proposer:u,requiredNamespaces:g}=this.client.proposal.get(i),O=await this.client.core.crypto.generateKeyPair(),S=u.publicKey,P=await this.client.core.crypto.generateSharedKey(O,S),$={relay:{protocol:n!=null?n:"irn"},namespaces:c,requiredNamespaces:g,controller:{publicKey:O,metadata:this.client.metadata},expiry:At(Hr)};await this.client.core.relayer.subscribe(P);const N=await this.sendRequest(P,"wc_sessionSettle",$),{done:A,resolve:H,reject:M}=Wt();this.events.once(Ue("session_approve",N),({error:_})=>{_?M(_):H(this.client.session.get(P))});const q=Us(Ft({},$),{topic:P,acknowledged:!1,self:$.controller,peer:{publicKey:u.publicKey,metadata:u.metadata},controller:O});return await this.client.session.set(P,q),await this.setExpiry(P,At(Hr)),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:q.peer.metadata}),p&&i&&(await this.sendResult(i,p,{relay:{protocol:n!=null?n:"irn"},responderPublicKey:O}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p})),{topic:P,acknowledged:A}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,n),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:p,resolve:u,reject:g}=Wt();return this.events.once(Ue("session_update",c),({error:O})=>{O?g(O):u()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:p}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:p,reject:u}=Wt();return this.events.once(Ue("session_extend",n),({error:g})=>{g?u(g):p()}),await this.setExpiry(i,At(Hr)),{acknowledged:c}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:c}=r,p=await this.sendRequest(c,"wc_sessionRequest",{request:n,chainId:i}),{done:u,resolve:g,reject:O}=Wt();return this.events.once(Ue("session_request",p),({error:S,result:P})=>{S?O(S):g(P)}),await u()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:c}=n;Ut(n)?await this.sendResult(c,i,n.result):Tt(n)&&await this.sendError(c,i,n.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:p,reject:u}=Wt();this.events.once(Ue("session_ping",n),({error:g})=>{g?u(g):p()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:c}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:c})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Of(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=_r.wc_sessionRequest.req.ttl,{id:n,topic:c,params:p}=r;await this.client.pendingRequest.set(n,{id:n,topic:c,params:p}),i&&this.client.core.expirer.set(n,i)},this.sendRequest=async(r,i,n)=>{const c=zi(i,n),p=await this.client.core.crypto.encode(r,c),u=_r[i].req;return this.client.core.history.set(r,c),this.client.core.relayer.publish(r,p,u),c.id},this.sendResult=async(r,i,n)=>{const c=$i(r,n),p=await this.client.core.crypto.encode(i,c),u=await this.client.core.history.get(i,r),g=_r[u.request.method].res;this.client.core.relayer.publish(i,p,g),await this.client.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const c=Li(r,n),p=await this.client.core.crypto.encode(i,c),u=await this.client.core.history.get(i,r),g=_r[u.request.method].res;this.client.core.relayer.publish(i,p,g),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Lt(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Lt(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,c=n.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,c=(await this.client.core.history.get(i,n.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:c}=i;try{this.isValidConnect(Ft({},i.params));const p=At(ee.FIVE_MINUTES),u=Ft({id:c,pairingTopic:r,expiry:p},n);await this.setProposal(c,u),this.client.events.emit("session_proposal",{id:c,params:u})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Ut(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const p=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const u=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:u});const g=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:g});const O=await this.client.core.crypto.generateSharedKey(u,g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:O});const S=await this.client.core.relayer.subscribe(O);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:S}),await this.client.core.pairing.activate({topic:r})}else Tt(i)&&(await this.client.proposal.delete(n,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:p,controller:u,expiry:g,namespaces:O}=i.params,S={topic:r,relay:p,expiry:g,namespaces:O,acknowledged:!0,controller:u.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Ue("session_connect"),{session:S})}catch(p){await this.sendError(n,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Ut(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ue("session_approve",n),{})):Tt(i)&&(await this.client.session.delete(r,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:c}=i;try{this.isValidUpdate(Ft({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(c,r,!0),this.client.events.emit("session_update",{id:c,topic:r,params:n})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Ut(i)?this.events.emit(Ue("session_update",n),{}):Tt(i)&&this.events.emit(Ue("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,At(Hr)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(c){await this.sendError(n,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Ut(i)?this.events.emit(Ue("session_extend",n),{}):Tt(i)&&this.events.emit(Ue("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(c){await this.sendError(n,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Ut(i)?this.events.emit(Ue("session_ping",n),{}):Tt(i)&&this.events.emit(Ue("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await this.sendResult(n,r,!0),await this.deleteSession(r),this.client.events.emit("session_delete",{id:n,topic:r})}catch(c){await this.sendError(n,r,c),this.client.logger.error(c)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:c}=i;try{this.isValidRequest(Ft({topic:r},c)),await this.setPendingSessionRequest({id:n,topic:r,params:c}),this.client.events.emit("session_request",{id:n,topic:r,params:c})}catch(p){await this.sendError(n,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Ut(i)?this.events.emit(Ue("session_request",n),{result:i.result}):Tt(i)&&this.events.emit(Ue("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:c}=i;try{this.isValidEmit(Ft({topic:r},c)),this.client.events.emit("session_event",{id:n,topic:r,params:c})}catch(p){await this.sendError(n,r,p),this.client.logger.error(p)}},this.isValidConnect=async r=>{if(!nt(r)){const{message:u}=Y("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,relays:c}=r;yt(i)||await this.isValidPairingTopic(i);const p=Rf(n,"connect()");if(p)throw new Error(p.message);if(!Ff(c,!0)){const{message:u}=Y("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}},this.isValidApprove=async r=>{if(!nt(r))throw new Error(Y("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:c}=r;await this.isValidProposalId(i);const p=this.client.proposal.get(i),u=di(n,"approve()");if(u)throw new Error(u.message);const g=ds(p.requiredNamespaces,n,"update()");if(g)throw new Error(g.message);if(!Ze(c,!0)){const{message:O}=Y("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(O)}},this.isValidReject=async r=>{if(!nt(r)){const{message:c}=Y("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!Lf(n)){const{message:c}=Y("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!nt(r)){const{message:O}=Y("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(O)}const{relay:i,controller:n,namespaces:c,expiry:p}=r;if(!Va(i)){const{message:O}=Y("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(O)}const u=Pf(n,"onSessionSettleRequest()");if(u)throw new Error(u.message);const g=di(c,"onSessionSettleRequest()");if(g)throw new Error(g.message);if(Lt(p)){const{message:O}=Y("EXPIRED","onSessionSettleRequest()");throw new Error(O)}},this.isValidUpdate=async r=>{if(!nt(r)){const{message:g}=Y("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(g)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const c=this.client.session.get(i),p=di(n,"update()");if(p)throw new Error(p.message);const u=ds(c.requiredNamespaces,n,"update()");if(u)throw new Error(u.message)},this.isValidExtend=async r=>{if(!nt(r)){const{message:n}=Y("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!nt(r)){const{message:u}=Y("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(u)}const{topic:i,request:n,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:p}=this.client.session.get(i);if(!fs(p,c)){const{message:u}=Y("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(u)}if(!Mf(n)){const{message:u}=Y("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(u)}if(!zf(p,c,n.method)){const{message:u}=Y("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(u)}},this.isValidRespond=async r=>{if(!nt(r)){const{message:c}=Y("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!jf(n)){const{message:c}=Y("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!nt(r)){const{message:n}=Y("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!nt(r)){const{message:u}=Y("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(u)}const{topic:i,event:n,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:p}=this.client.session.get(i);if(!fs(p,c)){const{message:u}=Y("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(u)}if(!$f(n)){const{message:u}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(u)}if(!Bf(p,c,n.name)){const{message:u}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(u)}},this.isValidDisconnect=async r=>{if(!nt(r)){const{message:n}=Y("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=Y("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(st.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);ji(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Gs(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(pt.expired,async e=>{const{topic:r,id:i}=Ba(e.target);if(i&&this.getPendingSessionRequests()[i])return await this.deletePendingSessionRequest(i,Y("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&await this.deleteProposal(i,!0)})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:r}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Lt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=Y("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:r}=Y("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=Y("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Lt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=Y("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:r}=Y("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=Y("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Uf(e)){const{message:r}=Y("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=Y("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Lt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=Y("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Op extends ri{constructor(e,r){super(e,r,pp,tn),this.core=e,this.logger=r}}class xp extends ri{constructor(e,r){super(e,r,yp,tn),this.core=e,this.logger=r}}class Ip extends ri{constructor(e,r){super(e,r,bp,tn),this.core=e,this.logger=r}}class rn extends Kc{constructor(e){super(e),this.protocol=no,this.version=so,this.name=yi.name,this.events=new _t.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||yi.name,this.metadata=(e==null?void 0:e.metadata)||nf();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||yi.logger}));this.core=(e==null?void 0:e.core)||new gp(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new xp(this.core,this.logger),this.proposal=new Op(this.core,this.logger),this.pendingRequest=new Ip(this.core,this.logger),this.engine=new Sp(this)}static async init(e){const r=new rn(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initilization Success")}catch(e){throw this.logger.info("SignClient Initilization Failure"),this.logger.error(e.message),e}}}var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=xe.getLocation=xe.getLocationOrThrow=xe.getNavigator=xe.getNavigatorOrThrow=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function Xt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}xe.getFromWindow=Xt;function sr(t){const e=Xt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}xe.getFromWindowOrThrow=sr;function Tp(){return sr("document")}xe.getDocumentOrThrow=Tp;function Ap(){return Xt("document")}xe.getDocument=Ap;function Pp(){return sr("navigator")}xe.getNavigatorOrThrow=Pp;function Np(){return Xt("navigator")}xe.getNavigator=Np;function Cp(){return sr("location")}xe.getLocationOrThrow=Cp;function Rp(){return Xt("location")}xe.getLocation=Rp;function Fp(){return sr("crypto")}xe.getCryptoOrThrow=Fp;function Up(){return Xt("crypto")}xe.getCrypto=Up;function Lp(){return sr("localStorage")}xe.getLocalStorageOrThrow=Lp;function Mp(){return Xt("localStorage")}xe.getLocalStorage=Mp;var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.getWindowMetadata=void 0;const Ls=xe;function jp(){let t,e;try{t=Ls.getDocumentOrThrow(),e=Ls.getLocationOrThrow()}catch{return null}function r(){const P=t.getElementsByTagName("link"),$=[];for(let N=0;N<P.length;N++){const A=P[N],H=A.getAttribute("rel");if(H&&H.toLowerCase().indexOf("icon")>-1){const M=A.getAttribute("href");if(M)if(M.toLowerCase().indexOf("https:")===-1&&M.toLowerCase().indexOf("http:")===-1&&M.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(M.indexOf("/")===0)q+=M;else{const _=e.pathname.split("/");_.pop();const E=_.join("/");q+=E+"/"+M}$.push(q)}else if(M.indexOf("//")===0){const q=e.protocol+M;$.push(q)}else $.push(M)}}return $}function i(...P){const $=t.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const A=$[N],H=["itemprop","property","name"].map(M=>A.getAttribute(M)).filter(M=>M?P.includes(M):!1);if(H.length&&H){const M=A.getAttribute("content");if(M)return M}}return""}function n(){let P=i("name","og:site_name","og:title","twitter:title");return P||(P=t.title),P}function c(){return i("description","og:description","twitter:description","keywords")}const p=n(),u=c(),g=e.origin,O=r();return{description:u,url:g,icons:O,name:p}}nn.getWindowMetadata=jp;var $p={};(function(t){const e=qs,r=Ks,i=Hs,n=Ca,c=_=>_==null,p=Symbol("encodeFragmentIdentifier");function u(_){switch(_.arrayFormat){case"index":return E=>(b,w)=>{const m=b.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),"[",m,"]"].join("")]:[...b,[S(E,_),"[",S(m,_),"]=",S(w,_)].join("")]};case"bracket":return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),"[]"].join("")]:[...b,[S(E,_),"[]=",S(w,_)].join("")];case"colon-list-separator":return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,[S(E,_),":list="].join("")]:[...b,[S(E,_),":list=",S(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const E=_.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(w,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?w:(m=m===null?"":m,w.length===0?[[S(b,_),E,S(m,_)].join("")]:[[w,S(m,_)].join(_.arrayFormatSeparator)])}default:return E=>(b,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?b:w===null?[...b,S(E,_)]:[...b,[S(E,_),"=",S(w,_)].join("")]}}function g(_){let E;switch(_.arrayFormat){case"index":return(b,w,m)=>{if(E=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!E){m[b]=w;return}m[b]===void 0&&(m[b]={}),m[b][E[1]]=w};case"bracket":return(b,w,m)=>{if(E=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!E){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"colon-list-separator":return(b,w,m)=>{if(E=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!E){m[b]=w;return}if(m[b]===void 0){m[b]=[w];return}m[b]=[].concat(m[b],w)};case"comma":case"separator":return(b,w,m)=>{const s=typeof w=="string"&&w.includes(_.arrayFormatSeparator),l=typeof w=="string"&&!s&&P(w,_).includes(_.arrayFormatSeparator);w=l?P(w,_):w;const B=s||l?w.split(_.arrayFormatSeparator).map(o=>P(o,_)):w===null?w:P(w,_);m[b]=B};case"bracket-separator":return(b,w,m)=>{const s=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!s){m[b]=w&&P(w,_);return}const l=w===null?[]:w.split(_.arrayFormatSeparator).map(B=>P(B,_));if(m[b]===void 0){m[b]=l;return}m[b]=[].concat(m[b],l)};default:return(b,w,m)=>{if(m[b]===void 0){m[b]=w;return}m[b]=[].concat(m[b],w)}}}function O(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function S(_,E){return E.encode?E.strict?e(_):encodeURIComponent(_):_}function P(_,E){return E.decode?r(_):_}function $(_){return Array.isArray(_)?_.sort():typeof _=="object"?$(Object.keys(_)).sort((E,b)=>Number(E)-Number(b)).map(E=>_[E]):_}function N(_){const E=_.indexOf("#");return E!==-1&&(_=_.slice(0,E)),_}function A(_){let E="";const b=_.indexOf("#");return b!==-1&&(E=_.slice(b)),E}function H(_){_=N(_);const E=_.indexOf("?");return E===-1?"":_.slice(E+1)}function M(_,E){return E.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):E.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function q(_,E){E=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},E),O(E.arrayFormatSeparator);const b=g(E),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const m of _.split("&")){if(m==="")continue;let[s,l]=i(E.decode?m.replace(/\+/g," "):m,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(E.arrayFormat)?l:P(l,E),b(P(s,E),l,w)}for(const m of Object.keys(w)){const s=w[m];if(typeof s=="object"&&s!==null)for(const l of Object.keys(s))s[l]=M(s[l],E);else w[m]=M(s,E)}return E.sort===!1?w:(E.sort===!0?Object.keys(w).sort():Object.keys(w).sort(E.sort)).reduce((m,s)=>{const l=w[s];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?m[s]=$(l):m[s]=l,m},Object.create(null))}t.extract=H,t.parse=q,t.stringify=(_,E)=>{if(!_)return"";E=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},E),O(E.arrayFormatSeparator);const b=l=>E.skipNull&&c(_[l])||E.skipEmptyString&&_[l]==="",w=u(E),m={};for(const l of Object.keys(_))b(l)||(m[l]=_[l]);const s=Object.keys(m);return E.sort!==!1&&s.sort(E.sort),s.map(l=>{const B=_[l];return B===void 0?"":B===null?S(l,E):Array.isArray(B)?B.length===0&&E.arrayFormat==="bracket-separator"?S(l,E)+"[]":B.reduce(w(l),[]).join("&"):S(l,E)+"="+S(B,E)}).filter(l=>l.length>0).join("&")},t.parseUrl=(_,E)=>{E=Object.assign({decode:!0},E);const[b,w]=i(_,"#");return Object.assign({url:b.split("?")[0]||"",query:q(H(_),E)},E&&E.parseFragmentIdentifier&&w?{fragmentIdentifier:P(w,E)}:{})},t.stringifyUrl=(_,E)=>{E=Object.assign({encode:!0,strict:!0,[p]:!0},E);const b=N(_.url).split("?")[0]||"",w=t.extract(_.url),m=t.parse(w,{sort:!1}),s=Object.assign(m,_.query);let l=t.stringify(s,E);l&&(l=`?${l}`);let B=A(_.url);return _.fragmentIdentifier&&(B=`#${E[p]?S(_.fragmentIdentifier,E):_.fragmentIdentifier}`),`${b}${l}${B}`},t.pick=(_,E,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[p]:!1},b);const{url:w,query:m,fragmentIdentifier:s}=t.parseUrl(_,b);return t.stringifyUrl({url:w,query:n(m,E),fragmentIdentifier:s},b)},t.exclude=(_,E,b)=>{const w=Array.isArray(E)?m=>!E.includes(m):(m,s)=>!E(m,s);return t.pick(_,w,b)}})($p);const zp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Bp(t,e){const{message:r,code:i}=zp[t];return{message:e?`${r} ${e}`:r,code:i}}function Hp(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Gr(t,e){let r;return e.rpcMap&&(r=e.rpcMap[qp([t])]),r}function qp(t){return Number(t[0].split(":")[1])}class Kp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Gr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}createHttpProvider(e,r){const i=r||Gr(e,this.namespace);return typeof i>"u"?void 0:new Mi(new Ws(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class Vp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Gr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Gr(e,this.namespace);return typeof i>"u"?void 0:new Mi(new Ws(i))}}const Ms="error",Gp="wss://relay.walletconnect.com",Wp="wc",kp="universal_provider",js=`${Wp}@${2}:${kp}:`;var Yp=Object.defineProperty,Jp=Object.defineProperties,Xp=Object.getOwnPropertyDescriptors,$s=Object.getOwnPropertySymbols,Zp=Object.prototype.hasOwnProperty,Qp=Object.prototype.propertyIsEnumerable,zs=(t,e,r)=>e in t?Yp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bs=(t,e)=>{for(var r in e||(e={}))Zp.call(e,r)&&zs(t,r,e[r]);if($s)for(var r of $s(e))Qp.call(e,r)&&zs(t,r,e[r]);return t},e0=(t,e)=>Jp(t,Xp(e));class sn{constructor(e){this.events=new _t.exports,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ms}))}static async init(e){const r=new sn(e);return await r.initialize(),r}async request(e,r){var i;const[n,c]=this.validateChain(r);return await this.getProvider(n).request({request:Bs({},e),chainId:`${n}:${c}`,topic:(i=this.session)==null?void 0:i.topic})}sendAsync(e,r,i){this.request(e,i).then(n=>r(null,n)).catch(n=>r(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return await this.request({method:"eth_requestAccounts",params:[]})}async disconnect(){if(!this.client)throw new Error("Sign Client not initialized");await this.client.disconnect({topic:this.session.topic,reason:Bp("USER_DISCONNECTED")})}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");return this.setNamespaces(e.namespaces),this.createProviders(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.session}setDefaultChain(e,r){const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,r)}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${js}/namespaces`),this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await rn.init({logger:this.providerOpts.logger||Ms,relayUrl:this.providerOpts.relayUrl||Gp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Kp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Vp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:n}=r,c=(i=this.client)==null?void 0:i.session.get(e);this.session=e0(Bs({},c),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",()=>{this.events.emit("session_delete")})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>this.getProvider(e).updateNamespace(this.session.namespaces[e]))}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${js}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Invalid namespace: ${r}`);return!r||!i?Hp(this.namespaces):[r,i]}}const n0=sn;export{n0 as UniversalProvider,sn as default};
