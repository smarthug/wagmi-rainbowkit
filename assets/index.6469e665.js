import{r as sr,c as or,s as hr,E as Fe}from"./index.0045b903.js";import{o as ar,a as fr,b as cr,d as ur,c as Ct,I as lr,g as Oe,J as Ae,H as dr}from"./http.9eb32b74.js";import{a as pr,g as mr,d as gr,b as He,s as vr,r as je,c as Ce,e as yr,m as Ne,f as Mr}from"./index.979787a7.js";import"./events.0e2dd351.js";const wr=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],fe=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],_r={1:"mainnet",3:"ropsten",4:"rinkeby",5:"goerli",42:"kovan"};var $e={exports:{}};(function(h){(function(r,s){function d(l,t){if(!l)throw new Error(t||"Assertion failed")}function g(l,t){l.super_=t;var i=function(){};i.prototype=t.prototype,l.prototype=new i,l.prototype.constructor=l}function u(l,t,i){if(u.isBN(l))return l;this.negative=0,this.words=null,this.length=0,this.red=null,l!==null&&((t==="le"||t==="be")&&(i=t,t=10),this._init(l||0,t||10,i||"be"))}typeof r=="object"?r.exports=u:s.BN=u,u.BN=u,u.wordSize=26;var q;try{q=sr.Buffer}catch{}u.isBN=function(t){return t instanceof u?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===u.wordSize&&Array.isArray(t.words)},u.max=function(t,i){return t.cmp(i)>0?t:i},u.min=function(t,i){return t.cmp(i)<0?t:i},u.prototype._init=function(t,i,n){if(typeof t=="number")return this._initNumber(t,i,n);if(typeof t=="object")return this._initArray(t,i,n);i==="hex"&&(i=16),d(i===(i|0)&&i>=2&&i<=36),t=t.toString().replace(/\s+/g,"");var o=0;t[0]==="-"&&o++,i===16?this._parseHex(t,o):this._parseBase(t,i,o),t[0]==="-"&&(this.negative=1),this.strip(),n==="le"&&this._initArray(this.toArray(),i,n)},u.prototype._initNumber=function(t,i,n){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(d(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),n==="le"&&this._initArray(this.toArray(),i,n)},u.prototype._initArray=function(t,i,n){if(d(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var o=0;o<this.length;o++)this.words[o]=0;var c,p,m=0;if(n==="be")for(o=t.length-1,c=0;o>=0;o-=3)p=t[o]|t[o-1]<<8|t[o-2]<<16,this.words[c]|=p<<m&67108863,this.words[c+1]=p>>>26-m&67108863,m+=24,m>=26&&(m-=26,c++);else if(n==="le")for(o=0,c=0;o<t.length;o+=3)p=t[o]|t[o+1]<<8|t[o+2]<<16,this.words[c]|=p<<m&67108863,this.words[c+1]=p>>>26-m&67108863,m+=24,m>=26&&(m-=26,c++);return this.strip()};function mt(l,t,i){for(var n=0,o=Math.min(l.length,i),c=t;c<o;c++){var p=l.charCodeAt(c)-48;n<<=4,p>=49&&p<=54?n|=p-49+10:p>=17&&p<=22?n|=p-17+10:n|=p&15}return n}u.prototype._parseHex=function(t,i){this.length=Math.ceil((t.length-i)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,c,p=0;for(n=t.length-6,o=0;n>=i;n-=6)c=mt(t,n,n+6),this.words[o]|=c<<p&67108863,this.words[o+1]|=c>>>26-p&4194303,p+=24,p>=26&&(p-=26,o++);n+6!==i&&(c=mt(t,i,n+6),this.words[o]|=c<<p&67108863,this.words[o+1]|=c>>>26-p&4194303),this.strip()};function k(l,t,i,n){for(var o=0,c=Math.min(l.length,i),p=t;p<c;p++){var m=l.charCodeAt(p)-48;o*=n,m>=49?o+=m-49+10:m>=17?o+=m-17+10:o+=m}return o}u.prototype._parseBase=function(t,i,n){this.words=[0],this.length=1;for(var o=0,c=1;c<=67108863;c*=i)o++;o--,c=c/i|0;for(var p=t.length-n,m=p%o,a=Math.min(p,p-m)+n,e=0,f=n;f<a;f+=o)e=k(t,f,f+o,i),this.imuln(c),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e);if(m!==0){var w=1;for(e=k(t,f,t.length,i),f=0;f<m;f++)w*=i;this.imuln(w),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e)}},u.prototype.copy=function(t){t.words=new Array(this.length);for(var i=0;i<this.length;i++)t.words[i]=this.words[i];t.length=this.length,t.negative=this.negative,t.red=this.red},u.prototype.clone=function(){var t=new u(null);return this.copy(t),t},u.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},u.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},u.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},u.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var gt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],It=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],Mt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];u.prototype.toString=function(t,i){t=t||10,i=i|0||1;var n;if(t===16||t==="hex"){n="";for(var o=0,c=0,p=0;p<this.length;p++){var m=this.words[p],a=((m<<o|c)&16777215).toString(16);c=m>>>24-o&16777215,c!==0||p!==this.length-1?n=gt[6-a.length]+a+n:n=a+n,o+=2,o>=26&&(o-=26,p--)}for(c!==0&&(n=c.toString(16)+n);n.length%i!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}if(t===(t|0)&&t>=2&&t<=36){var e=It[t],f=Mt[t];n="";var w=this.clone();for(w.negative=0;!w.isZero();){var b=w.modn(f).toString(t);w=w.idivn(f),w.isZero()?n=b+n:n=gt[e-b.length]+b+n}for(this.isZero()&&(n="0"+n);n.length%i!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}d(!1,"Base should be between 2 and 36")},u.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&d(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},u.prototype.toJSON=function(){return this.toString(16)},u.prototype.toBuffer=function(t,i){return d(typeof q<"u"),this.toArrayLike(q,t,i)},u.prototype.toArray=function(t,i){return this.toArrayLike(Array,t,i)},u.prototype.toArrayLike=function(t,i,n){var o=this.byteLength(),c=n||Math.max(1,o);d(o<=c,"byte array longer than desired length"),d(c>0,"Requested array length <= 0"),this.strip();var p=i==="le",m=new t(c),a,e,f=this.clone();if(p){for(e=0;!f.isZero();e++)a=f.andln(255),f.iushrn(8),m[e]=a;for(;e<c;e++)m[e]=0}else{for(e=0;e<c-o;e++)m[e]=0;for(e=0;!f.isZero();e++)a=f.andln(255),f.iushrn(8),m[c-e-1]=a}return m},Math.clz32?u.prototype._countBits=function(t){return 32-Math.clz32(t)}:u.prototype._countBits=function(t){var i=t,n=0;return i>=4096&&(n+=13,i>>>=13),i>=64&&(n+=7,i>>>=7),i>=8&&(n+=4,i>>>=4),i>=2&&(n+=2,i>>>=2),n+i},u.prototype._zeroBits=function(t){if(t===0)return 26;var i=t,n=0;return(i&8191)===0&&(n+=13,i>>>=13),(i&127)===0&&(n+=7,i>>>=7),(i&15)===0&&(n+=4,i>>>=4),(i&3)===0&&(n+=2,i>>>=2),(i&1)===0&&n++,n},u.prototype.bitLength=function(){var t=this.words[this.length-1],i=this._countBits(t);return(this.length-1)*26+i};function wt(l){for(var t=new Array(l.bitLength()),i=0;i<t.length;i++){var n=i/26|0,o=i%26;t[i]=(l.words[n]&1<<o)>>>o}return t}u.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,i=0;i<this.length;i++){var n=this._zeroBits(this.words[i]);if(t+=n,n!==26)break}return t},u.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},u.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},u.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},u.prototype.isNeg=function(){return this.negative!==0},u.prototype.neg=function(){return this.clone().ineg()},u.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},u.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]|t.words[i];return this.strip()},u.prototype.ior=function(t){return d((this.negative|t.negative)===0),this.iuor(t)},u.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},u.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},u.prototype.iuand=function(t){var i;this.length>t.length?i=t:i=this;for(var n=0;n<i.length;n++)this.words[n]=this.words[n]&t.words[n];return this.length=i.length,this.strip()},u.prototype.iand=function(t){return d((this.negative|t.negative)===0),this.iuand(t)},u.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},u.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},u.prototype.iuxor=function(t){var i,n;this.length>t.length?(i=this,n=t):(i=t,n=this);for(var o=0;o<n.length;o++)this.words[o]=i.words[o]^n.words[o];if(this!==i)for(;o<i.length;o++)this.words[o]=i.words[o];return this.length=i.length,this.strip()},u.prototype.ixor=function(t){return d((this.negative|t.negative)===0),this.iuxor(t)},u.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},u.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},u.prototype.inotn=function(t){d(typeof t=="number"&&t>=0);var i=Math.ceil(t/26)|0,n=t%26;this._expand(i),n>0&&i--;for(var o=0;o<i;o++)this.words[o]=~this.words[o]&67108863;return n>0&&(this.words[o]=~this.words[o]&67108863>>26-n),this.strip()},u.prototype.notn=function(t){return this.clone().inotn(t)},u.prototype.setn=function(t,i){d(typeof t=="number"&&t>=0);var n=t/26|0,o=t%26;return this._expand(n+1),i?this.words[n]=this.words[n]|1<<o:this.words[n]=this.words[n]&~(1<<o),this.strip()},u.prototype.iadd=function(t){var i;if(this.negative!==0&&t.negative===0)return this.negative=0,i=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,i=this.isub(t),t.negative=1,i._normSign();var n,o;this.length>t.length?(n=this,o=t):(n=t,o=this);for(var c=0,p=0;p<o.length;p++)i=(n.words[p]|0)+(o.words[p]|0)+c,this.words[p]=i&67108863,c=i>>>26;for(;c!==0&&p<n.length;p++)i=(n.words[p]|0)+c,this.words[p]=i&67108863,c=i>>>26;if(this.length=n.length,c!==0)this.words[this.length]=c,this.length++;else if(n!==this)for(;p<n.length;p++)this.words[p]=n.words[p];return this},u.prototype.add=function(t){var i;return t.negative!==0&&this.negative===0?(t.negative=0,i=this.sub(t),t.negative^=1,i):t.negative===0&&this.negative!==0?(this.negative=0,i=t.sub(this),this.negative=1,i):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},u.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var i=this.iadd(t);return t.negative=1,i._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var n=this.cmp(t);if(n===0)return this.negative=0,this.length=1,this.words[0]=0,this;var o,c;n>0?(o=this,c=t):(o=t,c=this);for(var p=0,m=0;m<c.length;m++)i=(o.words[m]|0)-(c.words[m]|0)+p,p=i>>26,this.words[m]=i&67108863;for(;p!==0&&m<o.length;m++)i=(o.words[m]|0)+p,p=i>>26,this.words[m]=i&67108863;if(p===0&&m<o.length&&o!==this)for(;m<o.length;m++)this.words[m]=o.words[m];return this.length=Math.max(this.length,m),o!==this&&(this.negative=1),this.strip()},u.prototype.sub=function(t){return this.clone().isub(t)};function yt(l,t,i){i.negative=t.negative^l.negative;var n=l.length+t.length|0;i.length=n,n=n-1|0;var o=l.words[0]|0,c=t.words[0]|0,p=o*c,m=p&67108863,a=p/67108864|0;i.words[0]=m;for(var e=1;e<n;e++){for(var f=a>>>26,w=a&67108863,b=Math.min(e,t.length-1),S=Math.max(0,e-l.length+1);S<=b;S++){var I=e-S|0;o=l.words[I]|0,c=t.words[S]|0,p=o*c+w,f+=p/67108864|0,w=p&67108863}i.words[e]=w|0,a=f|0}return a!==0?i.words[e]=a|0:i.length--,i.strip()}var kt=function(t,i,n){var o=t.words,c=i.words,p=n.words,m=0,a,e,f,w=o[0]|0,b=w&8191,S=w>>>13,I=o[1]|0,E=I&8191,T=I>>>13,_t=o[2]|0,O=_t&8191,A=_t>>>13,pe=o[3]|0,U=pe&8191,B=pe>>>13,me=o[4]|0,L=me&8191,P=me>>>13,ge=o[5]|0,F=ge&8191,H=ge>>>13,ve=o[6]|0,j=ve&8191,$=ve>>>13,ye=o[7]|0,Z=ye&8191,J=ye>>>13,Me=o[8]|0,W=Me&8191,z=Me>>>13,we=o[9]|0,D=we&8191,K=we>>>13,_e=c[0]|0,Q=_e&8191,G=_e>>>13,be=c[1]|0,V=be&8191,Y=be>>>13,Se=c[2]|0,X=Se&8191,tt=Se>>>13,Ie=c[3]|0,et=Ie&8191,rt=Ie>>>13,xe=c[4]|0,it=xe&8191,nt=xe>>>13,Re=c[5]|0,st=Re&8191,ot=Re>>>13,ke=c[6]|0,ht=ke&8191,at=ke>>>13,Ee=c[7]|0,ft=Ee&8191,ct=Ee>>>13,qe=c[8]|0,ut=qe&8191,lt=qe>>>13,Te=c[9]|0,dt=Te&8191,pt=Te>>>13;n.negative=t.negative^i.negative,n.length=19,a=Math.imul(b,Q),e=Math.imul(b,G),e=e+Math.imul(S,Q)|0,f=Math.imul(S,G);var Ft=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,a=Math.imul(E,Q),e=Math.imul(E,G),e=e+Math.imul(T,Q)|0,f=Math.imul(T,G),a=a+Math.imul(b,V)|0,e=e+Math.imul(b,Y)|0,e=e+Math.imul(S,V)|0,f=f+Math.imul(S,Y)|0;var Ht=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Ht>>>26)|0,Ht&=67108863,a=Math.imul(O,Q),e=Math.imul(O,G),e=e+Math.imul(A,Q)|0,f=Math.imul(A,G),a=a+Math.imul(E,V)|0,e=e+Math.imul(E,Y)|0,e=e+Math.imul(T,V)|0,f=f+Math.imul(T,Y)|0,a=a+Math.imul(b,X)|0,e=e+Math.imul(b,tt)|0,e=e+Math.imul(S,X)|0,f=f+Math.imul(S,tt)|0;var jt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(jt>>>26)|0,jt&=67108863,a=Math.imul(U,Q),e=Math.imul(U,G),e=e+Math.imul(B,Q)|0,f=Math.imul(B,G),a=a+Math.imul(O,V)|0,e=e+Math.imul(O,Y)|0,e=e+Math.imul(A,V)|0,f=f+Math.imul(A,Y)|0,a=a+Math.imul(E,X)|0,e=e+Math.imul(E,tt)|0,e=e+Math.imul(T,X)|0,f=f+Math.imul(T,tt)|0,a=a+Math.imul(b,et)|0,e=e+Math.imul(b,rt)|0,e=e+Math.imul(S,et)|0,f=f+Math.imul(S,rt)|0;var $t=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+($t>>>26)|0,$t&=67108863,a=Math.imul(L,Q),e=Math.imul(L,G),e=e+Math.imul(P,Q)|0,f=Math.imul(P,G),a=a+Math.imul(U,V)|0,e=e+Math.imul(U,Y)|0,e=e+Math.imul(B,V)|0,f=f+Math.imul(B,Y)|0,a=a+Math.imul(O,X)|0,e=e+Math.imul(O,tt)|0,e=e+Math.imul(A,X)|0,f=f+Math.imul(A,tt)|0,a=a+Math.imul(E,et)|0,e=e+Math.imul(E,rt)|0,e=e+Math.imul(T,et)|0,f=f+Math.imul(T,rt)|0,a=a+Math.imul(b,it)|0,e=e+Math.imul(b,nt)|0,e=e+Math.imul(S,it)|0,f=f+Math.imul(S,nt)|0;var Zt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Zt>>>26)|0,Zt&=67108863,a=Math.imul(F,Q),e=Math.imul(F,G),e=e+Math.imul(H,Q)|0,f=Math.imul(H,G),a=a+Math.imul(L,V)|0,e=e+Math.imul(L,Y)|0,e=e+Math.imul(P,V)|0,f=f+Math.imul(P,Y)|0,a=a+Math.imul(U,X)|0,e=e+Math.imul(U,tt)|0,e=e+Math.imul(B,X)|0,f=f+Math.imul(B,tt)|0,a=a+Math.imul(O,et)|0,e=e+Math.imul(O,rt)|0,e=e+Math.imul(A,et)|0,f=f+Math.imul(A,rt)|0,a=a+Math.imul(E,it)|0,e=e+Math.imul(E,nt)|0,e=e+Math.imul(T,it)|0,f=f+Math.imul(T,nt)|0,a=a+Math.imul(b,st)|0,e=e+Math.imul(b,ot)|0,e=e+Math.imul(S,st)|0,f=f+Math.imul(S,ot)|0;var Jt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,a=Math.imul(j,Q),e=Math.imul(j,G),e=e+Math.imul($,Q)|0,f=Math.imul($,G),a=a+Math.imul(F,V)|0,e=e+Math.imul(F,Y)|0,e=e+Math.imul(H,V)|0,f=f+Math.imul(H,Y)|0,a=a+Math.imul(L,X)|0,e=e+Math.imul(L,tt)|0,e=e+Math.imul(P,X)|0,f=f+Math.imul(P,tt)|0,a=a+Math.imul(U,et)|0,e=e+Math.imul(U,rt)|0,e=e+Math.imul(B,et)|0,f=f+Math.imul(B,rt)|0,a=a+Math.imul(O,it)|0,e=e+Math.imul(O,nt)|0,e=e+Math.imul(A,it)|0,f=f+Math.imul(A,nt)|0,a=a+Math.imul(E,st)|0,e=e+Math.imul(E,ot)|0,e=e+Math.imul(T,st)|0,f=f+Math.imul(T,ot)|0,a=a+Math.imul(b,ht)|0,e=e+Math.imul(b,at)|0,e=e+Math.imul(S,ht)|0,f=f+Math.imul(S,at)|0;var Wt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,a=Math.imul(Z,Q),e=Math.imul(Z,G),e=e+Math.imul(J,Q)|0,f=Math.imul(J,G),a=a+Math.imul(j,V)|0,e=e+Math.imul(j,Y)|0,e=e+Math.imul($,V)|0,f=f+Math.imul($,Y)|0,a=a+Math.imul(F,X)|0,e=e+Math.imul(F,tt)|0,e=e+Math.imul(H,X)|0,f=f+Math.imul(H,tt)|0,a=a+Math.imul(L,et)|0,e=e+Math.imul(L,rt)|0,e=e+Math.imul(P,et)|0,f=f+Math.imul(P,rt)|0,a=a+Math.imul(U,it)|0,e=e+Math.imul(U,nt)|0,e=e+Math.imul(B,it)|0,f=f+Math.imul(B,nt)|0,a=a+Math.imul(O,st)|0,e=e+Math.imul(O,ot)|0,e=e+Math.imul(A,st)|0,f=f+Math.imul(A,ot)|0,a=a+Math.imul(E,ht)|0,e=e+Math.imul(E,at)|0,e=e+Math.imul(T,ht)|0,f=f+Math.imul(T,at)|0,a=a+Math.imul(b,ft)|0,e=e+Math.imul(b,ct)|0,e=e+Math.imul(S,ft)|0,f=f+Math.imul(S,ct)|0;var zt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(zt>>>26)|0,zt&=67108863,a=Math.imul(W,Q),e=Math.imul(W,G),e=e+Math.imul(z,Q)|0,f=Math.imul(z,G),a=a+Math.imul(Z,V)|0,e=e+Math.imul(Z,Y)|0,e=e+Math.imul(J,V)|0,f=f+Math.imul(J,Y)|0,a=a+Math.imul(j,X)|0,e=e+Math.imul(j,tt)|0,e=e+Math.imul($,X)|0,f=f+Math.imul($,tt)|0,a=a+Math.imul(F,et)|0,e=e+Math.imul(F,rt)|0,e=e+Math.imul(H,et)|0,f=f+Math.imul(H,rt)|0,a=a+Math.imul(L,it)|0,e=e+Math.imul(L,nt)|0,e=e+Math.imul(P,it)|0,f=f+Math.imul(P,nt)|0,a=a+Math.imul(U,st)|0,e=e+Math.imul(U,ot)|0,e=e+Math.imul(B,st)|0,f=f+Math.imul(B,ot)|0,a=a+Math.imul(O,ht)|0,e=e+Math.imul(O,at)|0,e=e+Math.imul(A,ht)|0,f=f+Math.imul(A,at)|0,a=a+Math.imul(E,ft)|0,e=e+Math.imul(E,ct)|0,e=e+Math.imul(T,ft)|0,f=f+Math.imul(T,ct)|0,a=a+Math.imul(b,ut)|0,e=e+Math.imul(b,lt)|0,e=e+Math.imul(S,ut)|0,f=f+Math.imul(S,lt)|0;var Dt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,a=Math.imul(D,Q),e=Math.imul(D,G),e=e+Math.imul(K,Q)|0,f=Math.imul(K,G),a=a+Math.imul(W,V)|0,e=e+Math.imul(W,Y)|0,e=e+Math.imul(z,V)|0,f=f+Math.imul(z,Y)|0,a=a+Math.imul(Z,X)|0,e=e+Math.imul(Z,tt)|0,e=e+Math.imul(J,X)|0,f=f+Math.imul(J,tt)|0,a=a+Math.imul(j,et)|0,e=e+Math.imul(j,rt)|0,e=e+Math.imul($,et)|0,f=f+Math.imul($,rt)|0,a=a+Math.imul(F,it)|0,e=e+Math.imul(F,nt)|0,e=e+Math.imul(H,it)|0,f=f+Math.imul(H,nt)|0,a=a+Math.imul(L,st)|0,e=e+Math.imul(L,ot)|0,e=e+Math.imul(P,st)|0,f=f+Math.imul(P,ot)|0,a=a+Math.imul(U,ht)|0,e=e+Math.imul(U,at)|0,e=e+Math.imul(B,ht)|0,f=f+Math.imul(B,at)|0,a=a+Math.imul(O,ft)|0,e=e+Math.imul(O,ct)|0,e=e+Math.imul(A,ft)|0,f=f+Math.imul(A,ct)|0,a=a+Math.imul(E,ut)|0,e=e+Math.imul(E,lt)|0,e=e+Math.imul(T,ut)|0,f=f+Math.imul(T,lt)|0,a=a+Math.imul(b,dt)|0,e=e+Math.imul(b,pt)|0,e=e+Math.imul(S,dt)|0,f=f+Math.imul(S,pt)|0;var Kt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Kt>>>26)|0,Kt&=67108863,a=Math.imul(D,V),e=Math.imul(D,Y),e=e+Math.imul(K,V)|0,f=Math.imul(K,Y),a=a+Math.imul(W,X)|0,e=e+Math.imul(W,tt)|0,e=e+Math.imul(z,X)|0,f=f+Math.imul(z,tt)|0,a=a+Math.imul(Z,et)|0,e=e+Math.imul(Z,rt)|0,e=e+Math.imul(J,et)|0,f=f+Math.imul(J,rt)|0,a=a+Math.imul(j,it)|0,e=e+Math.imul(j,nt)|0,e=e+Math.imul($,it)|0,f=f+Math.imul($,nt)|0,a=a+Math.imul(F,st)|0,e=e+Math.imul(F,ot)|0,e=e+Math.imul(H,st)|0,f=f+Math.imul(H,ot)|0,a=a+Math.imul(L,ht)|0,e=e+Math.imul(L,at)|0,e=e+Math.imul(P,ht)|0,f=f+Math.imul(P,at)|0,a=a+Math.imul(U,ft)|0,e=e+Math.imul(U,ct)|0,e=e+Math.imul(B,ft)|0,f=f+Math.imul(B,ct)|0,a=a+Math.imul(O,ut)|0,e=e+Math.imul(O,lt)|0,e=e+Math.imul(A,ut)|0,f=f+Math.imul(A,lt)|0,a=a+Math.imul(E,dt)|0,e=e+Math.imul(E,pt)|0,e=e+Math.imul(T,dt)|0,f=f+Math.imul(T,pt)|0;var Qt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,a=Math.imul(D,X),e=Math.imul(D,tt),e=e+Math.imul(K,X)|0,f=Math.imul(K,tt),a=a+Math.imul(W,et)|0,e=e+Math.imul(W,rt)|0,e=e+Math.imul(z,et)|0,f=f+Math.imul(z,rt)|0,a=a+Math.imul(Z,it)|0,e=e+Math.imul(Z,nt)|0,e=e+Math.imul(J,it)|0,f=f+Math.imul(J,nt)|0,a=a+Math.imul(j,st)|0,e=e+Math.imul(j,ot)|0,e=e+Math.imul($,st)|0,f=f+Math.imul($,ot)|0,a=a+Math.imul(F,ht)|0,e=e+Math.imul(F,at)|0,e=e+Math.imul(H,ht)|0,f=f+Math.imul(H,at)|0,a=a+Math.imul(L,ft)|0,e=e+Math.imul(L,ct)|0,e=e+Math.imul(P,ft)|0,f=f+Math.imul(P,ct)|0,a=a+Math.imul(U,ut)|0,e=e+Math.imul(U,lt)|0,e=e+Math.imul(B,ut)|0,f=f+Math.imul(B,lt)|0,a=a+Math.imul(O,dt)|0,e=e+Math.imul(O,pt)|0,e=e+Math.imul(A,dt)|0,f=f+Math.imul(A,pt)|0;var Gt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,a=Math.imul(D,et),e=Math.imul(D,rt),e=e+Math.imul(K,et)|0,f=Math.imul(K,rt),a=a+Math.imul(W,it)|0,e=e+Math.imul(W,nt)|0,e=e+Math.imul(z,it)|0,f=f+Math.imul(z,nt)|0,a=a+Math.imul(Z,st)|0,e=e+Math.imul(Z,ot)|0,e=e+Math.imul(J,st)|0,f=f+Math.imul(J,ot)|0,a=a+Math.imul(j,ht)|0,e=e+Math.imul(j,at)|0,e=e+Math.imul($,ht)|0,f=f+Math.imul($,at)|0,a=a+Math.imul(F,ft)|0,e=e+Math.imul(F,ct)|0,e=e+Math.imul(H,ft)|0,f=f+Math.imul(H,ct)|0,a=a+Math.imul(L,ut)|0,e=e+Math.imul(L,lt)|0,e=e+Math.imul(P,ut)|0,f=f+Math.imul(P,lt)|0,a=a+Math.imul(U,dt)|0,e=e+Math.imul(U,pt)|0,e=e+Math.imul(B,dt)|0,f=f+Math.imul(B,pt)|0;var Vt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,a=Math.imul(D,it),e=Math.imul(D,nt),e=e+Math.imul(K,it)|0,f=Math.imul(K,nt),a=a+Math.imul(W,st)|0,e=e+Math.imul(W,ot)|0,e=e+Math.imul(z,st)|0,f=f+Math.imul(z,ot)|0,a=a+Math.imul(Z,ht)|0,e=e+Math.imul(Z,at)|0,e=e+Math.imul(J,ht)|0,f=f+Math.imul(J,at)|0,a=a+Math.imul(j,ft)|0,e=e+Math.imul(j,ct)|0,e=e+Math.imul($,ft)|0,f=f+Math.imul($,ct)|0,a=a+Math.imul(F,ut)|0,e=e+Math.imul(F,lt)|0,e=e+Math.imul(H,ut)|0,f=f+Math.imul(H,lt)|0,a=a+Math.imul(L,dt)|0,e=e+Math.imul(L,pt)|0,e=e+Math.imul(P,dt)|0,f=f+Math.imul(P,pt)|0;var Yt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,a=Math.imul(D,st),e=Math.imul(D,ot),e=e+Math.imul(K,st)|0,f=Math.imul(K,ot),a=a+Math.imul(W,ht)|0,e=e+Math.imul(W,at)|0,e=e+Math.imul(z,ht)|0,f=f+Math.imul(z,at)|0,a=a+Math.imul(Z,ft)|0,e=e+Math.imul(Z,ct)|0,e=e+Math.imul(J,ft)|0,f=f+Math.imul(J,ct)|0,a=a+Math.imul(j,ut)|0,e=e+Math.imul(j,lt)|0,e=e+Math.imul($,ut)|0,f=f+Math.imul($,lt)|0,a=a+Math.imul(F,dt)|0,e=e+Math.imul(F,pt)|0,e=e+Math.imul(H,dt)|0,f=f+Math.imul(H,pt)|0;var Xt=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,a=Math.imul(D,ht),e=Math.imul(D,at),e=e+Math.imul(K,ht)|0,f=Math.imul(K,at),a=a+Math.imul(W,ft)|0,e=e+Math.imul(W,ct)|0,e=e+Math.imul(z,ft)|0,f=f+Math.imul(z,ct)|0,a=a+Math.imul(Z,ut)|0,e=e+Math.imul(Z,lt)|0,e=e+Math.imul(J,ut)|0,f=f+Math.imul(J,lt)|0,a=a+Math.imul(j,dt)|0,e=e+Math.imul(j,pt)|0,e=e+Math.imul($,dt)|0,f=f+Math.imul($,pt)|0;var te=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(te>>>26)|0,te&=67108863,a=Math.imul(D,ft),e=Math.imul(D,ct),e=e+Math.imul(K,ft)|0,f=Math.imul(K,ct),a=a+Math.imul(W,ut)|0,e=e+Math.imul(W,lt)|0,e=e+Math.imul(z,ut)|0,f=f+Math.imul(z,lt)|0,a=a+Math.imul(Z,dt)|0,e=e+Math.imul(Z,pt)|0,e=e+Math.imul(J,dt)|0,f=f+Math.imul(J,pt)|0;var ee=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,a=Math.imul(D,ut),e=Math.imul(D,lt),e=e+Math.imul(K,ut)|0,f=Math.imul(K,lt),a=a+Math.imul(W,dt)|0,e=e+Math.imul(W,pt)|0,e=e+Math.imul(z,dt)|0,f=f+Math.imul(z,pt)|0;var re=(m+a|0)+((e&8191)<<13)|0;m=(f+(e>>>13)|0)+(re>>>26)|0,re&=67108863,a=Math.imul(D,dt),e=Math.imul(D,pt),e=e+Math.imul(K,dt)|0,f=Math.imul(K,pt);var ie=(m+a|0)+((e&8191)<<13)|0;return m=(f+(e>>>13)|0)+(ie>>>26)|0,ie&=67108863,p[0]=Ft,p[1]=Ht,p[2]=jt,p[3]=$t,p[4]=Zt,p[5]=Jt,p[6]=Wt,p[7]=zt,p[8]=Dt,p[9]=Kt,p[10]=Qt,p[11]=Gt,p[12]=Vt,p[13]=Yt,p[14]=Xt,p[15]=te,p[16]=ee,p[17]=re,p[18]=ie,m!==0&&(p[19]=m,n.length++),n};Math.imul||(kt=yt);function Nt(l,t,i){i.negative=t.negative^l.negative,i.length=l.length+t.length;for(var n=0,o=0,c=0;c<i.length-1;c++){var p=o;o=0;for(var m=n&67108863,a=Math.min(c,t.length-1),e=Math.max(0,c-l.length+1);e<=a;e++){var f=c-e,w=l.words[f]|0,b=t.words[e]|0,S=w*b,I=S&67108863;p=p+(S/67108864|0)|0,I=I+m|0,m=I&67108863,p=p+(I>>>26)|0,o+=p>>>26,p&=67108863}i.words[c]=m,n=p,p=o}return n!==0?i.words[c]=n:i.length--,i.strip()}function v(l,t,i){var n=new y;return n.mulp(l,t,i)}u.prototype.mulTo=function(t,i){var n,o=this.length+t.length;return this.length===10&&t.length===10?n=kt(this,t,i):o<63?n=yt(this,t,i):o<1024?n=Nt(this,t,i):n=v(this,t,i),n};function y(l,t){this.x=l,this.y=t}y.prototype.makeRBT=function(t){for(var i=new Array(t),n=u.prototype._countBits(t)-1,o=0;o<t;o++)i[o]=this.revBin(o,n,t);return i},y.prototype.revBin=function(t,i,n){if(t===0||t===n-1)return t;for(var o=0,c=0;c<i;c++)o|=(t&1)<<i-c-1,t>>=1;return o},y.prototype.permute=function(t,i,n,o,c,p){for(var m=0;m<p;m++)o[m]=i[t[m]],c[m]=n[t[m]]},y.prototype.transform=function(t,i,n,o,c,p){this.permute(p,t,i,n,o,c);for(var m=1;m<c;m<<=1)for(var a=m<<1,e=Math.cos(2*Math.PI/a),f=Math.sin(2*Math.PI/a),w=0;w<c;w+=a)for(var b=e,S=f,I=0;I<m;I++){var E=n[w+I],T=o[w+I],_t=n[w+I+m],O=o[w+I+m],A=b*_t-S*O;O=b*O+S*_t,_t=A,n[w+I]=E+_t,o[w+I]=T+O,n[w+I+m]=E-_t,o[w+I+m]=T-O,I!==a&&(A=e*b-f*S,S=e*S+f*b,b=A)}},y.prototype.guessLen13b=function(t,i){var n=Math.max(i,t)|1,o=n&1,c=0;for(n=n/2|0;n;n=n>>>1)c++;return 1<<c+1+o},y.prototype.conjugate=function(t,i,n){if(!(n<=1))for(var o=0;o<n/2;o++){var c=t[o];t[o]=t[n-o-1],t[n-o-1]=c,c=i[o],i[o]=-i[n-o-1],i[n-o-1]=-c}},y.prototype.normalize13b=function(t,i){for(var n=0,o=0;o<i/2;o++){var c=Math.round(t[2*o+1]/i)*8192+Math.round(t[2*o]/i)+n;t[o]=c&67108863,c<67108864?n=0:n=c/67108864|0}return t},y.prototype.convert13b=function(t,i,n,o){for(var c=0,p=0;p<i;p++)c=c+(t[p]|0),n[2*p]=c&8191,c=c>>>13,n[2*p+1]=c&8191,c=c>>>13;for(p=2*i;p<o;++p)n[p]=0;d(c===0),d((c&-8192)===0)},y.prototype.stub=function(t){for(var i=new Array(t),n=0;n<t;n++)i[n]=0;return i},y.prototype.mulp=function(t,i,n){var o=2*this.guessLen13b(t.length,i.length),c=this.makeRBT(o),p=this.stub(o),m=new Array(o),a=new Array(o),e=new Array(o),f=new Array(o),w=new Array(o),b=new Array(o),S=n.words;S.length=o,this.convert13b(t.words,t.length,m,o),this.convert13b(i.words,i.length,f,o),this.transform(m,p,a,e,o,c),this.transform(f,p,w,b,o,c);for(var I=0;I<o;I++){var E=a[I]*w[I]-e[I]*b[I];e[I]=a[I]*b[I]+e[I]*w[I],a[I]=E}return this.conjugate(a,e,o),this.transform(a,e,S,p,o,c),this.conjugate(S,p,o),this.normalize13b(S,o),n.negative=t.negative^i.negative,n.length=t.length+i.length,n.strip()},u.prototype.mul=function(t){var i=new u(null);return i.words=new Array(this.length+t.length),this.mulTo(t,i)},u.prototype.mulf=function(t){var i=new u(null);return i.words=new Array(this.length+t.length),v(this,t,i)},u.prototype.imul=function(t){return this.clone().mulTo(t,this)},u.prototype.imuln=function(t){d(typeof t=="number"),d(t<67108864);for(var i=0,n=0;n<this.length;n++){var o=(this.words[n]|0)*t,c=(o&67108863)+(i&67108863);i>>=26,i+=o/67108864|0,i+=c>>>26,this.words[n]=c&67108863}return i!==0&&(this.words[n]=i,this.length++),this},u.prototype.muln=function(t){return this.clone().imuln(t)},u.prototype.sqr=function(){return this.mul(this)},u.prototype.isqr=function(){return this.imul(this.clone())},u.prototype.pow=function(t){var i=wt(t);if(i.length===0)return new u(1);for(var n=this,o=0;o<i.length&&i[o]===0;o++,n=n.sqr());if(++o<i.length)for(var c=n.sqr();o<i.length;o++,c=c.sqr())i[o]!==0&&(n=n.mul(c));return n},u.prototype.iushln=function(t){d(typeof t=="number"&&t>=0);var i=t%26,n=(t-i)/26,o=67108863>>>26-i<<26-i,c;if(i!==0){var p=0;for(c=0;c<this.length;c++){var m=this.words[c]&o,a=(this.words[c]|0)-m<<i;this.words[c]=a|p,p=m>>>26-i}p&&(this.words[c]=p,this.length++)}if(n!==0){for(c=this.length-1;c>=0;c--)this.words[c+n]=this.words[c];for(c=0;c<n;c++)this.words[c]=0;this.length+=n}return this.strip()},u.prototype.ishln=function(t){return d(this.negative===0),this.iushln(t)},u.prototype.iushrn=function(t,i,n){d(typeof t=="number"&&t>=0);var o;i?o=(i-i%26)/26:o=0;var c=t%26,p=Math.min((t-c)/26,this.length),m=67108863^67108863>>>c<<c,a=n;if(o-=p,o=Math.max(0,o),a){for(var e=0;e<p;e++)a.words[e]=this.words[e];a.length=p}if(p!==0)if(this.length>p)for(this.length-=p,e=0;e<this.length;e++)this.words[e]=this.words[e+p];else this.words[0]=0,this.length=1;var f=0;for(e=this.length-1;e>=0&&(f!==0||e>=o);e--){var w=this.words[e]|0;this.words[e]=f<<26-c|w>>>c,f=w&m}return a&&f!==0&&(a.words[a.length++]=f),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},u.prototype.ishrn=function(t,i,n){return d(this.negative===0),this.iushrn(t,i,n)},u.prototype.shln=function(t){return this.clone().ishln(t)},u.prototype.ushln=function(t){return this.clone().iushln(t)},u.prototype.shrn=function(t){return this.clone().ishrn(t)},u.prototype.ushrn=function(t){return this.clone().iushrn(t)},u.prototype.testn=function(t){d(typeof t=="number"&&t>=0);var i=t%26,n=(t-i)/26,o=1<<i;if(this.length<=n)return!1;var c=this.words[n];return!!(c&o)},u.prototype.imaskn=function(t){d(typeof t=="number"&&t>=0);var i=t%26,n=(t-i)/26;if(d(this.negative===0,"imaskn works only with positive numbers"),this.length<=n)return this;if(i!==0&&n++,this.length=Math.min(n,this.length),i!==0){var o=67108863^67108863>>>i<<i;this.words[this.length-1]&=o}return this.strip()},u.prototype.maskn=function(t){return this.clone().imaskn(t)},u.prototype.iaddn=function(t){return d(typeof t=="number"),d(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},u.prototype._iaddn=function(t){this.words[0]+=t;for(var i=0;i<this.length&&this.words[i]>=67108864;i++)this.words[i]-=67108864,i===this.length-1?this.words[i+1]=1:this.words[i+1]++;return this.length=Math.max(this.length,i+1),this},u.prototype.isubn=function(t){if(d(typeof t=="number"),d(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var i=0;i<this.length&&this.words[i]<0;i++)this.words[i]+=67108864,this.words[i+1]-=1;return this.strip()},u.prototype.addn=function(t){return this.clone().iaddn(t)},u.prototype.subn=function(t){return this.clone().isubn(t)},u.prototype.iabs=function(){return this.negative=0,this},u.prototype.abs=function(){return this.clone().iabs()},u.prototype._ishlnsubmul=function(t,i,n){var o=t.length+n,c;this._expand(o);var p,m=0;for(c=0;c<t.length;c++){p=(this.words[c+n]|0)+m;var a=(t.words[c]|0)*i;p-=a&67108863,m=(p>>26)-(a/67108864|0),this.words[c+n]=p&67108863}for(;c<this.length-n;c++)p=(this.words[c+n]|0)+m,m=p>>26,this.words[c+n]=p&67108863;if(m===0)return this.strip();for(d(m===-1),m=0,c=0;c<this.length;c++)p=-(this.words[c]|0)+m,m=p>>26,this.words[c]=p&67108863;return this.negative=1,this.strip()},u.prototype._wordDiv=function(t,i){var n=this.length-t.length,o=this.clone(),c=t,p=c.words[c.length-1]|0,m=this._countBits(p);n=26-m,n!==0&&(c=c.ushln(n),o.iushln(n),p=c.words[c.length-1]|0);var a=o.length-c.length,e;if(i!=="mod"){e=new u(null),e.length=a+1,e.words=new Array(e.length);for(var f=0;f<e.length;f++)e.words[f]=0}var w=o.clone()._ishlnsubmul(c,1,a);w.negative===0&&(o=w,e&&(e.words[a]=1));for(var b=a-1;b>=0;b--){var S=(o.words[c.length+b]|0)*67108864+(o.words[c.length+b-1]|0);for(S=Math.min(S/p|0,67108863),o._ishlnsubmul(c,S,b);o.negative!==0;)S--,o.negative=0,o._ishlnsubmul(c,1,b),o.isZero()||(o.negative^=1);e&&(e.words[b]=S)}return e&&e.strip(),o.strip(),i!=="div"&&n!==0&&o.iushrn(n),{div:e||null,mod:o}},u.prototype.divmod=function(t,i,n){if(d(!t.isZero()),this.isZero())return{div:new u(0),mod:new u(0)};var o,c,p;return this.negative!==0&&t.negative===0?(p=this.neg().divmod(t,i),i!=="mod"&&(o=p.div.neg()),i!=="div"&&(c=p.mod.neg(),n&&c.negative!==0&&c.iadd(t)),{div:o,mod:c}):this.negative===0&&t.negative!==0?(p=this.divmod(t.neg(),i),i!=="mod"&&(o=p.div.neg()),{div:o,mod:p.mod}):(this.negative&t.negative)!==0?(p=this.neg().divmod(t.neg(),i),i!=="div"&&(c=p.mod.neg(),n&&c.negative!==0&&c.isub(t)),{div:p.div,mod:c}):t.length>this.length||this.cmp(t)<0?{div:new u(0),mod:this}:t.length===1?i==="div"?{div:this.divn(t.words[0]),mod:null}:i==="mod"?{div:null,mod:new u(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new u(this.modn(t.words[0]))}:this._wordDiv(t,i)},u.prototype.div=function(t){return this.divmod(t,"div",!1).div},u.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},u.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},u.prototype.divRound=function(t){var i=this.divmod(t);if(i.mod.isZero())return i.div;var n=i.div.negative!==0?i.mod.isub(t):i.mod,o=t.ushrn(1),c=t.andln(1),p=n.cmp(o);return p<0||c===1&&p===0?i.div:i.div.negative!==0?i.div.isubn(1):i.div.iaddn(1)},u.prototype.modn=function(t){d(t<=67108863);for(var i=(1<<26)%t,n=0,o=this.length-1;o>=0;o--)n=(i*n+(this.words[o]|0))%t;return n},u.prototype.idivn=function(t){d(t<=67108863);for(var i=0,n=this.length-1;n>=0;n--){var o=(this.words[n]|0)+i*67108864;this.words[n]=o/t|0,i=o%t}return this.strip()},u.prototype.divn=function(t){return this.clone().idivn(t)},u.prototype.egcd=function(t){d(t.negative===0),d(!t.isZero());var i=this,n=t.clone();i.negative!==0?i=i.umod(t):i=i.clone();for(var o=new u(1),c=new u(0),p=new u(0),m=new u(1),a=0;i.isEven()&&n.isEven();)i.iushrn(1),n.iushrn(1),++a;for(var e=n.clone(),f=i.clone();!i.isZero();){for(var w=0,b=1;(i.words[0]&b)===0&&w<26;++w,b<<=1);if(w>0)for(i.iushrn(w);w-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(e),c.isub(f)),o.iushrn(1),c.iushrn(1);for(var S=0,I=1;(n.words[0]&I)===0&&S<26;++S,I<<=1);if(S>0)for(n.iushrn(S);S-- >0;)(p.isOdd()||m.isOdd())&&(p.iadd(e),m.isub(f)),p.iushrn(1),m.iushrn(1);i.cmp(n)>=0?(i.isub(n),o.isub(p),c.isub(m)):(n.isub(i),p.isub(o),m.isub(c))}return{a:p,b:m,gcd:n.iushln(a)}},u.prototype._invmp=function(t){d(t.negative===0),d(!t.isZero());var i=this,n=t.clone();i.negative!==0?i=i.umod(t):i=i.clone();for(var o=new u(1),c=new u(0),p=n.clone();i.cmpn(1)>0&&n.cmpn(1)>0;){for(var m=0,a=1;(i.words[0]&a)===0&&m<26;++m,a<<=1);if(m>0)for(i.iushrn(m);m-- >0;)o.isOdd()&&o.iadd(p),o.iushrn(1);for(var e=0,f=1;(n.words[0]&f)===0&&e<26;++e,f<<=1);if(e>0)for(n.iushrn(e);e-- >0;)c.isOdd()&&c.iadd(p),c.iushrn(1);i.cmp(n)>=0?(i.isub(n),o.isub(c)):(n.isub(i),c.isub(o))}var w;return i.cmpn(1)===0?w=o:w=c,w.cmpn(0)<0&&w.iadd(t),w},u.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var i=this.clone(),n=t.clone();i.negative=0,n.negative=0;for(var o=0;i.isEven()&&n.isEven();o++)i.iushrn(1),n.iushrn(1);do{for(;i.isEven();)i.iushrn(1);for(;n.isEven();)n.iushrn(1);var c=i.cmp(n);if(c<0){var p=i;i=n,n=p}else if(c===0||n.cmpn(1)===0)break;i.isub(n)}while(!0);return n.iushln(o)},u.prototype.invm=function(t){return this.egcd(t).a.umod(t)},u.prototype.isEven=function(){return(this.words[0]&1)===0},u.prototype.isOdd=function(){return(this.words[0]&1)===1},u.prototype.andln=function(t){return this.words[0]&t},u.prototype.bincn=function(t){d(typeof t=="number");var i=t%26,n=(t-i)/26,o=1<<i;if(this.length<=n)return this._expand(n+1),this.words[n]|=o,this;for(var c=o,p=n;c!==0&&p<this.length;p++){var m=this.words[p]|0;m+=c,c=m>>>26,m&=67108863,this.words[p]=m}return c!==0&&(this.words[p]=c,this.length++),this},u.prototype.isZero=function(){return this.length===1&&this.words[0]===0},u.prototype.cmpn=function(t){var i=t<0;if(this.negative!==0&&!i)return-1;if(this.negative===0&&i)return 1;this.strip();var n;if(this.length>1)n=1;else{i&&(t=-t),d(t<=67108863,"Number is too big");var o=this.words[0]|0;n=o===t?0:o<t?-1:1}return this.negative!==0?-n|0:n},u.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var i=this.ucmp(t);return this.negative!==0?-i|0:i},u.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var i=0,n=this.length-1;n>=0;n--){var o=this.words[n]|0,c=t.words[n]|0;if(o!==c){o<c?i=-1:o>c&&(i=1);break}}return i},u.prototype.gtn=function(t){return this.cmpn(t)===1},u.prototype.gt=function(t){return this.cmp(t)===1},u.prototype.gten=function(t){return this.cmpn(t)>=0},u.prototype.gte=function(t){return this.cmp(t)>=0},u.prototype.ltn=function(t){return this.cmpn(t)===-1},u.prototype.lt=function(t){return this.cmp(t)===-1},u.prototype.lten=function(t){return this.cmpn(t)<=0},u.prototype.lte=function(t){return this.cmp(t)<=0},u.prototype.eqn=function(t){return this.cmpn(t)===0},u.prototype.eq=function(t){return this.cmp(t)===0},u.red=function(t){return new N(t)},u.prototype.toRed=function(t){return d(!this.red,"Already a number in reduction context"),d(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},u.prototype.fromRed=function(){return d(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},u.prototype._forceRed=function(t){return this.red=t,this},u.prototype.forceRed=function(t){return d(!this.red,"Already a number in reduction context"),this._forceRed(t)},u.prototype.redAdd=function(t){return d(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},u.prototype.redIAdd=function(t){return d(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},u.prototype.redSub=function(t){return d(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},u.prototype.redISub=function(t){return d(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},u.prototype.redShl=function(t){return d(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},u.prototype.redMul=function(t){return d(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},u.prototype.redIMul=function(t){return d(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},u.prototype.redSqr=function(){return d(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},u.prototype.redISqr=function(){return d(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},u.prototype.redSqrt=function(){return d(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},u.prototype.redInvm=function(){return d(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},u.prototype.redNeg=function(){return d(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},u.prototype.redPow=function(t){return d(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var _={k256:null,p224:null,p192:null,p25519:null};function M(l,t){this.name=l,this.p=new u(t,16),this.n=this.p.bitLength(),this.k=new u(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}M.prototype._tmp=function(){var t=new u(null);return t.words=new Array(Math.ceil(this.n/13)),t},M.prototype.ireduce=function(t){var i=t,n;do this.split(i,this.tmp),i=this.imulK(i),i=i.iadd(this.tmp),n=i.bitLength();while(n>this.n);var o=n<this.n?-1:i.ucmp(this.p);return o===0?(i.words[0]=0,i.length=1):o>0?i.isub(this.p):i.strip(),i},M.prototype.split=function(t,i){t.iushrn(this.n,0,i)},M.prototype.imulK=function(t){return t.imul(this.k)};function x(){M.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}g(x,M),x.prototype.split=function(t,i){for(var n=4194303,o=Math.min(t.length,9),c=0;c<o;c++)i.words[c]=t.words[c];if(i.length=o,t.length<=9){t.words[0]=0,t.length=1;return}var p=t.words[9];for(i.words[i.length++]=p&n,c=10;c<t.length;c++){var m=t.words[c]|0;t.words[c-10]=(m&n)<<4|p>>>22,p=m}p>>>=22,t.words[c-10]=p,p===0&&t.length>10?t.length-=10:t.length-=9},x.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var i=0,n=0;n<t.length;n++){var o=t.words[n]|0;i+=o*977,t.words[n]=i&67108863,i=o*64+(i/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function C(){M.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}g(C,M);function R(){M.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}g(R,M);function vt(){M.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}g(vt,M),vt.prototype.imulK=function(t){for(var i=0,n=0;n<t.length;n++){var o=(t.words[n]|0)*19+i,c=o&67108863;o>>>=26,t.words[n]=c,i=o}return i!==0&&(t.words[t.length++]=i),t},u._prime=function(t){if(_[t])return _[t];var i;if(t==="k256")i=new x;else if(t==="p224")i=new C;else if(t==="p192")i=new R;else if(t==="p25519")i=new vt;else throw new Error("Unknown prime "+t);return _[t]=i,i};function N(l){if(typeof l=="string"){var t=u._prime(l);this.m=t.p,this.prime=t}else d(l.gtn(1),"modulus must be greater than 1"),this.m=l,this.prime=null}N.prototype._verify1=function(t){d(t.negative===0,"red works only with positives"),d(t.red,"red works only with red numbers")},N.prototype._verify2=function(t,i){d((t.negative|i.negative)===0,"red works only with positives"),d(t.red&&t.red===i.red,"red works only with red numbers")},N.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},N.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},N.prototype.add=function(t,i){this._verify2(t,i);var n=t.add(i);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},N.prototype.iadd=function(t,i){this._verify2(t,i);var n=t.iadd(i);return n.cmp(this.m)>=0&&n.isub(this.m),n},N.prototype.sub=function(t,i){this._verify2(t,i);var n=t.sub(i);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},N.prototype.isub=function(t,i){this._verify2(t,i);var n=t.isub(i);return n.cmpn(0)<0&&n.iadd(this.m),n},N.prototype.shl=function(t,i){return this._verify1(t),this.imod(t.ushln(i))},N.prototype.imul=function(t,i){return this._verify2(t,i),this.imod(t.imul(i))},N.prototype.mul=function(t,i){return this._verify2(t,i),this.imod(t.mul(i))},N.prototype.isqr=function(t){return this.imul(t,t.clone())},N.prototype.sqr=function(t){return this.mul(t,t)},N.prototype.sqrt=function(t){if(t.isZero())return t.clone();var i=this.m.andln(3);if(d(i%2===1),i===3){var n=this.m.add(new u(1)).iushrn(2);return this.pow(t,n)}for(var o=this.m.subn(1),c=0;!o.isZero()&&o.andln(1)===0;)c++,o.iushrn(1);d(!o.isZero());var p=new u(1).toRed(this),m=p.redNeg(),a=this.m.subn(1).iushrn(1),e=this.m.bitLength();for(e=new u(2*e*e).toRed(this);this.pow(e,a).cmp(m)!==0;)e.redIAdd(m);for(var f=this.pow(e,o),w=this.pow(t,o.addn(1).iushrn(1)),b=this.pow(t,o),S=c;b.cmp(p)!==0;){for(var I=b,E=0;I.cmp(p)!==0;E++)I=I.redSqr();d(E<S);var T=this.pow(f,new u(1).iushln(S-E-1));w=w.redMul(T),f=T.redSqr(),b=b.redMul(f),S=E}return w},N.prototype.invm=function(t){var i=t._invmp(this.m);return i.negative!==0?(i.negative=0,this.imod(i).redNeg()):this.imod(i)},N.prototype.pow=function(t,i){if(i.isZero())return new u(1).toRed(this);if(i.cmpn(1)===0)return t.clone();var n=4,o=new Array(1<<n);o[0]=new u(1).toRed(this),o[1]=t;for(var c=2;c<o.length;c++)o[c]=this.mul(o[c-1],t);var p=o[0],m=0,a=0,e=i.bitLength()%26;for(e===0&&(e=26),c=i.length-1;c>=0;c--){for(var f=i.words[c],w=e-1;w>=0;w--){var b=f>>w&1;if(p!==o[0]&&(p=this.sqr(p)),b===0&&m===0){a=0;continue}m<<=1,m|=b,a++,!(a!==n&&(c!==0||w!==0))&&(p=this.mul(p,o[m]),a=0,m=0)}e=26}return p},N.prototype.convertTo=function(t){var i=t.umod(this.m);return i===t?i.clone():i},N.prototype.convertFrom=function(t){var i=t.clone();return i.red=null,i},u.mont=function(t){return new xt(t)};function xt(l){N.call(this,l),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new u(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g(xt,N),xt.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},xt.prototype.convertFrom=function(t){var i=this.imod(t.mul(this.rinv));return i.red=null,i},xt.prototype.imul=function(t,i){if(t.isZero()||i.isZero())return t.words[0]=0,t.length=1,t;var n=t.imul(i),o=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=n.isub(o).iushrn(this.shift),p=c;return c.cmp(this.m)>=0?p=c.isub(this.m):c.cmpn(0)<0&&(p=c.iadd(this.m)),p._forceRed(this)},xt.prototype.mul=function(t,i){if(t.isZero()||i.isZero())return new u(0)._forceRed(this);var n=t.mul(i),o=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=n.isub(o).iushrn(this.shift),p=c;return c.cmp(this.m)>=0?p=c.isub(this.m):c.cmpn(0)<0&&(p=c.iadd(this.m)),p._forceRed(this)},xt.prototype.invm=function(t){var i=this.imod(t._invmp(this.m).mul(this.r2));return i._forceRed(this)}})(h,or)})($e);const br=$e.exports;var Sr=ce;ce.strict=Ze;ce.loose=Je;var Ir=Object.prototype.toString,xr={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function ce(h){return Ze(h)||Je(h)}function Ze(h){return h instanceof Int8Array||h instanceof Int16Array||h instanceof Int32Array||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Uint16Array||h instanceof Uint32Array||h instanceof Float32Array||h instanceof Float64Array}function Je(h){return xr[Ir.call(h)]}var Rr=Sr.strict,kr=function(r){if(Rr(r)){var s=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength&&(s=s.slice(r.byteOffset,r.byteOffset+r.byteLength)),s}else return Buffer.from(r)};const We="hex",ze="utf8",Lt="0";function Tt(h){return new Uint8Array(h)}function De(h,r=!1){const s=h.toString(We);return r?Ot(s):s}function Er(h){return h.toString(ze)}function Pt(h){return kr(h)}function Et(h,r=!1){return De(Pt(h),r)}function qr(h){return Er(Pt(h))}function Tr(h){return Buffer.from(bt(h),We)}function qt(h){return Tt(Tr(h))}function ue(h){return Buffer.from(h,ze)}function Or(h){return Tt(ue(h))}function Ar(h,r=!1){return De(ue(h),r)}function Cr(h,r){return!(typeof h!="string"||!h.match(/^0x[0-9A-Fa-f]*$/)||r&&h.length!==2+2*r)}function Ke(...h){let r=[];return h.forEach(s=>r=r.concat(Array.from(s))),new Uint8Array([...r])}function Nr(h,r=8){const s=h%r;return s?(h-s)/r*r+r:h}function Ur(h,r=8,s=Lt){return Br(h,Nr(h.length,r),s)}function Br(h,r,s=Lt){return Pr(h,r,!0,s)}function bt(h){return h.replace(/^0x/,"")}function Ot(h){return h.startsWith("0x")?h:`0x${h}`}function Qe(h){return h=bt(h),h=Ur(h,2),h&&(h=Ot(h)),h}function Lr(h){const r=h.startsWith("0x");return h=bt(h),h=h.startsWith(Lt)?h.substring(1):h,r?Ot(h):h}function Pr(h,r,s,d=Lt){const g=r-h.length;let u=h;if(g>0){const q=d.repeat(g);u=s?q+h:h+q}return u}function he(h){return Pt(new Uint8Array(h))}function Fr(h,r){return Et(new Uint8Array(h),!r)}function Hr(h){return Tt(h).buffer}function jr(h){return ue(h)}function $r(h,r){return Ar(h,!r)}function Zr(h){return qt(h).buffer}function Ge(h,r){const s=bt(Qe(new br(h).toString(16)));return r?s:Ot(s)}function Ut(h){return Qe(h)}function Jr(h){return Lr(Ot(h))}const Wr=ar;function ne(){return((r,s)=>{for(s=r="";r++<36;s+=r*51&52?(r^15?8^Math.random()*(r^20?16:4):4).toString(16):"-");return s})()}function zr(h,r){let s;const d=_r[h];return d&&(s=`https://${d}.infura.io/v3/${r}`),s}function Dr(h,r){let s;const d=zr(h,r.infuraId);return r.custom&&r.custom[h]?s=r.custom[h]:d&&(s=d),s}function Kr(h){return h===""||typeof h=="string"&&h.trim()===""}function Qr(h){return!(h&&h.length)}function Ve(h,r){return Cr(h,r)}function Gr(h){return typeof h.method<"u"}function At(h){return typeof h.result<"u"}function Bt(h){return typeof h.error<"u"}function Ue(h){return typeof h.event<"u"}function Vr(h){return wr.includes(h)||h.startsWith("wc_")}function Yr(h){return h.method.startsWith("wc_")?!0:!fe.includes(h.method)}function Xr(h){h=bt(h.toLowerCase());const r=bt(hr.exports.keccak_256(jr(h)));let s="";for(let d=0;d<h.length;d++)parseInt(r[d],16)>7?s+=h[d].toUpperCase():s+=h[d];return Ot(s)}const ti=h=>h?h.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(h)?/^(0x)?[0-9a-f]{40}$/.test(h)||/^(0x)?[0-9A-F]{40}$/.test(h)?!0:h===Xr(h):!1:!1;function Be(h){return!Qr(h)&&!Ve(h[0])&&(h[0]=$r(h[0])),h}function se(h){if(typeof h.type<"u"&&h.type!=="0")return h;if(typeof h.from>"u"||!ti(h.from))throw new Error("Transaction object must include a valid 'from' value.");function r(g){let u=g;return(typeof g=="number"||typeof g=="string"&&!Kr(g))&&(Ve(g)?typeof g=="string"&&(u=Ut(g)):u=Ge(g)),typeof u=="string"&&(u=Jr(u)),u}const s={from:Ut(h.from),to:typeof h.to>"u"?void 0:Ut(h.to),gasPrice:typeof h.gasPrice>"u"?"":r(h.gasPrice),gas:typeof h.gas>"u"?typeof h.gasLimit>"u"?"":r(h.gasLimit):r(h.gas),value:typeof h.value>"u"?"":r(h.value),nonce:typeof h.nonce>"u"?"":r(h.nonce),data:typeof h.data>"u"?"":Ut(h.data)||"0x"},d=["gasPrice","gas","value","nonce"];return Object.keys(s).forEach(g=>{(typeof s[g]>"u"||typeof s[g]=="string"&&!s[g].trim().length)&&d.includes(g)&&delete s[g]}),s}function ei(h){const r=h.message||"Failed or Rejected Request";let s=-32e3;if(h&&!h.code)switch(r){case"Parse error":s=-32700;break;case"Invalid request":s=-32600;break;case"Method not found":s=-32601;break;case"Invalid params":s=-32602;break;case"Internal error":s=-32603;break;default:s=-32e3;break}const d={code:s,message:r};return h.data&&(d.data=h.data),d}var le={};(function(h){const r=cr,s=ur,d=fr,g=v=>v==null;function u(v){switch(v.arrayFormat){case"index":return y=>(_,M)=>{const x=_.length;return M===void 0||v.skipNull&&M===null||v.skipEmptyString&&M===""?_:M===null?[..._,[k(y,v),"[",x,"]"].join("")]:[..._,[k(y,v),"[",k(x,v),"]=",k(M,v)].join("")]};case"bracket":return y=>(_,M)=>M===void 0||v.skipNull&&M===null||v.skipEmptyString&&M===""?_:M===null?[..._,[k(y,v),"[]"].join("")]:[..._,[k(y,v),"[]=",k(M,v)].join("")];case"comma":case"separator":return y=>(_,M)=>M==null||M.length===0?_:_.length===0?[[k(y,v),"=",k(M,v)].join("")]:[[_,k(M,v)].join(v.arrayFormatSeparator)];default:return y=>(_,M)=>M===void 0||v.skipNull&&M===null||v.skipEmptyString&&M===""?_:M===null?[..._,k(y,v)]:[..._,[k(y,v),"=",k(M,v)].join("")]}}function q(v){let y;switch(v.arrayFormat){case"index":return(_,M,x)=>{if(y=/\[(\d*)\]$/.exec(_),_=_.replace(/\[\d*\]$/,""),!y){x[_]=M;return}x[_]===void 0&&(x[_]={}),x[_][y[1]]=M};case"bracket":return(_,M,x)=>{if(y=/(\[\])$/.exec(_),_=_.replace(/\[\]$/,""),!y){x[_]=M;return}if(x[_]===void 0){x[_]=[M];return}x[_]=[].concat(x[_],M)};case"comma":case"separator":return(_,M,x)=>{const R=typeof M=="string"&&M.split("").indexOf(v.arrayFormatSeparator)>-1?M.split(v.arrayFormatSeparator).map(vt=>gt(vt,v)):M===null?M:gt(M,v);x[_]=R};default:return(_,M,x)=>{if(x[_]===void 0){x[_]=M;return}x[_]=[].concat(x[_],M)}}}function mt(v){if(typeof v!="string"||v.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function k(v,y){return y.encode?y.strict?r(v):encodeURIComponent(v):v}function gt(v,y){return y.decode?s(v):v}function It(v){return Array.isArray(v)?v.sort():typeof v=="object"?It(Object.keys(v)).sort((y,_)=>Number(y)-Number(_)).map(y=>v[y]):v}function Mt(v){const y=v.indexOf("#");return y!==-1&&(v=v.slice(0,y)),v}function wt(v){let y="";const _=v.indexOf("#");return _!==-1&&(y=v.slice(_)),y}function yt(v){v=Mt(v);const y=v.indexOf("?");return y===-1?"":v.slice(y+1)}function kt(v,y){return y.parseNumbers&&!Number.isNaN(Number(v))&&typeof v=="string"&&v.trim()!==""?v=Number(v):y.parseBooleans&&v!==null&&(v.toLowerCase()==="true"||v.toLowerCase()==="false")&&(v=v.toLowerCase()==="true"),v}function Nt(v,y){y=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},y),mt(y.arrayFormatSeparator);const _=q(y),M=Object.create(null);if(typeof v!="string"||(v=v.trim().replace(/^[?#&]/,""),!v))return M;for(const x of v.split("&")){let[C,R]=d(y.decode?x.replace(/\+/g," "):x,"=");R=R===void 0?null:["comma","separator"].includes(y.arrayFormat)?R:gt(R,y),_(gt(C,y),R,M)}for(const x of Object.keys(M)){const C=M[x];if(typeof C=="object"&&C!==null)for(const R of Object.keys(C))C[R]=kt(C[R],y);else M[x]=kt(C,y)}return y.sort===!1?M:(y.sort===!0?Object.keys(M).sort():Object.keys(M).sort(y.sort)).reduce((x,C)=>{const R=M[C];return Boolean(R)&&typeof R=="object"&&!Array.isArray(R)?x[C]=It(R):x[C]=R,x},Object.create(null))}h.extract=yt,h.parse=Nt,h.stringify=(v,y)=>{if(!v)return"";y=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},y),mt(y.arrayFormatSeparator);const _=R=>y.skipNull&&g(v[R])||y.skipEmptyString&&v[R]==="",M=u(y),x={};for(const R of Object.keys(v))_(R)||(x[R]=v[R]);const C=Object.keys(x);return y.sort!==!1&&C.sort(y.sort),C.map(R=>{const vt=v[R];return vt===void 0?"":vt===null?k(R,y):Array.isArray(vt)?vt.reduce(M(R),[]).join("&"):k(R,y)+"="+k(vt,y)}).filter(R=>R.length>0).join("&")},h.parseUrl=(v,y)=>{y=Object.assign({decode:!0},y);const[_,M]=d(v,"#");return Object.assign({url:_.split("?")[0]||"",query:Nt(yt(v),y)},y&&y.parseFragmentIdentifier&&M?{fragmentIdentifier:gt(M,y)}:{})},h.stringifyUrl=(v,y)=>{y=Object.assign({encode:!0,strict:!0},y);const _=Mt(v.url).split("?")[0]||"",M=h.extract(v.url),x=h.parse(M,{sort:!1}),C=Object.assign(x,v.query);let R=h.stringify(C,y);R&&(R=`?${R}`);let vt=wt(v.url);return v.fragmentIdentifier&&(vt=`#${k(v.fragmentIdentifier,y)}`),`${_}${R}${vt}`}})(le);function ri(h){const r=h.indexOf("?")!==-1?h.indexOf("?"):void 0;return typeof r<"u"?h.substr(r):""}function ii(h,r){let s=Ye(h);return s=Object.assign(Object.assign({},s),r),h=ni(s),h}function Ye(h){return le.parse(h)}function ni(h){return le.stringify(h)}function si(h){return typeof h.bridge<"u"}function oi(h){const r=h.indexOf(":"),s=h.indexOf("?")!==-1?h.indexOf("?"):void 0,d=h.substring(0,r),g=h.substring(r+1,s);function u(Mt){const wt="@",yt=Mt.split(wt);return{handshakeTopic:yt[0],version:parseInt(yt[1],10)}}const q=u(g),mt=typeof s<"u"?h.substr(s):"";function k(Mt){const wt=Ye(Mt);return{key:wt.key||"",bridge:wt.bridge||""}}const gt=k(mt);return Object.assign(Object.assign({protocol:d},q),gt)}class hi{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(r,s){this._eventEmitters.push({event:r,callback:s})}trigger(r){let s=[];r&&(s=this._eventEmitters.filter(d=>d.event===r)),s.forEach(d=>{d.callback()})}}const ai=typeof globalThis.WebSocket<"u"?globalThis.WebSocket:require("ws");class fi{constructor(r){if(this.opts=r,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=r.protocol,this._version=r.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=r.subscriptions||[],this._netMonitor=r.netMonitor||new hi,!r.url||typeof r.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=r.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(r){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(r){}get connecting(){return this.readyState===0}set connected(r){}get connected(){return this.readyState===1}set closing(r){}get closing(){return this.readyState===2}set closed(r){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(r,s,d){if(!s||typeof s!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:s,type:"pub",payload:r,silent:!!d})}subscribe(r){this._socketSend({topic:r,type:"sub",payload:"",silent:!0})}on(r,s){this._events.push({event:r,callback:s})}_socketCreate(){if(this._nextSocket)return;const r=ci(this._url,this._protocol,this._version);if(this._nextSocket=new ai(r),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=s=>this._socketReceive(s),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=s=>this._socketError(s),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(r){const s=JSON.stringify(r);this._socket&&this._socket.readyState===1?this._socket.send(s):(this._setToQueue(r),this._socketCreate())}async _socketReceive(r){let s;try{s=JSON.parse(r.data)}catch{return}if(this._socketSend({topic:s.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const d=this._events.filter(g=>g.event==="message");d&&d.length&&d.forEach(g=>g.callback(s))}}_socketError(r){const s=this._events.filter(d=>d.event==="error");s&&s.length&&s.forEach(d=>d.callback(r))}_queueSubscriptions(){this._subscriptions.forEach(s=>this._queue.push({topic:s,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(r){this._queue.push(r)}_pushQueue(){this._queue.forEach(s=>this._socketSend(s)),this._queue=[]}}function ci(h,r,s){var d,g;const q=(h.startsWith("https")?h.replace("https","wss"):h.startsWith("http")?h.replace("http","ws"):h).split("?"),mt=pr()?{protocol:r,version:s,env:"browser",host:((d=mr())===null||d===void 0?void 0:d.host)||""}:{protocol:r,version:s,env:((g=gr())===null||g===void 0?void 0:g.name)||""},k=ii(ri(q[1]||""),mt);return q[0]+"?"+k}const oe="Session currently connected",Rt="Session currently disconnected",ui="Session Rejected",li="Missing JSON RPC response",di='JSON-RPC success response must include "result" field',pi='JSON-RPC error response must include "error" field',mi='JSON RPC request must have valid "method" value',gi='JSON RPC request must have valid "id" value',vi="Missing one of the required parameters: bridge / uri / session",Le="JSON RPC response format is invalid",yi="URI format is invalid",Mi="QRCode Modal not provided",Pe="User close QRCode Modal";class wi{constructor(){this._eventEmitters=[]}subscribe(r){this._eventEmitters.push(r)}unsubscribe(r){this._eventEmitters=this._eventEmitters.filter(s=>s.event!==r)}trigger(r){let s=[],d;Gr(r)?d=r.method:At(r)||Bt(r)?d=`response:${r.id}`:Ue(r)?d=r.event:d="",d&&(s=this._eventEmitters.filter(g=>g.event===d)),(!s||!s.length)&&!Vr(d)&&!Ue(d)&&(s=this._eventEmitters.filter(g=>g.event==="call_request")),s.forEach(g=>{if(Bt(r)){const u=new Error(r.error.message);g.callback(u,null)}else g.callback(null,r)})}}class _i{constructor(r="walletconnect"){this.storageId=r}getSession(){let r=null;const s=He(this.storageId);return s&&si(s)&&(r=s),r}setSession(r){return vr(this.storageId,r),r}removeSession(){je(this.storageId)}}const bi="walletconnect.org",Si="abcdefghijklmnopqrstuvwxyz0123456789",Xe=Si.split("").map(h=>`https://${h}.bridge.walletconnect.org`);function Ii(h){let r=h.indexOf("//")>-1?h.split("/")[2]:h.split("/")[0];return r=r.split(":")[0],r=r.split("?")[0],r}function xi(h){return Ii(h).split(".").slice(-2).join(".")}function Ri(){return Math.floor(Math.random()*Xe.length)}function ki(){return Xe[Ri()]}function Ei(h){return xi(h)===bi}function qi(h){return Ei(h)?ki():h}class Ti{constructor(r){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new wi,this._clientMeta=Ce()||r.connectorOpts.clientMeta||null,this._cryptoLib=r.cryptoLib,this._sessionStorage=r.sessionStorage||new _i(r.connectorOpts.storageId),this._qrcodeModal=r.connectorOpts.qrcodeModal,this._qrcodeModalOptions=r.connectorOpts.qrcodeModalOptions,this._signingMethods=[...fe,...r.connectorOpts.signingMethods||[]],!r.connectorOpts.bridge&&!r.connectorOpts.uri&&!r.connectorOpts.session)throw new Error(vi);r.connectorOpts.bridge&&(this.bridge=qi(r.connectorOpts.bridge)),r.connectorOpts.uri&&(this.uri=r.connectorOpts.uri);const s=r.connectorOpts.session||this._getStorageSession();s&&(this.session=s),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=r.transport||new fi({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),r.connectorOpts.uri&&this._subscribeToSessionRequest(),r.pushServerOpts&&this._registerPushServer(r.pushServerOpts)}set bridge(r){!r||(this._bridge=r)}get bridge(){return this._bridge}set key(r){if(!r)return;const s=Zr(r);this._key=s}get key(){return this._key?Fr(this._key,!0):""}set clientId(r){!r||(this._clientId=r)}get clientId(){let r=this._clientId;return r||(r=this._clientId=ne()),this._clientId}set peerId(r){!r||(this._peerId=r)}get peerId(){return this._peerId}set clientMeta(r){}get clientMeta(){let r=this._clientMeta;return r||(r=this._clientMeta=Ce()),r}set peerMeta(r){this._peerMeta=r}get peerMeta(){return this._peerMeta}set handshakeTopic(r){!r||(this._handshakeTopic=r)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(r){!r||(this._handshakeId=r)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(r){if(!r)return;const{handshakeTopic:s,bridge:d,key:g}=this._parseUri(r);this.handshakeTopic=s,this.bridge=d,this.key=g}set chainId(r){this._chainId=r}get chainId(){return this._chainId}set networkId(r){this._networkId=r}get networkId(){return this._networkId}set accounts(r){this._accounts=r}get accounts(){return this._accounts}set rpcUrl(r){this._rpcUrl=r}get rpcUrl(){return this._rpcUrl}set connected(r){}get connected(){return this._connected}set pending(r){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(r){!r||(this._connected=r.connected,this.accounts=r.accounts,this.chainId=r.chainId,this.bridge=r.bridge,this.key=r.key,this.clientId=r.clientId,this.clientMeta=r.clientMeta,this.peerId=r.peerId,this.peerMeta=r.peerMeta,this.handshakeId=r.handshakeId,this.handshakeTopic=r.handshakeTopic)}on(r,s){const d={event:r,callback:s};this._eventManager.subscribe(d)}off(r){this._eventManager.unsubscribe(r)}async createInstantRequest(r){this._key=await this._generateKey();const s=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(r)}]});this.handshakeId=s.id,this.handshakeTopic=ne(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(Pe)});const d=()=>{this.killSession()};try{const g=await this._sendCallRequest(s);return g&&d(),g}catch(g){throw d(),g}}async connect(r){if(!this._qrcodeModal)throw new Error(Mi);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(r),new Promise(async(s,d)=>{this.on("modal_closed",()=>d(new Error(Pe))),this.on("connect",(g,u)=>{if(g)return d(g);s(u.params[0])})}))}async createSession(r){if(this._connected)throw new Error(oe);if(this.pending)return;this._key=await this._generateKey();const s=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:r&&r.chainId?r.chainId:null}]});this.handshakeId=s.id,this.handshakeTopic=ne(),this._sendSessionRequest(s,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(r){if(this._connected)throw new Error(oe);this.chainId=r.chainId,this.accounts=r.accounts,this.networkId=r.networkId||0,this.rpcUrl=r.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},d={id:this.handshakeId,jsonrpc:"2.0",result:s};this._sendResponse(d),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(r){if(this._connected)throw new Error(oe);const s=r&&r.message?r.message:ui,d=this._formatResponse({id:this.handshakeId,error:{message:s}});this._sendResponse(d),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession()}updateSession(r){if(!this._connected)throw new Error(Rt);this.chainId=r.chainId,this.accounts=r.accounts,this.networkId=r.networkId||0,this.rpcUrl=r.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},d=this._formatRequest({method:"wc_sessionUpdate",params:[s]});this._sendSessionRequest(d,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(r){const s=r?r.message:"Session Disconnected",d={approved:!1,chainId:null,networkId:null,accounts:null},g=this._formatRequest({method:"wc_sessionUpdate",params:[d]});await this._sendRequest(g),this._handleSessionDisconnect(s)}async sendTransaction(r){if(!this._connected)throw new Error(Rt);const s=se(r),d=this._formatRequest({method:"eth_sendTransaction",params:[s]});return await this._sendCallRequest(d)}async signTransaction(r){if(!this._connected)throw new Error(Rt);const s=se(r),d=this._formatRequest({method:"eth_signTransaction",params:[s]});return await this._sendCallRequest(d)}async signMessage(r){if(!this._connected)throw new Error(Rt);const s=this._formatRequest({method:"eth_sign",params:r});return await this._sendCallRequest(s)}async signPersonalMessage(r){if(!this._connected)throw new Error(Rt);r=Be(r);const s=this._formatRequest({method:"personal_sign",params:r});return await this._sendCallRequest(s)}async signTypedData(r){if(!this._connected)throw new Error(Rt);const s=this._formatRequest({method:"eth_signTypedData",params:r});return await this._sendCallRequest(s)}async updateChain(r){if(!this._connected)throw new Error("Session currently disconnected");const s=this._formatRequest({method:"wallet_updateChain",params:[r]});return await this._sendCallRequest(s)}unsafeSend(r,s){return this._sendRequest(r,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:r,options:s}]}),new Promise((d,g)=>{this._subscribeToResponse(r.id,(u,q)=>{if(u){g(u);return}if(!q)throw new Error(li);d(q)})})}async sendCustomRequest(r,s){if(!this._connected)throw new Error(Rt);switch(r.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Ge(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":r.params&&(r.params[0]=se(r.params[0]));break;case"personal_sign":r.params&&(r.params=Be(r.params));break}const d=this._formatRequest(r);return await this._sendCallRequest(d,s)}approveRequest(r){if(At(r)){const s=this._formatResponse(r);this._sendResponse(s)}else throw new Error(di)}rejectRequest(r){if(Bt(r)){const s=this._formatResponse(r);this._sendResponse(s)}else throw new Error(pi)}transportClose(){this._transport.close()}async _sendRequest(r,s){const d=this._formatRequest(r),g=await this._encrypt(d),u=typeof(s==null?void 0:s.topic)<"u"?s.topic:this.peerId,q=JSON.stringify(g),mt=typeof(s==null?void 0:s.forcePushNotification)<"u"?!s.forcePushNotification:Yr(d);this._transport.send(q,u,mt)}async _sendResponse(r){const s=await this._encrypt(r),d=this.peerId,g=JSON.stringify(s),u=!0;this._transport.send(g,d,u)}async _sendSessionRequest(r,s,d){this._sendRequest(r,d),this._subscribeToSessionResponse(r.id,s)}_sendCallRequest(r,s){return this._sendRequest(r,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:r,options:s}]}),this._subscribeToCallResponse(r.id)}_formatRequest(r){if(typeof r.method>"u")throw new Error(mi);return{id:typeof r.id>"u"?Wr():r.id,jsonrpc:"2.0",method:r.method,params:typeof r.params>"u"?[]:r.params}}_formatResponse(r){if(typeof r.id>"u")throw new Error(gi);const s={id:r.id,jsonrpc:"2.0"};if(Bt(r)){const d=ei(r.error);return Object.assign(Object.assign(Object.assign({},s),r),{error:d})}else if(At(r))return Object.assign(Object.assign({},s),r);throw new Error(Le)}_handleSessionDisconnect(r){const s=r||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),je(Ne)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(r,s){s?s.approved?(this._connected?(s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),s.peerId&&!this.peerId&&(this.peerId=s.peerId),s.peerMeta&&!this.peerMeta&&(this.peerMeta=s.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(r):this._handleSessionDisconnect(r)}async _handleIncomingMessages(r){if(![this.clientId,this.handshakeTopic].includes(r.topic))return;let d;try{d=JSON.parse(r.payload)}catch{return}const g=await this._decrypt(d);g&&this._eventManager.trigger(g)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(r,s){this.on(`response:${r}`,s)}_subscribeToSessionResponse(r,s){this._subscribeToResponse(r,(d,g)=>{if(d){this._handleSessionResponse(d.message);return}At(g)?this._handleSessionResponse(s,g.result):g.error&&g.error.message?this._handleSessionResponse(g.error.message):this._handleSessionResponse(s)})}_subscribeToCallResponse(r){return new Promise((s,d)=>{this._subscribeToResponse(r,(g,u)=>{if(g){d(g);return}At(u)?s(u.result):u.error&&u.error.message?d(u.error):d(new Error(Le))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(r,s)=>{const{request:d}=s.params[0];if(yr()&&this._signingMethods.includes(d.method)){const g=He(Ne);g&&(window.location.href=g.href)}}),this.on("wc_sessionRequest",(r,s)=>{r&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:r.toString()}]}),this.handshakeId=s.id,this.peerId=s.params[0].peerId,this.peerMeta=s.params[0].peerMeta;const d=Object.assign(Object.assign({},s),{method:"session_request"});this._eventManager.trigger(d)}),this.on("wc_sessionUpdate",(r,s)=>{r&&this._handleSessionResponse(r.message),this._handleSessionResponse("Session disconnected",s.params[0])})}_initTransport(){this._transport.on("message",r=>this._handleIncomingMessages(r)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const r=this.protocol,s=this.handshakeTopic,d=this.version,g=encodeURIComponent(this.bridge),u=this.key;return`${r}:${s}@${d}?bridge=${g}&key=${u}`}_parseUri(r){const s=oi(r);if(s.protocol===this.protocol){if(!s.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const d=s.handshakeTopic;if(!s.bridge)throw Error("Invalid or missing bridge url parameter value");const g=decodeURIComponent(s.bridge);if(!s.key)throw Error("Invalid or missing key parameter value");const u=s.key;return{handshakeTopic:d,bridge:g,key:u}}else throw new Error(yi)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(r){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.encrypt(r,s):null}async _decrypt(r){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.decrypt(r,s):null}_getStorageSession(){let r=null;return this._sessionStorage&&(r=this._sessionStorage.getSession()),r}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(r){if(!r.url||typeof r.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!r.type||typeof r.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!r.token||typeof r.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const s={bridge:this.bridge,topic:this.clientId,type:r.type,token:r.token,peerName:"",language:r.language||""};this.on("connect",async(d,g)=>{if(d)throw d;if(r.peerMeta){const u=g.params[0].peerMeta.name;s.peerName=u}try{if(!(await(await fetch(`${r.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function Oi(h){return Ct.getBrowerCrypto().getRandomValues(new Uint8Array(h))}const tr=256,er=tr,Ai=tr,St="AES-CBC",Ci=`SHA-${er}`,ae="HMAC",Ni="encrypt",Ui="decrypt",Bi="sign",Li="verify";function Pi(h){return h===St?{length:er,name:St}:{hash:{name:Ci},name:ae}}function Fi(h){return h===St?[Ni,Ui]:[Bi,Li]}async function de(h,r=St){return Ct.getSubtleCrypto().importKey("raw",h,Pi(r),!0,Fi(r))}async function Hi(h,r,s){const d=Ct.getSubtleCrypto(),g=await de(r,St),u=await d.encrypt({iv:h,name:St},g,s);return new Uint8Array(u)}async function ji(h,r,s){const d=Ct.getSubtleCrypto(),g=await de(r,St),u=await d.decrypt({iv:h,name:St},g,s);return new Uint8Array(u)}async function $i(h,r){const s=Ct.getSubtleCrypto(),d=await de(h,ae),g=await s.sign({length:Ai,name:ae},d,r);return new Uint8Array(g)}function Zi(h,r,s){return Hi(h,r,s)}function Ji(h,r,s){return ji(h,r,s)}async function rr(h,r){return await $i(h,r)}async function ir(h){const r=(h||256)/8,s=Oi(r);return Hr(Pt(s))}async function nr(h,r){const s=qt(h.data),d=qt(h.iv),g=qt(h.hmac),u=Et(g,!1),q=Ke(s,d),mt=await rr(r,q),k=Et(mt,!1);return bt(u)===bt(k)}async function Wi(h,r,s){const d=Tt(he(r)),g=s||await ir(128),u=Tt(he(g)),q=Et(u,!1),mt=JSON.stringify(h),k=Or(mt),gt=await Zi(u,d,k),It=Et(gt,!1),Mt=Ke(gt,u),wt=await rr(d,Mt),yt=Et(wt,!1);return{data:It,hmac:yt,iv:q}}async function zi(h,r){const s=Tt(he(r));if(!s)throw new Error("Missing key: required for decryption");if(!await nr(h,s))return null;const g=qt(h.data),u=qt(h.iv),q=await Ji(u,s,g),mt=qr(q);let k;try{k=JSON.parse(mt)}catch{return null}return k}const Di=Object.freeze(Object.defineProperty({__proto__:null,generateKey:ir,verifyHmac:nr,encrypt:Wi,decrypt:zi},Symbol.toStringTag,{value:"Module"}));class Ki extends Ti{constructor(r,s){super({cryptoLib:Di,connectorOpts:r,pushServerOpts:s})}}class Qi extends lr{constructor(r){super(),this.events=new Fe,this.accounts=[],this.chainId=1,this.pending=!1,this.bridge="https://bridge.walletconnect.org",this.qrcode=!0,this.qrcodeModalOptions=void 0,this.opts=r,this.chainId=(r==null?void 0:r.chainId)||this.chainId,this.wc=this.register(r)}get connected(){return typeof this.wc<"u"&&this.wc.connected}get connecting(){return this.pending}get connector(){return this.wc=this.register(this.opts),this.wc}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}off(r,s){this.events.off(r,s)}removeListener(r,s){this.events.removeListener(r,s)}async open(r){if(this.connected){this.onOpen();return}return new Promise((s,d)=>{this.on("error",g=>{d(g)}),this.on("open",()=>{s()}),this.create(r)})}async close(){typeof this.wc>"u"||(this.wc.connected&&this.wc.killSession(),this.onClose())}async send(r){this.wc=this.register(this.opts),this.connected||await this.open(),this.sendPayload(r).then(s=>this.events.emit("payload",s)).catch(s=>this.events.emit("payload",Oe(r.id,s.message)))}register(r){if(this.wc)return this.wc;this.opts=r||this.opts,this.bridge=r!=null&&r.connector?r.connector.bridge:(r==null?void 0:r.bridge)||"https://bridge.walletconnect.org",this.qrcode=typeof(r==null?void 0:r.qrcode)>"u"||r.qrcode!==!1,this.chainId=typeof(r==null?void 0:r.chainId)<"u"?r.chainId:this.chainId,this.qrcodeModalOptions=r==null?void 0:r.qrcodeModalOptions;const s={bridge:this.bridge,qrcodeModal:this.qrcode?Mr:void 0,qrcodeModalOptions:this.qrcodeModalOptions,storageId:r==null?void 0:r.storageId,signingMethods:r==null?void 0:r.signingMethods,clientMeta:r==null?void 0:r.clientMeta};if(this.wc=typeof(r==null?void 0:r.connector)<"u"?r.connector:new Ki(s),typeof this.wc>"u")throw new Error("Failed to register WalletConnect connector");return this.wc.accounts.length&&(this.accounts=this.wc.accounts),this.wc.chainId&&(this.chainId=this.wc.chainId),this.registerConnectorEvents(),this.wc}onOpen(r){this.pending=!1,r&&(this.wc=r),this.events.emit("open")}onClose(){this.pending=!1,this.wc&&(this.wc=void 0),this.events.emit("close")}onError(r,s="Failed or Rejected Request",d=-32e3,g){const u={id:r.id,jsonrpc:r.jsonrpc,error:{code:d,message:s}};return typeof g<"u"&&(u.error.data=g),this.events.emit("payload",u),u}create(r){this.wc=this.register(this.opts),this.chainId=r||this.chainId,!(this.connected||this.pending)&&(this.pending=!0,this.registerConnectorEvents(),this.wc.createSession({chainId:this.chainId}).then(()=>this.events.emit("created")).catch(s=>this.events.emit("error",s)))}registerConnectorEvents(){this.wc=this.register(this.opts),this.wc.on("connect",r=>{var s,d;if(r){this.events.emit("error",r);return}this.accounts=((s=this.wc)===null||s===void 0?void 0:s.accounts)||[],this.chainId=((d=this.wc)===null||d===void 0?void 0:d.chainId)||this.chainId,this.onOpen()}),this.wc.on("disconnect",r=>{if(r){this.events.emit("error",r);return}this.onClose()}),this.wc.on("modal_closed",()=>{this.events.emit("error",new Error("User closed modal"))}),this.wc.on("session_update",(r,s)=>{const{accounts:d,chainId:g}=s.params[0];(!this.accounts||d&&this.accounts!==d)&&(this.accounts=d,this.events.emit("accountsChanged",d)),(!this.chainId||g&&this.chainId!==g)&&(this.chainId=g,this.events.emit("chainChanged",g))})}async sendPayload(r){this.wc=this.register(this.opts);try{const s=await this.wc.unsafeSend(r);return this.sanitizeResponse(s)}catch(s){return this.onError(r,s.message)}}sanitizeResponse(r){return typeof r.error<"u"&&typeof r.error.code>"u"?Oe(r.id,r.error.message,r.error.data):r}}class tn{constructor(r){this.events=new Fe,this.rpc={infuraId:r==null?void 0:r.infuraId,custom:r==null?void 0:r.rpc},this.signer=new Ae(new Qi(r));const s=this.signer.connection.chainId||(r==null?void 0:r.chainId)||1;this.http=this.setHttpProvider(s),this.registerEventListeners()}get connected(){return this.signer.connection.connected}get connector(){return this.signer.connection.connector}get accounts(){return this.signer.connection.accounts}get chainId(){return this.signer.connection.chainId}get rpcUrl(){var r;return((r=this.http)===null||r===void 0?void 0:r.connection).url||""}async request(r){switch(r.method){case"eth_requestAccounts":return await this.connect(),this.signer.connection.accounts;case"eth_accounts":return this.signer.connection.accounts;case"eth_chainId":return this.signer.connection.chainId}if(fe.includes(r.method))return this.signer.request(r);if(typeof this.http>"u")throw new Error(`Cannot request JSON-RPC method (${r.method}) without provided rpc url`);return this.http.request(r)}sendAsync(r,s){this.request(r).then(d=>s(null,d)).catch(d=>s(d,void 0))}async enable(){return await this.request({method:"eth_requestAccounts"})}async connect(){this.signer.connection.connected||await this.signer.connect()}async disconnect(){this.signer.connection.connected&&await this.signer.disconnect()}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}removeListener(r,s){this.events.removeListener(r,s)}off(r,s){this.events.off(r,s)}get isWalletConnect(){return!0}registerEventListeners(){this.signer.connection.on("accountsChanged",r=>{this.events.emit("accountsChanged",r)}),this.signer.connection.on("chainChanged",r=>{this.http=this.setHttpProvider(r),this.events.emit("chainChanged",r)}),this.signer.on("disconnect",()=>{this.events.emit("disconnect")})}setHttpProvider(r){const s=Dr(r,this.rpc);return typeof s>"u"?void 0:new Ae(new dr(s))}}export{tn as default};
